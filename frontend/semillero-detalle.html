<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle Semillero - CEAI SENA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* ========== TIPOGRAF√çA GLOBAL AJUSTADA ========== */
        body {
            font-family: 'Roboto', sans-serif;
            font-size: 15px;
            color: #333;
            line-height: 1.6;
        }

        /* ========== LAYOUT DETALLE SEMILLERO ========== */
        #semilleroContent .row {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
        }
        #semilleroContent .col-md-8 {
            flex: 0 0 66.666667%;
            max-width: 66.666667%;
        }
        #semilleroContent .col-md-4 {
            flex: 0 0 33.333333%;
            max-width: 33.333333%;
            position: sticky;
            top: 100px;
            align-self: flex-start;
        }
        #semilleroContent .col-md-4 img {
            width: 100%;
            height: auto;
            max-height: 320px;
            object-fit: cover;
        }

        /* ========== T√çTULOS ESCALADOS ========== */
        #semilleroContent h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.7rem;
            font-weight: 700;
            margin-bottom: 0.6rem;
        }
        #semilleroContent h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
        }
        #semilleroContent h5 {
            font-size: 0.95rem;
            font-weight: 700;
        }
        #semilleroContent .lead {
            font-size: 0.97rem;
            line-height: 1.7;
            color: #444;
        }

        /* ========== CARD INFORMACI√ìN SEMILLERO ========== */
        .info-semillero-card {
            border-radius: 12px;
            border: none;
            box-shadow: 0 3px 12px rgba(0,0,0,0.08);
            margin-bottom: 1.2rem;
        }
        .info-semillero-card .card-body {
            padding: 1.1rem 1.3rem;
        }
        .info-semillero-card li {
            font-size: 0.88rem;
            margin-bottom: 0.4rem;
        }

        /* ========== SECCI√ìN PROYECTOS ========== */
        .proyectos-toggle-btn {
            background: linear-gradient(135deg, var(--ceai-verde, #39a900) 0%, #4dc800 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 22px;
            font-size: 0.92rem;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 14px rgba(57,169,0,0.3);
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }
        .proyectos-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(57,169,0,0.45);
        }
        .proyectos-toggle-btn .count-badge {
            background: rgba(255,255,255,0.25);
            border-radius: 20px;
            padding: 1px 9px;
            font-size: 0.8rem;
        }
        #proyectosListado {
            display: none;
            animation: fadeSlide 0.35s ease;
        }
        #proyectosListado.visible {
            display: block;
        }
        @keyframes fadeSlide {
            from { opacity: 0; transform: translateY(-10px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        /* ========== TARJETAS DE PROYECTO ========== */
        .proyecto-card {
            background: #fff;
            border-radius: 10px;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.07);
            margin-bottom: 0.9rem;
            padding: 1rem 1.2rem;
            border-left: 4px solid var(--ceai-verde, #39a900);
        }
        .proyecto-card h5 {
            font-size: 0.93rem;
            font-weight: 700;
            margin-bottom: 0.4rem;
            color: var(--ceai-azul, #00304d);
        }
        .proyecto-card p {
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
            color: #444;
        }
        .estado-badge {
            font-size: 0.75rem;
            font-weight: 700;
            padding: 3px 10px;
            border-radius: 20px;
        }

        /* ========== SIDEBAR CARDS ========== */
        .sidebar-card {
            border-radius: 12px;
            border: none;
            box-shadow: 0 3px 12px rgba(0,0,0,0.08);
            margin-bottom: 1rem;
        }
        .sidebar-card .card-body {
            padding: 1.1rem;
        }
        .sidebar-card h5 {
            font-size: 0.9rem;
            font-weight: 700;
        }
        .sidebar-card .btn {
            font-size: 0.85rem;
        }
        .sidebar-card a {
            font-size: 0.85rem;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            #semilleroContent .col-md-8,
            #semilleroContent .col-md-4 {
                flex: 0 0 100%;
                max-width: 100%;
            }
            #semilleroContent .col-md-4 {
                position: static;
                margin-top: 2rem;
            }
            #semilleroContent h1 { font-size: 1.35rem; }
            #semilleroContent h3 { font-size: 1.05rem; }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-ceai-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold ceai-brand" href="index.html" aria-label="CEAI SENA - Ir al inicio">
                <img
                    class="ceai-brand__logo"
                    src="https://i.postimg.cc/cHpqyBX5/Logo-sena.jpg"
                    alt="Logo SENA"
                    loading="lazy"
                    decoding="async"
                >
                <span class="ceai-brand__text">
                    <span style="color: var(--ceai-verde);">CEAI</span> SENA
                </span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link" href="innovacion.html">√Årea de Innovaci√≥n</a></li>
                    <li class="nav-item"><a class="nav-link" href="grupo-investigacion.html">Grupo de Investigaci√≥n</a></li>
                    <li class="nav-item"><a class="nav-link active" href="semilleros.html">Semilleros</a></li>
                    <li class="nav-item"><a class="nav-link" href="servicios.html">Servicios</a></li>
                    <li class="nav-item"><a class="nav-link" href="aliados.html">Aliados</a></li>
                    <li class="nav-item"><a class="nav-link" href="contacto.html">Contacto</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Contenido principal -->
    <main class="py-4">
        <div class="container">
            <button class="btn btn-outline-secondary btn-sm mb-3" onclick="window.history.back()">
                ‚Üê Volver
            </button>
            <div id="semilleroContent">
                <div class="text-center py-5">
                    <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p class="mt-3 text-muted" style="font-size:0.9rem;">Cargando semillero...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-ceai-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <h5 style="color: var(--ceai-verde); font-size:1rem;">CEAI SENA</h5>
                    <p class="small">√Årea de Innovaci√≥n y Competitividad - Regional Valle</p>
                </div>
                <div class="col-md-4 mb-3">
                    <h6 style="font-size:0.9rem;">Enlaces R√°pidos</h6>
                    <ul class="list-unstyled small">
                        <li><a href="index.html" class="text-white-50 text-decoration-none">Inicio</a></li>
                        <li><a href="contacto.html" class="text-white-50 text-decoration-none">Contacto</a></li>
                        <li><a href="#" class="text-white-50 text-decoration-none">Pol√≠tica de Privacidad</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-3">
                    <h6 style="font-size:0.9rem;">Enlaces Externos</h6>
                    <ul class="list-unstyled small">
                        <li><a href="https://www.sena.edu.co" target="_blank" class="text-white-50 text-decoration-none">SENA Colombia</a></li>
                        <li><a href="https://www.sena.edu.co/es-co/" target="_blank" class="text-white-50 text-decoration-none">Regional Valle</a></li>
                    </ul>
                </div>
            </div>
            <hr class="border-secondary">
            <p class="text-center small mb-0">&copy; 2026 CEAI SENA Regional Valle. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Modal detalle proyecto -->
    <div class="modal fade" id="detalleProyectoModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dp_titulo"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="dp_carrusel" class="position-relative mb-3" style="background:#f0f0f0; border-radius:10px; overflow:hidden;">
                        <img id="dp_carrusel_img" src="" class="w-100" style="object-fit:contain; max-height:60vh;">
                        <button class="dp-prev btn btn-light position-absolute top-50 start-0 translate-middle-y" style="opacity:.7;">&#10094;</button>
                        <button class="dp-next btn btn-light position-absolute top-50 end-0 translate-middle-y" style="opacity:.7;">&#10095;</button>
                        <div id="dp_dots" class="position-absolute bottom-0 start-50 translate-middle-x d-flex gap-1 mb-2"></div>
                    </div>
                    <div class="mb-2">
                        <span id="dp_estado" class="badge"></span>
                        <span id="dp_lider" class="badge bg-success"></span>
                        <span id="dp_apoyo" class="badge bg-info"></span>
                    </div>
                    <div id="dp_resumen" class="mb-3" style="font-size:0.95rem; color:#555;"></div>
                    <div class="mb-2"><strong>üìÑ Descripci√≥n completa</strong></div>
                    <div id="dp_objetivo" style="background:#f8f9fa; padding:12px; border-radius:8px; border-left:4px solid var(--ceai-verde); font-size:0.95rem; color:#333;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* estilos carousel modal */
        .dp-prev, .dp-next { width:36px; height:36px; border-radius:50%; }
        .dp-dot { width:8px; height:8px; border-radius:50%; background:rgba(255,255,255,.5); cursor:pointer; }
    </style>
    <script>
        const API = 'https://ceai-web-production.up.railway.app';

        async function cargarSemillero() {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            const categoria = urlParams.get('categoria');

            if (!id && !categoria) { mostrarError('No se especific√≥ un semillero'); return; }

            try {
                let semilleros = [];

                if (id) {
                    const response = await fetch(`${API}/api/semilleros/${id}`);
                    if (response.ok) {
                        const s = await response.json();
                        if (s) semilleros = [s];
                    }
                } else if (categoria) {
                    const response = await fetch(`${API}/api/semilleros/categoria/${encodeURIComponent(categoria)}`);
                    if (response.ok) semilleros = await response.json();
                }

                if (semilleros.length === 0) { mostrarError('Semillero no encontrado'); return; }
                if (semilleros.length > 1) {
                    mostrarListaSemilleros(semilleros, categoria);
                } else {
                    mostrarDetalleSemillero(semilleros[0]);
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarError('Error al cargar el semillero');
            }
        }

        function mostrarListaSemilleros(semilleros, categoria) {
            const container = document.getElementById('semilleroContent');
            container.innerHTML = `
                <h1 style="color: var(--ceai-azul);">${categoria || 'Semilleros'}</h1>
                <p class="text-muted" style="font-size:0.9rem; margin-bottom:1.5rem;">Selecciona un semillero para ver m√°s detalles</p>
                <div class="row">
                    ${semilleros.map(s => `
                        <div class="col-md-4 mb-4">
                            <div class="card h-100 shadow-sm" style="transition:transform .3s; border-radius:12px; border:none;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                                ${s.imagen ? `<img src="${s.imagen}" class="card-img-top" alt="${s.nombre}" style="height:190px;object-fit:cover;border-radius:12px 12px 0 0;">` : ''}
                                <div class="card-body p-3">
                                    <h5 class="card-title" style="color:var(--ceai-verde);font-size:0.95rem;">${s.nombre}</h5>
                                    <p class="card-text" style="font-size:0.83rem;">
                                        <strong>üìö L√≠nea:</strong> ${s.linea}<br>
                                        <strong>üéØ Enfoque:</strong> ${s.enfoque}
                                    </p>
                                    <p class="card-text text-muted" style="font-size:0.8rem;">${(s.descripcion||'').substring(0,100)}...</p>
                                </div>
                                <div class="card-footer bg-white border-top-0 px-3 pb-3">
                                    <a href="semillero-detalle.html?id=${s.id}" class="btn btn-ceai btn-sm w-100" style="font-size:0.85rem;">Ver detalles</a>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function mostrarDetalleSemillero(semillero) {
            const container = document.getElementById('semilleroContent');
            const proyectos = await cargarProyectos(semillero.id);
            const totalProyectos = proyectos.length;

            // Renderizar la descripci√≥n: si viene con HTML (de Quill), mostrarlo; si no, como texto
            const descHTML = semillero.descripcion && semillero.descripcion.trim().startsWith('<')
                ? semillero.descripcion
                : `<p>${semillero.descripcion || ''}</p>`;

            container.innerHTML = `
                <div class="row">
                    <div class="col-md-8">
                        <h1 style="color: var(--ceai-azul);">${semillero.nombre}</h1>
                        <div class="descripcion-content mb-3" style="font-size:0.95rem; line-height:1.7; color:#444;">${descHTML}</div>

                        <div class="info-semillero-card card">
                            <div class="card-body">
                                <h5 style="color:var(--ceai-verde);">üìã Informaci√≥n del Semillero</h5>
                                <ul class="list-unstyled mt-2 mb-0">
                                    <li class="mb-1"><strong>üìÇ Categor√≠a:</strong> <span class="badge bg-info" style="font-size:0.78rem;">${semillero.categoria || 'Sin categor√≠a'}</span></li>
                                    <li class="mb-1"><strong>üìö L√≠nea de Investigaci√≥n:</strong> ${semillero.linea}</li>
                                    <li><strong>üéØ Enfoque:</strong> ${semillero.enfoque}</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Secci√≥n Proyectos con toggle -->
                        <div class="mt-3">
                            <div class="d-flex align-items-center gap-3 mb-2">
                                <h3 style="color:var(--ceai-azul); margin:0;">üöÄ Proyectos</h3>
                                ${totalProyectos > 0 ? `
                                <button class="proyectos-toggle-btn" id="btnVerProyectos" onclick="toggleProyectos()">
                                    üìÇ Ver proyectos <span class="count-badge">${totalProyectos}</span>
                                </button>` : ''}
                            </div>

                            ${totalProyectos === 0
                                ? '<div class="alert alert-info py-2" style="font-size:0.88rem;"><strong>‚ÑπÔ∏è</strong> No hay proyectos registrados para este semillero.</div>'
                                : `<div id="proyectosListado">
                                    ${proyectos.map(p => {
                                        const badgeColor = p.estado === 'En ejecuci√≥n' ? '#0d6efd' : p.estado === 'Finalizado' ? '#198754' : '#ffc107';
                                        const badgeText = p.estado === 'Planeaci√≥n' ? '#333' : '#fff';
                                        return `<div class="proyecto-card">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h5 style="margin:0;">${p.titulo}</h5>
                                                <span class="estado-badge" style="background:${badgeColor}; color:${badgeText}; white-space:nowrap; margin-left:10px;">${p.estado}</span>
                                            </div>
                                            ${p.lider ? `<p style="margin:4px 0;"><strong>üë§ L√≠der:</strong> ${p.lider}</p>` : ''}
                                            ${p.apoyo_tecnico ? `<p style="margin:4px 0;"><strong>üîß Apoyo T√©cnico:</strong> ${p.apoyo_tecnico}</p>` : ''}
                                            ${p.resumen ? `<p style="margin:6px 0; color:#555; font-size:0.9rem;">${p.resumen.substring(0, 150)}${p.resumen.length > 150 ? '...' : ''}</p>` : ''}
                                            <button class="btn btn-sm btn-ceai mt-2" style="font-size:0.85rem;" onclick="mostrarDetalleProyecto(${JSON.stringify(p).replace(/"/g, '&quot;')})">Ver m√°s ‚Üí</button>
                                        </div>`;
                                    }).join('')}
                                </div>`
                            }
                        </div>
                    </div>

                    <div class="col-md-4">
                        ${semillero.imagen ? `<img src="${semillero.imagen}" class="img-fluid rounded shadow-sm mb-3" alt="${semillero.nombre}" style="border-radius:12px;">` : ''}

                        <div class="sidebar-card card">
                            <div class="card-body text-center">
                                <h5 style="color:var(--ceai-verde);">üí° ¬øTe interesa participar?</h5>
                                <p class="text-muted" style="font-size:0.83rem;">Si est√°s interesado en formar parte de este semillero, cont√°ctanos para m√°s informaci√≥n.</p>
                                <a href="contacto.html" class="btn btn-ceai w-100 mt-1" style="font-size:0.85rem;">Contactar</a>
                            </div>
                        </div>

                        <div class="sidebar-card card">
                            <div class="card-body">
                                <h6 style="color:var(--ceai-azul); font-size:0.88rem; font-weight:700;">üîó Enlaces √∫tiles</h6>
                                <ul class="list-unstyled mb-0">
                                    <li class="mb-1"><a href="semilleros.html" class="text-decoration-none" style="font-size:0.83rem;">üìö Ver todos los semilleros</a></li>
                                    <li class="mb-1"><a href="grupo-investigacion.html" class="text-decoration-none" style="font-size:0.83rem;">üë• Grupo de Investigaci√≥n</a></li>
                                    <li><a href="innovacion.html" class="text-decoration-none" style="font-size:0.83rem;">üí° √Årea de Innovaci√≥n</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function toggleProyectos() {
            const listado = document.getElementById('proyectosListado');
            const btn = document.getElementById('btnVerProyectos');
            if (!listado) return;
            const abierto = listado.classList.toggle('visible');
            btn.innerHTML = abierto
                ? `üìÇ Ocultar proyectos <span class="count-badge">${listado.querySelectorAll('.proyecto-card').length}</span>`
                : `üìÇ Ver proyectos <span class="count-badge">${listado.querySelectorAll('.proyecto-card').length}</span>`;
        }

        async function cargarProyectos(semilleroId) {
            try {
                const response = await fetch(`${API}/api/proyectos/semillero/${semilleroId}`);
                if (response.ok) return await response.json();
                return [];
            } catch (error) {
                console.error('Error cargando proyectos:', error);
                return [];
            }
        }

        function mostrarError(mensaje) {
            const container = document.getElementById('semilleroContent');
            container.innerHTML = `
                <div class="text-center py-5">
                    <div style="font-size:3rem; color:var(--ceai-verde);">üîç</div>
                    <h2 class="mt-3" style="color:var(--ceai-azul); font-size:1.3rem;">Semillero no encontrado</h2>
                    <p class="text-muted" style="font-size:0.9rem;">${mensaje}</p>
                    <a href="semilleros.html" class="btn btn-ceai mt-3" style="font-size:0.9rem;">‚Üê Ver todos los semilleros</a>
                </div>
            `;
        }

        // Modal para ver detalle de proyecto
        // ==== nueva funci√≥n para mostrar detalle usando modal Bootstrap ====
        function mostrarDetalleProyecto(proyecto) {
            // etiquetas de datos
            document.getElementById('dp_titulo').textContent = proyecto.titulo;
            document.getElementById('dp_estado').textContent = proyecto.estado;
            document.getElementById('dp_estado').className = 'badge ' +
                (proyecto.estado === 'En ejecuci√≥n' ? 'bg-primary' : proyecto.estado === 'Finalizado' ? 'bg-success' : 'bg-warning text-dark');
            document.getElementById('dp_lider').textContent = proyecto.lider ? `L√≠der del proyecto: ${proyecto.lider}` : '';
            document.getElementById('dp_apoyo').textContent = proyecto.apoyo_tecnico ? `Apoyo t√©cnico: ${proyecto.apoyo_tecnico}` : '';
            document.getElementById('dp_resumen').textContent = proyecto.resumen || '';
            document.getElementById('dp_objetivo').innerHTML = proyecto.objetivo || '';

            // im√°genes para carrusel
            dp_imagenes_actual = (proyecto.imagenes || '').split('|').filter(x => x.trim());
            dp_indice_actual = 0;
            actualizarCarrusel();

            // mostrar modal
            new bootstrap.Modal(document.getElementById('detalleProyectoModal')).show();
        }

        let dp_imagenes_actual = [];
        let dp_indice_actual = 0;

        function actualizarCarrusel() {
            const imgEl = document.getElementById('dp_carrusel_img');
            const dots = document.getElementById('dp_dots');
            const prevBtn = document.querySelector('#dp_carrusel .dp-prev');
            const nextBtn = document.querySelector('#dp_carrusel .dp-next');
            if (!imgEl || !dots) return;
            if (dp_imagenes_actual.length === 0) {
                imgEl.src = '';
                dots.innerHTML = '';
                return;
            }
            imgEl.src = dp_imagenes_actual[dp_indice_actual];
            dots.innerHTML = dp_imagenes_actual.map((_, i) =>
                `<span class="dp-dot" data-idx="${i}"></span>`
            ).join('');
            document.querySelectorAll('.dp-dot').forEach(dot => {
                const idx = parseInt(dot.getAttribute('data-idx'));
                dot.style.background = idx === dp_indice_actual ? 'white' : 'rgba(255,255,255,.5)';
                dot.onclick = () => { dp_indice_actual = idx; actualizarCarrusel(); };
            });
            if (prevBtn) prevBtn.onclick = dp_prevImagen;
            if (nextBtn) nextBtn.onclick = dp_nextImagen;
        }

        function dp_prevImagen() {
            if (dp_imagenes_actual.length === 0) return;
            dp_indice_actual = (dp_indice_actual - 1 + dp_imagenes_actual.length) % dp_imagenes_actual.length;
            actualizarCarrusel();
        }

        function dp_nextImagen() {
            if (dp_imagenes_actual.length === 0) return;
            dp_indice_actual = (dp_indice_actual + 1) % dp_imagenes_actual.length;
            actualizarCarrusel();
        }

        document.addEventListener('DOMContentLoaded', cargarSemillero);
    </script>
</body>
</html>