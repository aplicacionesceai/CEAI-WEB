<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo - CEAI SENA</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Estilos CEAI -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* ====================================
           ADMIN PANEL FUTURISTA - CEAI 2.0
           ==================================== */
        
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-family: 'Roboto', sans-serif;
            overflow-x: hidden;
        }

        /* ========== SIDEBAR FUTURISTA ========== */
        .sidebar {
            background: linear-gradient(180deg, var(--ceai-azul) 0%, var(--ceai-azul-dark) 100%);
            color: white;
            min-height: 100vh;
            padding: 25px 20px;
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transition: all 0.3s ease;
            overflow-y: auto;
        }

        .sidebar-header {
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(57, 169, 0, 0.3);
            margin-bottom: 25px;
        }

        .sidebar-header h4 {
            color: white;
            font-weight: 800;
            font-size: 1.6rem;
            margin: 0;
            letter-spacing: -0.5px;
        }

        .sidebar-header span {
            color: var(--ceai-verde);
            text-shadow: 0 0 15px rgba(57, 169, 0, 0.6);
            animation: pulseGlow 2s ease infinite;
        }

        @keyframes pulseGlow {
            0%, 100% { text-shadow: 0 0 15px rgba(57, 169, 0, 0.6); }
            50% { text-shadow: 0 0 25px rgba(57, 169, 0, 0.9); }
        }

        .sidebar h5 {
            color: var(--ceai-verde);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 15px;
            margin-top: 20px;
            font-weight: 700;
        }

        .sidebar-link {
            color: rgba(255, 255, 255, 0.75);
            margin-bottom: 8px;
            cursor: pointer;
            border-radius: 12px;
            padding: 14px 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }

        .sidebar-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--ceai-verde);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .sidebar-link:hover,
        .sidebar-link.active {
            background: linear-gradient(90deg, var(--ceai-verde) 0%, var(--ceai-verde-light) 100%);
            color: white;
            transform: translateX(6px);
            box-shadow: 0 4px 20px rgba(57, 169, 0, 0.5);
        }

        .sidebar-link:hover::before,
        .sidebar-link.active::before {
            transform: scaleY(1);
        }

        .sidebar-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ========== CONTENIDO PRINCIPAL ========== */
        .content-wrapper {
            margin-left: 280px;
            padding: 35px;
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        .content-section {
            display: none;
            animation: fadeInContent 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeInContent {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ========== HEADERS DE SECCI√ìN ========== */
        .section-header {
            background: linear-gradient(135deg, white 0%, #f8f9fa 100%);
            border-radius: 18px;
            padding: 28px 35px;
            margin-bottom: 35px;
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.1);
            border-left: 6px solid var(--ceai-verde);
        }

        .section-header h2 {
            color: var(--ceai-azul);
            font-weight: 800;
            margin: 0;
            font-size: 1.9rem;
        }

        .section-header p {
            margin: 8px 0 0 0;
            color: #6c757d;
        }

        /* ========== CARDS MODERNOS ========== */
        .modern-card {
            background: white;
            border-radius: 18px;
            padding: 28px;
            margin-bottom: 28px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.09);
            border: 1px solid rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .modern-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--ceai-verde), var(--ceai-verde-light));
        }

        .modern-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.14);
        }

        /* ========== STATS CARDS ========== */
        .stat-card {
            background: linear-gradient(135deg, var(--ceai-verde) 0%, var(--ceai-verde-light) 100%);
            color: white;
            border-radius: 18px;
            padding: 28px;
            text-align: center;
            transition: all 0.4s ease;
            border: none;
            box-shadow: 0 6px 20px rgba(57, 169, 0, 0.35);
            position: relative;
            overflow: hidden;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        .stat-card:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: 0 15px 40px rgba(57, 169, 0, 0.5);
        }

        .stat-card h5 {
            color: rgba(255, 255, 255, 0.95);
            font-size: 0.95rem;
            margin-bottom: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card h3 {
            color: white;
            font-size: 2.8rem;
            font-weight: 900;
            margin: 0;
            text-shadow: 0 3px 15px rgba(0, 0, 0, 0.25);
        }

        .stat-card.variant-azul {
            background: linear-gradient(135deg, var(--ceai-azul) 0%, var(--ceai-azul-light) 100%);
            box-shadow: 0 6px 20px rgba(0, 48, 77, 0.35);
        }

        .stat-card.variant-azul:hover {
            box-shadow: 0 15px 40px rgba(0, 48, 77, 0.5);
        }

        /* ========== FORMULARIOS ========== */
        .form-section {
            background: white;
            padding: 35px;
            border-radius: 18px;
            margin-bottom: 35px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.09);
            border-top: 5px solid var(--ceai-verde);
        }

        .form-section h5 {
            color: var(--ceai-azul);
            font-weight: 700;
            margin-bottom: 28px;
            font-size: 1.3rem;
        }

        /* ========== TABLAS ========== */
        .table-responsive {
            background: white;
            border-radius: 18px;
            padding: 28px;
            margin-top: 28px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.09);
        }

        .table-responsive h5 {
            color: var(--ceai-azul);
            font-weight: 700;
            margin-bottom: 22px;
            font-size: 1.2rem;
        }

        .table thead th {
            border-top: none;
            border-bottom: 3px solid var(--ceai-verde);
            color: var(--ceai-azul);
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.8px;
            padding: 15px;
        }

        .table tbody tr {
            transition: all 0.25s ease;
        }

        .table tbody tr:hover {
            background-color: rgba(57, 169, 0, 0.06);
            transform: scale(1.01);
        }

        /* ========== MODAL MEJORADO ========== */
        .modal-content {
            border-radius: 18px;
            border: none;
            box-shadow: 0 15px 60px rgba(0, 0, 0, 0.25);
        }

        .modal-header {
            background: linear-gradient(90deg, var(--ceai-verde) 0%, var(--ceai-verde-light) 100%);
            color: white;
            border-radius: 18px 18px 0 0;
            border: none;
            padding: 20px 30px;
        }

        .modal-header .btn-close {
            filter: brightness(0) invert(1);
        }

        #detalleMensaje {
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: break-word;
            max-height: 280px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 18px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        /* ========== ACCIONES R√ÅPIDAS ========== */
        .quick-actions {
            background: linear-gradient(135deg, var(--ceai-azul) 0%, var(--ceai-azul-light) 100%);
            color: white;
            border-radius: 18px;
            padding: 28px;
            box-shadow: 0 6px 25px rgba(0, 48, 77, 0.35);
        }

        .quick-actions h5 {
            color: var(--ceai-verde);
            margin-bottom: 18px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .quick-actions .btn {
            margin: 6px;
        }

        /* ========== HAMBURGER MENU ========== */
        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 22px;
            left: 22px;
            z-index: 1100;
            background: var(--ceai-verde);
            color: white;
            border: none;
            padding: 14px 17px;
            border-radius: 12px;
            font-size: 1.3rem;
            box-shadow: 0 6px 20px rgba(57, 169, 0, 0.45);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            background: var(--ceai-verde-oscuro);
            transform: scale(1.12);
            box-shadow: 0 8px 25px rgba(57, 169, 0, 0.6);
        }

        /* ========== OVERLAY MOBILE ========== */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(4px);
        }

        .sidebar-overlay.show {
            display: block;
            opacity: 1;
        }

        /* ========== SCROLLBAR PERSONALIZADO ========== */
        .sidebar::-webkit-scrollbar {
            width: 7px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--ceai-verde);
            border-radius: 10px;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .content-wrapper {
                margin-left: 0;
                padding: 85px 22px 22px;
            }

            .sidebar-toggle {
                display: block;
            }

            .section-header h2 {
                font-size: 1.5rem;
            }

            .stat-card h3 {
                font-size: 2.2rem;
            }
        }

        @media (max-width: 576px) {
            .content-wrapper {
                padding: 85px 15px 15px;
            }

            .section-header {
                padding: 22px;
            }

            .section-header h2 {
                font-size: 1.3rem;
            }

            .stat-card {
                padding: 22px;
                margin-bottom: 18px;
            }

            .stat-card h3 {
                font-size: 2rem;
            }

            .modern-card {
                padding: 18px;
                margin-bottom: 18px;
            }

            .form-section {
                padding: 18px;
            }

            .table-responsive {
                padding: 18px;
                overflow-x: auto;
            }

            .quick-actions .btn {
                width: 100%;
                margin: 6px 0;
            }

            .table {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <script>
        if (localStorage.getItem('ceai_admin_logged') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>

    <!-- ========== SISTEMA DE SESI√ìN CON TEMPORIZADOR (COMPACTO) ========== -->
    <style>
        /* ========== CUADRO DE SESI√ìN COMPACTO (Esquina superior derecha) ========== */
        .session-box {
            position: fixed;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, var(--ceai-azul) 0%, var(--ceai-azul-dark) 100%);
            color: white;
            padding: 12px 18px;
            border-radius: 12px;
            z-index: 1050;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-width: 160px;
        }

        .session-box.warning {
            background: linear-gradient(135deg, #ff6b6b 0%, #c92a2a 100%);
            animation: pulseWarning 1s ease infinite;
        }

        @keyframes pulseWarning {
            0%, 100% { 
                box-shadow: 0 4px 20px rgba(255, 107, 107, 0.5);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 6px 30px rgba(255, 107, 107, 0.8);
                transform: scale(1.02);
            }
        }

        .session-timer-compact {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .timer-icon-compact {
            font-size: 1.2rem;
            animation: tickTock 1s ease-in-out infinite;
        }

        @keyframes tickTock {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(15deg); }
        }

        .timer-display-compact {
            font-family: 'Courier New', monospace;
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: 1px;
            text-align: center;
            color: white;
        }

        .btn-extend-compact {
            background: var(--ceai-verde);
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            width: 100%;
            justify-content: center;
        }

        .btn-extend-compact:hover {
            background: var(--ceai-verde-oscuro);
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(57, 169, 0, 0.5);
        }

        .warning-text-compact {
            font-size: 0.7rem;
            font-weight: 600;
            text-align: center;
            color: white;
            margin-top: 2px;
        }

        /* Responsive para mobile */
        @media (max-width: 992px) {
            .session-box {
                top: 70px;
                right: 15px;
                left: auto;
            }
        }

        @media (max-width: 576px) {
            .session-box {
                top: 70px;
                right: 10px;
                min-width: 140px;
                padding: 10px 14px;
            }

            .timer-display-compact {
                font-size: 1.2rem;
            }
        }
    </style>

    <!-- ‚úÖ CUADRO DE SESI√ìN COMPACTO (Esquina superior derecha) -->
    <div class="session-box" id="sessionBox">
        <div class="session-timer-compact">
            <span class="timer-icon-compact">‚è±Ô∏è</span>
        </div>
        <div class="timer-display-compact" id="timerDisplay">05:00</div>
        <div id="warningMessage" class="warning-text-compact" style="display: none;">
            ‚ö†Ô∏è Expirando
        </div>
        <button class="btn-extend-compact" id="btnExtend" onclick="extenderSesion()">
            üîÑ Extender
        </button>
    </div>

    <script>
        // ========== CONFIGURACI√ìN DE SESI√ìN ==========
        const SESSION_TIMEOUT = 5 * 60; // 5 minutos en segundos
        const WARNING_TIME = 2 * 60; // Advertencia a los 2 minutos
        let sessionTimer = SESSION_TIMEOUT;
        let sessionInterval = null;
        let lastActivity = Date.now();

        // ========== INICIAR SESI√ìN ==========
        function iniciarSesion() {
            sessionTimer = SESSION_TIMEOUT;
            lastActivity = Date.now();
            
            if (sessionInterval) clearInterval(sessionInterval);
            
            sessionInterval = setInterval(() => {
                sessionTimer--;
                actualizarDisplay();
                
                if (sessionTimer <= 0) {
                    expirarSesion();
                } else if (sessionTimer <= WARNING_TIME) {
                    mostrarAdvertencia();
                } else {
                    ocultarAdvertencia();
                }
            }, 1000);
            
            actualizarDisplay();
            ocultarAdvertencia();
        }

        // ========== ACTUALIZAR DISPLAY ==========
        function actualizarDisplay() {
            const minutos = Math.floor(sessionTimer / 60);
            const segundos = sessionTimer % 60;
            const display = `${String(minutos).padStart(2, '0')}:${String(segundos).padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = display;
        }

        // ========== MOSTRAR/OCULTAR ADVERTENCIA ==========
        function mostrarAdvertencia() {
            const box = document.getElementById('sessionBox');
            const warning = document.getElementById('warningMessage');
            box.classList.add('warning');
            warning.style.display = 'block';
        }

        function ocultarAdvertencia() {
            const box = document.getElementById('sessionBox');
            const warning = document.getElementById('warningMessage');
            box.classList.remove('warning');
            warning.style.display = 'none';
        }

        // ========== EXTENDER SESI√ìN ==========
        function extenderSesion() {
            sessionTimer = SESSION_TIMEOUT;
            lastActivity = Date.now();
            ocultarAdvertencia();
            
            // Mostrar notificaci√≥n
            if (typeof toast !== 'undefined') {
                toast.success('‚è±Ô∏è Sesi√≥n extendida por 5 minutos m√°s');
            } else {
                console.log('‚è±Ô∏è Sesi√≥n extendida por 5 minutos m√°s');
            }
        }

        // ========== EXPIRAR SESI√ìN ==========
        function expirarSesion() {
            clearInterval(sessionInterval);
            localStorage.removeItem('ceai_admin_logged');
            alert('‚è∞ Tu sesi√≥n ha expirado por inactividad.\n\nSer√°s redirigido al login.');
            window.location.href = 'login.html';
        }

        // ========== DETECTAR ACTIVIDAD DEL USUARIO ==========
        const actividades = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
        
        actividades.forEach(evento => {
            document.addEventListener(evento, () => {
                const ahora = Date.now();
                // Solo extender si ha pasado al menos 10 segundos desde √∫ltima actividad
                if (ahora - lastActivity > 10000) {
                    lastActivity = ahora;
                    // Extender autom√°ticamente si quedan menos de 2 minutos
                    if (sessionTimer < WARNING_TIME && sessionTimer > 0) {
                        sessionTimer = SESSION_TIMEOUT;
                        ocultarAdvertencia();
                    }
                }
            }, true);
        });

        // ========== INICIAR AL CARGAR ==========
        window.addEventListener('DOMContentLoaded', () => {
            iniciarSesion();
        });
    </script>

    <!-- Overlay para mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Bot√≥n toggle mobile -->
    <button class="sidebar-toggle" id="sidebarToggle">‚ò∞</button>

    <div class="d-flex">
        <!-- ========== SIDEBAR ========== -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h4 class="fw-bold">
                    <span>CEAI</span> Admin
                </h4>
            </div>
            
            <h5>üìã Men√∫ Principal</h5>
            <div class="sidebar-link active" data-section="dashboard">
                <span>üìä</span> Dashboard
            </div>
            <div class="sidebar-link" data-section="noticias">
                <span>üì∞</span> Noticias
            </div>
            <div class="sidebar-link" data-section="semilleros">
                <span>üå±</span> Semilleros
            </div>
            <div class="sidebar-link" data-section="proyectos">
                <span>üî¨</span> Proyectos
            </div>
            <div class="sidebar-link" data-section="documentos">
                <span>üìÑ</span> Documentos
            </div>
            <div class="sidebar-link" data-section="contactos">
                <span>üì®</span> Contactos
            </div>
            
            <div class="sidebar-footer">
                <button class="btn btn-outline-light btn-sm w-100 mb-2"
                        onclick="localStorage.removeItem('ceai_admin_logged'); window.location.href='login.html';">
                    üö™ Cerrar sesi√≥n
                </button>
                <a href="index.html" class="btn btn-outline-light btn-sm w-100">
                    ‚Üê Volver al sitio
                </a>
            </div>
        </div>

        <!-- ========== CONTENIDO PRINCIPAL ========== -->
        <div class="content-wrapper" id="contentWrapper">

            <!-- ========== DASHBOARD ========== -->
            <div id="dashboard" class="content-section active">
                <div class="section-header">
                    <h2>üìä Panel de Control</h2>
                    <p class="mb-0">Vista general del sistema CEAI</p>
                </div>

                <!-- Stats Cards -->
                <div class="row">
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="stat-card">
                            <h5>üì∞ Noticias</h5>
                            <h3 id="countNoticias">0</h3>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="stat-card variant-azul">
                            <h5>üå± Semilleros</h5>
                            <h3 id="countSemilleros">0</h3>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="stat-card">
                            <h5>üî¨ Proyectos</h5>
                            <h3 id="countProyectos">0</h3>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="stat-card variant-azul">
                            <h5>üìÑ Documentos</h5>
                            <h3 id="countDocumentos">0</h3>
                        </div>
                    </div>
                </div>

                <!-- Acciones R√°pidas -->
                <div class="quick-actions mb-4">
                    <h5>‚ö° Acciones R√°pidas</h5>
                    <div class="d-flex flex-wrap gap-2">
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('noticias')">+ Nueva noticia</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('semilleros')">+ Nuevo semillero</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('proyectos')">+ Nuevo proyecto</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('documentos')">+ Subir documento</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('contactos')">üì® Ver contactos</button>
                    </div>
                </div>

                <!-- Gr√°ficos -->
                <div class="row">
                    <div class="col-lg-6 mb-4">
                        <div class="modern-card">
                            <h5 class="mb-3">Distribuci√≥n de Contenido</h5>
                            <canvas id="chartContenido"></canvas>
                        </div>
                    </div>
                    <div class="col-lg-6 mb-4">
                        <div class="modern-card">
                            <h5 class="mb-3">Mensajes de Contacto</h5>
                            <canvas id="chartContactos"></canvas>
                        </div>
                    </div>
                </div>

                <!-- √öltimos registros -->
                <div class="row">
                    <div class="col-lg-6 mb-4">
                        <div class="modern-card">
                            <h5 class="mb-3">√öltimas Noticias</h5>
                            <ul id="ultimasNoticias" class="list-group list-group-flush"></ul>
                        </div>
                    </div>
                    <div class="col-lg-6 mb-4">
                        <div class="modern-card">
                            <h5 class="mb-3">√öltimos Contactos</h5>
                            <ul id="ultimosContactos" class="list-group list-group-flush"></ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== NOTICIAS ========== -->
            <div id="noticias" class="content-section">
                <div class="section-header">
                    <h2>üì∞ Gestionar Noticias</h2>
                </div>
                
                <div class="form-section">
                    <h5>Nueva Noticia</h5>
                    <form id="formNoticia">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">T√≠tulo</label>
                                <input type="text" class="form-control" id="noticiaTitulo" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Fecha</label>
                                <input type="date" class="form-control" id="noticiaFecha" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Tipo</label>
                                <select class="form-control" id="noticiaTipo" required>
                                    <option value="Noticia">Noticia</option>
                                    <option value="Evento">Evento</option>
                                    <option value="Convocatoria">Convocatoria</option>
                                    <option value="Resultado">Resultado</option>
                                </select>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Descripci√≥n</label>
                                <textarea class="form-control" id="noticiaDescripcion" rows="3" required></textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">URL Imagen</label>
                                <input type="url" class="form-control" id="noticiaImagen" placeholder="https://...">
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check mt-4">
                                    <input class="form-check-input" type="checkbox" id="noticiaDestacada">
                                    <label class="form-check-label" for="noticiaDestacada">
                                        ‚≠ê Destacar en carousel del home
                                    </label>
                                </div>
                            </div>
                            <div class="col-12 mb-3">
                                <button type="submit" class="btn btn-ceai w-100">Crear Noticia</button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="table-responsive">
                    <h5 class="mb-3">Noticias Existentes</h5>
                    <div id="listaNoticias"></div>
                </div>
            </div>

            <!-- ========== SEMILLEROS ========== -->
            <div id="semilleros" class="content-section">
                <div class="section-header">
                    <h2>üå± Gestionar Semilleros</h2>
                </div>
                
                <div class="form-section">
                    <h5>Nuevo Semillero</h5>
                    <form id="formSemillero">
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Categor√≠a / Servicio</label>
                                <select class="form-control" id="semilleroCategoria" required>
                                    <option value="Soluciones Digitales">Soluciones Digitales</option>
                                    <option value="Automatizaci√≥n e Instrumentaci√≥n">Automatizaci√≥n e Instrumentaci√≥n</option>
                                    <option value="F√°brica Digital Interactiva">F√°brica Digital Interactiva</option>
                                    <option value="Gesti√≥n Energ√©tica">Gesti√≥n Energ√©tica</option>
                                    <option value="IA Aplicada al Entorno">IA Aplicada al Entorno</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombre</label>
                                <input type="text" class="form-control" id="semilleroNombre" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">L√≠nea de Investigaci√≥n</label>
                                <input type="text" class="form-control" id="semilleroLinea" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Enfoque</label>
                                <input type="text" class="form-control" id="semilleroEnfoque" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">URL Imagen</label>
                                <input type="url" class="form-control" id="semilleroImagen" placeholder="https://...">
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Descripci√≥n</label>
                                <textarea class="form-control" id="semilleroDescripcion" rows="3" required></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <button type="submit" class="btn btn-ceai w-100">Crear Semillero</button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="table-responsive">
                    <h5 class="mb-3">Semilleros Existentes</h5>
                    <div id="listaSemilleros"></div>
                </div>
            </div>

            <!-- ========== PROYECTOS ========== -->
            <div id="proyectos" class="content-section">
                <div class="section-header">
                    <h2>üî¨ Gestionar Proyectos</h2>
                </div>
                
                <div class="form-section">
                    <h5>Nuevo Proyecto</h5>
                    <form id="formProyecto">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Categor√≠a / Servicio</label>
                                <select class="form-control" id="proyectoCategoria" required>
                                    <option value="">-- Seleccionar categor√≠a --</option>
                                    <option value="Soluciones Digitales">Soluciones Digitales</option>
                                    <option value="Automatizaci√≥n e Instrumentaci√≥n">Automatizaci√≥n e Instrumentaci√≥n</option>
                                    <option value="F√°brica Digital Interactiva">F√°brica Digital Interactiva</option>
                                    <option value="Gesti√≥n Energ√©tica">Gesti√≥n Energ√©tica</option>
                                    <option value="IA Aplicada al Entorno">IA Aplicada al Entorno</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Semillero</label>
                                <select class="form-control" id="proyectoSemillero" required disabled>
                                    <option value="">-- Selecciona categor√≠a primero --</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">T√≠tulo</label>
                                <input type="text" class="form-control" id="proyectoTitulo" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Estado</label>
                                <select class="form-control" id="proyectoEstado" required>
                                    <option value="En ejecuci√≥n">En ejecuci√≥n</option>
                                    <option value="Finalizado">Finalizado</option>
                                    <option value="En revisi√≥n">En revisi√≥n</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Aliados</label>
                                <input type="text" class="form-control" id="proyectoAliados">
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Objetivo</label>
                                <textarea class="form-control" id="proyectoObjetivo" rows="2"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Entregables</label>
                                <textarea class="form-control" id="proyectoEntregables" rows="2"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Evidencia</label>
                                <textarea class="form-control" id="proyectoEvidencia" rows="2"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <button type="submit" class="btn btn-ceai w-100">Crear Proyecto</button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="table-responsive">
                    <h5 class="mb-3">Proyectos Existentes</h5>
                    <div id="listaProyectos"></div>
                </div>
            </div>

            <!-- ========== DOCUMENTOS ========== -->
            <div id="documentos" class="content-section">
                <div class="section-header">
                    <h2>üìÑ Gestionar Documentos</h2>
                </div>
                
                <div class="form-section">
                    <h5>Nuevo Documento</h5>
                    <form id="formDocumento" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombre del Documento</label>
                                <input type="text" class="form-control" id="docNombre" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Tipo</label>
                                <select class="form-control" id="docTipo" required>
                                    <option value="">-- Seleccionar --</option>
                                    <option value="Convocatoria">Convocatoria</option>
                                    <option value="Portafolio">Portafolio de Servicios</option>
                                    <option value="Informe">Informe</option>
                                    <option value="Manual">Manual</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Descripci√≥n</label>
                                <textarea class="form-control" id="docDescripcion" rows="2"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Archivo PDF</label>
                                <div id="dropZone" class="border-2 border-dashed rounded p-5 text-center" style="border: 2px dashed var(--ceai-verde); cursor: pointer; transition: all 0.3s;">
                                    <input type="file" id="docArchivo" class="form-control d-none" accept=".pdf" required>
                                    <div id="dropText">
                                        <p style="margin: 0; color: var(--ceai-verde); font-weight: bold;">üìÅ Arrastra tu PDF aqu√≠</p>
                                        <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">o haz clic para seleccionar</p>
                                    </div>
                                    <div id="fileSelected" style="display: none; color: var(--ceai-verde);">
                                        <p style="margin: 0; font-weight: bold;">‚úÖ Archivo listo:</p>
                                        <p id="fileName" style="margin: 5px 0 0 0;"></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 mb-3">
                                <button type="submit" class="btn btn-ceai w-100">Agregar Documento</button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="table-responsive">
                    <h5 class="mb-3">Documentos Existentes</h5>
                    <div id="listaDocumentos"></div>
                </div>
            </div>

            <!-- ========== CONTACTOS ========== -->
            <div id="contactos" class="content-section">
                <div class="section-header">
                    <h2>üì® Mensajes de Contacto</h2>
                </div>
                
                <div class="table-responsive">
                    <h5 class="mb-3">Mensajes Recibidos</h5>
                    <div id="listaContactos"></div>
                </div>
            </div>

        </div>
    </div>

    <!-- Modal Detalle Contacto -->
    <div class="modal fade" id="contactoModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detalle del Contacto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-3">Nombre</dt>
                        <dd class="col-sm-9" id="detalleNombre"></dd>

                        <dt class="col-sm-3">Email</dt>
                        <dd class="col-sm-9" id="detalleEmail"></dd>

                        <dt class="col-sm-3">Asunto</dt>
                        <dd class="col-sm-9" id="detalleAsunto"></dd>

                        <dt class="col-sm-3">Fecha</dt>
                        <dd class="col-sm-9" id="detalleFecha"></dd>

                        <dt class="col-sm-3">Mensaje</dt>
                        <dd class="col-sm-9">
                            <div id="detalleMensaje"></div>
                        </dd>
                    </dl>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/toasts.js"></script>

    <script>
        const API = 'https://ceai-web-production.up.railway.app';
        let chartContenidoRef = null;
        let chartContactosRef = null;
        let contactosCache = [];
        let todosLosSemilleros = [];

        // ========== TOGGLE SIDEBAR MOBILE ==========
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('show');
            sidebarOverlay.classList.toggle('show');
        });

        sidebarOverlay.addEventListener('click', () => {
            sidebar.classList.remove('show');
            sidebarOverlay.classList.remove('show');
        });

        // Cerrar sidebar en mobile al hacer clic en un link
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 992) {
                    sidebar.classList.remove('show');
                    sidebarOverlay.classList.remove('show');
                }
            });
        });

        // ========== NAVEGACI√ìN ==========
        function irSeccion(id) {
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.sidebar-link').forEach(el => el.classList.remove('active'));
            document.querySelector(`.sidebar-link[data-section="${id}"]`).classList.add('active');

            if (id === 'noticias') cargarNoticias();
            if (id === 'semilleros') cargarSemilleros();
            if (id === 'proyectos') cargarProyectos();
            if (id === 'documentos') cargarDocumentos();
            if (id === 'contactos') cargarContactos();
            if (id === 'dashboard') cargarDashboard();
        }

        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', () => irSeccion(link.dataset.section));
        });

        // ========== DASHBOARD ==========
        async function cargarDashboard() {
            const noticias   = await fetch(`${API}/api/noticias`).then(r => r.json());
            const semilleros = await fetch(`${API}/api/semilleros`).then(r => r.json());
            const proyectos  = await fetch(`${API}/api/proyectos`).then(r => r.json());
            const documentos = await fetch(`${API}/api/documentos`).then(r => r.json());
            const contactos  = await fetch(`${API}/api/contactos`).then(r => r.json());
            
            document.getElementById('countNoticias').textContent   = noticias.length;
            document.getElementById('countSemilleros').textContent = semilleros.length;
            document.getElementById('countProyectos').textContent  = proyectos.length;
            document.getElementById('countDocumentos').textContent = documentos.length;

            // Gr√°fico de contenido
            const ctx1 = document.getElementById('chartContenido').getContext('2d');
            if (chartContenidoRef) chartContenidoRef.destroy();

            chartContenidoRef = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['Noticias', 'Semilleros', 'Proyectos', 'Documentos'],
                    datasets: [{
                        data: [noticias.length, semilleros.length, proyectos.length, documentos.length],
                        backgroundColor: ['#39A900', '#2d8a00', '#00304D', '#76c043']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    }
                }
            });

            // Gr√°fico de contactos por d√≠a
            const porDia = {};
            contactos.forEach(c => {
                if (!c.created_at) return;
                const d = new Date(c.created_at);
                const key = d.toLocaleDateString('es-ES');
                porDia[key] = (porDia[key] || 0) + 1;
            });
            const labels = Object.keys(porDia);
            const valores = Object.values(porDia);

            const ctx2 = document.getElementById('chartContactos').getContext('2d');
            if (chartContactosRef) chartContactosRef.destroy();

            chartContactosRef = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        data: valores,
                        borderColor: '#39A900',
                        backgroundColor: 'rgba(57,169,0,0.2)',
                        tension: 0.3,
                        fill: true,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    }
                }
            });

            // √öltimas noticias
            const ulNoticias = document.getElementById('ultimasNoticias');
            ulNoticias.innerHTML = noticias
                .slice(-5)
                .reverse()
                .map(n => `<li class="list-group-item d-flex justify-content-between align-items-center"><span>${n.titulo}</span> <span class="text-muted ms-2">${n.fecha}</span></li>`)
                .join('');

            // √öltimos contactos
            const ulContactos = document.getElementById('ultimosContactos');
            ulContactos.innerHTML = contactos
                .slice(-5)
                .reverse()
                .map(c => `<li class="list-group-item d-flex justify-content-between align-items-center"><span>${c.nombre}</span> <span class="text-muted ms-2">${c.created_at ? new Date(c.created_at).toLocaleDateString('es-ES') : ''}</span></li>`)
                .join('');
        }

        // ========== NOTICIAS ==========
        async function cargarNoticias() {
            const response = await fetch(`${API}/api/noticias`);
            const noticias = await response.json();

            const lista = document.getElementById('listaNoticias');
            if (!noticias.length) {
                lista.innerHTML = '<p class="text-muted">No hay noticias a√∫n</p>';
                return;
            }

            lista.innerHTML = `
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>T√≠tulo</th>
                            <th>Fecha</th>
                            <th>Tipo</th>
                            <th>Destacada</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${noticias.map(n => `
                            <tr>
                                <td>${n.id}</td>
                                <td>${n.titulo}</td>
                                <td>${n.fecha}</td>
                                <td>${n.tipo || 'Noticia'}</td>
                                <td>${n.destacada == 1 ? '‚≠ê' : ''}</td>
                                <td>
                                    <button class="btn btn-sm btn-danger" onclick="eliminarNoticia(${n.id})">Eliminar</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        document.getElementById('formNoticia').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const datos = {
                titulo: document.getElementById('noticiaTitulo').value,
                descripcion: document.getElementById('noticiaDescripcion').value,
                fecha: document.getElementById('noticiaFecha').value,
                imagen: document.getElementById('noticiaImagen').value,
                tipo: document.getElementById('noticiaTipo').value,
                destacada: document.getElementById('noticiaDestacada').checked ? 1 : 0
            };

            const response = await fetch(`${API}/api/noticias`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(datos)
            });

            if (response.ok) {
                toast.success('Noticia creada correctamente');
                document.getElementById('formNoticia').reset();
                cargarNoticias();
                cargarDashboard();
            } else {
                const error = await response.json();
                toast.error('Error al crear noticia: ' + error.error);
            }
        });

        async function eliminarNoticia(id) {
            if (!confirm('¬øEliminar esta noticia?')) return;
            
            const res = await fetch(`${API}/api/noticias/${id}`, { method: 'DELETE' });
            if (res.ok) {
                toast.info('Noticia eliminada');
                cargarNoticias();
                cargarDashboard();
            } else {
                toast.error('Error al eliminar noticia');
            }
        }

        // ========== SEMILLEROS ==========
        async function cargarSemilleros() {
            const response = await fetch(`${API}/api/semilleros`);
            const semilleros = await response.json();
            todosLosSemilleros = semilleros;

            // Listener para filtrar por categor√≠a en proyectos
            const categoriaSelect = document.getElementById('proyectoCategoria');
            if (categoriaSelect) {
                categoriaSelect.addEventListener('change', function() {
                    const categoriaSeleccionada = this.value;
                    const select = document.getElementById('proyectoSemillero');
                    
                    if (!categoriaSeleccionada) {
                        select.disabled = true;
                        select.innerHTML = '<option value="">-- Selecciona categor√≠a primero --</option>';
                        return;
                    }

                    select.disabled = false;
                    const semillerosFiltrados = todosLosSemilleros.filter(s => s.categoria === categoriaSeleccionada);
                    
                    if (semillerosFiltrados.length === 0) {
                        select.innerHTML = '<option value="">No hay semilleros en esta categor√≠a</option>';
                    } else {
                        select.innerHTML = '<option value="">-- Seleccionar semillero --</option>' + 
                            semillerosFiltrados.map(s => `<option value="${s.id}">${s.nombre}</option>`).join('');
                    }
                });
            }

            const lista = document.getElementById('listaSemilleros');
            if (!semilleros.length) {
                lista.innerHTML = '<p class="text-muted">No hay semilleros a√∫n</p>';
                return;
            }

            lista.innerHTML = `
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Categor√≠a</th>
                            <th>L√≠nea</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${semilleros.map(s => `
                            <tr>
                                <td>${s.id}</td>
                                <td>${s.nombre}</td>
                                <td><span class="badge bg-info">${s.categoria || 'Sin categor√≠a'}</span></td>
                                <td>${s.linea}</td>
                                <td>
                                    <button class="btn btn-sm btn-danger" onclick="eliminarSemillero(${s.id})">Eliminar</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        document.getElementById('formSemillero').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const datos = {
                nombre: document.getElementById('semilleroNombre').value,
                linea: document.getElementById('semilleroLinea').value,
                enfoque: document.getElementById('semilleroEnfoque').value,
                descripcion: document.getElementById('semilleroDescripcion').value,
                imagen: document.getElementById('semilleroImagen').value,
                categoria: document.getElementById('semilleroCategoria').value
            };

            const response = await fetch(`${API}/api/semilleros`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(datos)
            });

            if (response.ok) {
                toast.success('Semillero creado');
                document.getElementById('formSemillero').reset();
                cargarSemilleros();
                cargarDashboard();
            } else {
                toast.error('Error al crear semillero');
            }
        });

        async function eliminarSemillero(id) {
            if (!confirm('¬øEliminar este semillero?')) return;
            
            const res = await fetch(`${API}/api/semilleros/${id}`, { method: 'DELETE' });
            if (res.ok) {
                toast.info('Semillero eliminado');
                cargarSemilleros();
                cargarDashboard();
            } else {
                toast.error('Error al eliminar semillero');
            }
        }

        // ========== PROYECTOS ==========
        async function cargarProyectos() {
            const response = await fetch(`${API}/api/proyectos`);
            const proyectos = await response.json();

            const lista = document.getElementById('listaProyectos');
            if (!proyectos.length) {
                lista.innerHTML = '<p class="text-muted">No hay proyectos a√∫n</p>';
                return;
            }

            lista.innerHTML = `
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>T√≠tulo</th>
                            <th>Semillero</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${proyectos.map(p => `
                            <tr>
                                <td>${p.id}</td>
                                <td>${p.titulo}</td>
                                <td>${p.semillero_id}</td>
                                <td>
                                    <span class="badge ${p.estado === 'En ejecuci√≥n' ? 'bg-primary' : p.estado === 'Finalizado' ? 'bg-success' : 'bg-warning'}">${p.estado}</span>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-danger" onclick="eliminarProyecto(${p.id})">Eliminar</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        document.getElementById('formProyecto').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const datos = {
                semillero_id: document.getElementById('proyectoSemillero').value,
                titulo: document.getElementById('proyectoTitulo').value,
                estado: document.getElementById('proyectoEstado').value,
                aliados: document.getElementById('proyectoAliados').value,
                objetivo: document.getElementById('proyectoObjetivo').value,
                entregables: document.getElementById('proyectoEntregables').value,
                evidencia: document.getElementById('proyectoEvidencia').value
            };

            const response = await fetch(`${API}/api/proyectos`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(datos)
            });

            if (response.ok) {
                toast.success('Proyecto creado');
                document.getElementById('formProyecto').reset();
                cargarProyectos();
                cargarDashboard();
            } else {
                toast.error('Error al crear proyecto');
            }
        });

        async function eliminarProyecto(id) {
            if (!confirm('¬øEliminar este proyecto?')) return;
            
            const res = await fetch(`${API}/api/proyectos/${id}`, { method: 'DELETE' });
            if (res.ok) {
                toast.info('Proyecto eliminado');
                cargarProyectos();
                cargarDashboard();
            } else {
                toast.error('Error al eliminar proyecto');
            }
        }

        // ========== DOCUMENTOS ==========
        const dropZone = document.getElementById('dropZone');
        const docArchivo = document.getElementById('docArchivo');
        const dropText = document.getElementById('dropText');
        const fileSelected = document.getElementById('fileSelected');
        const fileName = document.getElementById('fileName');

        dropZone.addEventListener('click', () => docArchivo.click());

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.backgroundColor = 'rgba(57, 169, 0, 0.1)';
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.style.backgroundColor = 'transparent';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.backgroundColor = 'transparent';
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                docArchivo.files = files;
                actualizarNombreArchivo(files[0]);
            }
        });

        docArchivo.addEventListener('change', () => {
            if (docArchivo.files.length > 0) {
                actualizarNombreArchivo(docArchivo.files[0]);
            }
        });

        function actualizarNombreArchivo(file) {
            if (file.type !== 'application/pdf') {
                toast.warning('Solo se permiten archivos PDF');
                docArchivo.value = '';
                dropText.style.display = 'block';
                fileSelected.style.display = 'none';
                return;
            }
            fileName.textContent = file.name;
            dropText.style.display = 'none';
            fileSelected.style.display = 'block';
        }

        async function cargarDocumentos() {
            const response = await fetch(`${API}/api/documentos`);
            const documentos = await response.json();

            const lista = document.getElementById('listaDocumentos');
            if (!documentos.length) {
                lista.innerHTML = '<p class="text-muted">No hay documentos a√∫n</p>';
                return;
            }

            lista.innerHTML = `
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Tipo</th>
                            <th>Archivo</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${documentos.map(doc => `
                            <tr>
                                <td>${doc.id}</td>
                                <td>${doc.nombre}</td>
                                <td><span class="badge bg-info">${doc.tipo}</span></td>
                                <td><a href="${doc.ruta_archivo}" target="_blank" class="text-decoration-none">üìÑ Descargar</a></td>
                                <td>
                                    <button class="btn btn-sm btn-danger" onclick="eliminarDocumento(${doc.id})">Eliminar</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        document.getElementById('formDocumento').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!docArchivo.files.length) {
                toast.warning('Por favor selecciona un archivo PDF');
                return;
            }

            const formData = new FormData();
            formData.append('nombre', document.getElementById('docNombre').value);
            formData.append('tipo', document.getElementById('docTipo').value);
            formData.append('descripcion', document.getElementById('docDescripcion').value);
            formData.append('archivo', docArchivo.files[0]);

            try {
                const response = await fetch(`${API}/api/documentos`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    toast.success('Documento agregado');
                    document.getElementById('formDocumento').reset();
                    docArchivo.value = '';
                    dropText.style.display = 'block';
                    fileSelected.style.display = 'none';
                    cargarDocumentos();
                    cargarDashboard();
                } else {
                    const error = await response.json();
                    toast.error('Error al subir documento: ' + error.error);
                }
            } catch (error) {
                toast.error('Error al subir archivo: ' + error.message);
            }
        });

        async function eliminarDocumento(id) {
            if (!confirm('¬øEliminar este documento?')) return;
            
            const res = await fetch(`${API}/api/documentos/${id}`, { method: 'DELETE' });
            if (res.ok) {
                toast.info('Documento eliminado');
                cargarDocumentos();
                cargarDashboard();
            } else {
                toast.error('Error al eliminar documento');
            }
        }

        // ========== CONTACTOS ==========
        async function cargarContactos() {
            const response = await fetch(`${API}/api/contactos`);
            const contactos = await response.json();
            contactosCache = contactos;

            const lista = document.getElementById('listaContactos');
            if (!contactos.length) {
                lista.innerHTML = '<p class="text-muted">No hay mensajes a√∫n</p>';
                return;
            }

            lista.innerHTML = `
                <table class="table table-hover table-sm align-middle">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 50px">ID</th>
                            <th style="width: 160px">Nombre</th>
                            <th style="width: 220px">Email</th>
                            <th style="width: 160px">Asunto</th>
                            <th>Mensaje</th>
                            <th style="width: 110px">Fecha</th>
                            <th style="width: 140px">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${contactos.map(c => `
                            <tr>
                                <td>${c.id}</td>
                                <td>${c.nombre}</td>
                                <td><small>${c.email}</small></td>
                                <td><small>${c.asunto}</small></td>
                                <td style="max-width: 260px">
                                    <small class="text-muted text-truncate d-inline-block w-100" style="white-space: nowrap">${c.mensaje}</small>
                                </td>
                                <td><small>${c.created_at ? new Date(c.created_at).toLocaleDateString('es-ES') : ''}</small></td>
                                <td>
                                    <div class="d-flex gap-1 justify-content-end">
                                        <button class="btn btn-sm btn-ceai" onclick="verContacto(${c.id})">Ver</button>
                                        <button class="btn btn-sm btn-danger" onclick="eliminarContacto(${c.id})">üóëÔ∏è</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        async function eliminarContacto(id) {
            if (!confirm('¬øEliminar este mensaje?')) return;
            
            const res = await fetch(`${API}/api/contactos/${id}`, { method: 'DELETE' });
            if (res.ok) {
                toast.info('Mensaje eliminado');
                cargarContactos();
                cargarDashboard();
            } else {
                toast.error('Error al eliminar mensaje');
            }
        }

        function verContacto(id) {
            const c = contactosCache.find(x => x.id === id);
            if (!c) return;

            document.getElementById('detalleNombre').textContent = c.nombre;
            document.getElementById('detalleEmail').textContent = c.email;
            document.getElementById('detalleAsunto').textContent = c.asunto;
            document.getElementById('detalleFecha').textContent = c.created_at ? new Date(c.created_at).toLocaleString('es-ES') : '';
            document.getElementById('detalleMensaje').textContent = c.mensaje;

            const modalEl = document.getElementById('contactoModal');
            const modal = new bootstrap.Modal(modalEl);
            modal.show();
        }

        // Iniciar
        cargarDashboard();
    </script>
</body>
</html>
