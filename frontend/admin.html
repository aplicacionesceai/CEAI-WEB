<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo - CEAI SENA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ===== BASE ADMIN ===== */
        * { box-sizing: border-box; }
        html, body { height: 100%; margin: 0; padding: 0; }
        body {
            background: linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%);
            font-family:'Roboto',sans-serif;
            overflow-x:hidden;
            min-height: 100vh;
        }

        /* ===== OVERRIDE GLOBAL: botones en admin NO full-width ===== */
        .admin-btn,
        .table .btn,
        .table .btn-sm,
        .modal .btn,
        .modal .btn-sm,
        .form-section .btn,
        .quick-actions .btn,
        .sidebar-footer .btn {
            width: auto !important;
        }

        /* ===== BOTONES DE ACCI√ìN EN TABLAS ===== */
        .table-actions {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            flex-wrap: nowrap;
            white-space: nowrap;
        }
        .table-actions .btn {
            width: auto !important;
            padding: 4px 10px !important;
            font-size: 0.78rem !important;
            font-weight: 600 !important;
            border-radius: 6px !important;
            display: inline-flex;
            align-items: center;
            gap: 3px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            background: linear-gradient(180deg,var(--ceai-azul) 0%,var(--ceai-azul-dark) 100%);
            color: white;
            height: 100vh;
            padding: 25px 20px;
            position: fixed;
            top: 0;
            left: 0;
            width: 240px;
            box-shadow: 4px 0 20px rgba(0,0,0,.15);
            z-index: 1000;
            transition: transform .3s ease;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .sidebar-header {
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(57,169,0,.3);
            margin-bottom: 25px;
            flex-shrink: 0;
        }
        .sidebar-header h4 { color:white; font-weight:800; font-size:1.5rem; margin:0; letter-spacing:-.5px; }
        .sidebar-header span { color:var(--ceai-verde); text-shadow:0 0 15px rgba(57,169,0,.6); animation:pulseGlow 2s ease infinite; }
        @keyframes pulseGlow { 0%,100%{text-shadow:0 0 15px rgba(57,169,0,.6)} 50%{text-shadow:0 0 25px rgba(57,169,0,.9)} }
        .sidebar h5 { color:var(--ceai-verde); font-size:.8rem; text-transform:uppercase; letter-spacing:1.5px; margin-bottom:12px; margin-top:16px; font-weight:700; flex-shrink:0; }
        .sidebar-link {
            color: rgba(255,255,255,.75);
            margin-bottom: 6px;
            cursor: pointer;
            border-radius: 10px;
            padding: 12px 16px;
            transition: all .3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            font-weight: 500;
            font-size: .9rem;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        .sidebar-link::before { content:''; position:absolute; left:0; top:0; bottom:0; width:4px; background:var(--ceai-verde); transform:scaleY(0); transition:transform .3s ease; }
        .sidebar-link:hover,.sidebar-link.active { background:linear-gradient(90deg,var(--ceai-verde) 0%,var(--ceai-verde-light) 100%); color:white; transform:translateX(5px); box-shadow:0 4px 20px rgba(57,169,0,.45); }
        .sidebar-link:hover::before,.sidebar-link.active::before { transform:scaleY(1); }
        .sidebar-nav { flex: 1; display: flex; flex-direction: column; }
        .sidebar-footer {
            margin-top: auto;
            padding-top: 18px;
            border-top: 1px solid rgba(255,255,255,.1);
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-shrink: 0;
        }
        .sidebar-footer .btn { width: 100% !important; font-size: .85rem; padding: 8px 12px; }

        /* ===== LAYOUT PRINCIPAL ===== */
        .admin-wrapper {
            display: flex;
            min-height: 100vh;
            width: 100%;
        }
        .content-wrapper {
            margin-left: 240px;
            width: calc(100% - 240px);
            min-height: 100vh;
            padding: 30px 32px;
            transition: margin-left .3s ease, width .3s ease;
            display: flex;
            flex-direction: column;
        }
        .content-section { display:none; animation:fadeInContent .45s ease; flex: 1; }
        .content-section.active { display:flex; flex-direction:column; }
        @keyframes fadeInContent { from{opacity:0;transform:translateY(24px)} to{opacity:1;transform:translateY(0)} }

        /* ===== SECTION HEADER ===== */
        .section-header {
            background: linear-gradient(135deg,white 0%,#f8f9fa 100%);
            border-radius: 16px;
            padding: 24px 30px;
            margin-bottom: 28px;
            box-shadow: 0 4px 20px rgba(0,0,0,.08);
            border-left: 6px solid var(--ceai-verde);
            flex-shrink: 0;
        }
        .section-header h2 { color:var(--ceai-azul); font-weight:800; margin:0; font-size:1.75rem; }
        .section-header p { margin:6px 0 0 0; color:#6c757d; font-size:.95rem; }

        /* ===== STAT CARDS ===== */
        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px; }
        .stat-card {
            background: linear-gradient(135deg,var(--ceai-verde) 0%,var(--ceai-verde-light) 100%);
            color: white;
            border-radius: 16px;
            padding: 24px 20px;
            text-align: center;
            transition: all .4s ease;
            border: none;
            box-shadow: 0 6px 20px rgba(57,169,0,.3);
            position: relative;
            overflow: hidden;
        }
        .stat-card::after { content:''; position:absolute; top:-50%; right:-50%; width:200%; height:200%; background:radial-gradient(circle,rgba(255,255,255,.1) 0%,transparent 70%); pointer-events:none; }
        .stat-card:hover { transform:translateY(-8px) scale(1.02); box-shadow:0 14px 36px rgba(57,169,0,.45); }
        .stat-card.variant-azul { background:linear-gradient(135deg,var(--ceai-azul) 0%,var(--ceai-azul-light) 100%); box-shadow:0 6px 20px rgba(0,48,77,.3); }
        .stat-card.variant-azul:hover { box-shadow:0 14px 36px rgba(0,48,77,.45); }
        .stat-card h5 { color:rgba(255,255,255,.92); font-size:.88rem; margin-bottom:10px; font-weight:600; text-transform:uppercase; letter-spacing:1px; }
        .stat-card h3 { color:white; font-size:2.6rem; font-weight:900; margin:0; text-shadow:0 3px 12px rgba(0,0,0,.2); }

        /* ===== MODERN CARDS ===== */
        .modern-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,.08);
            border: 1px solid rgba(0,0,0,.04);
            transition: all .3s ease;
            position: relative;
            overflow: hidden;
            height: 100%;
        }
        .modern-card::before { content:''; position:absolute; top:0; left:0; right:0; height:4px; background:linear-gradient(90deg,var(--ceai-verde),var(--ceai-verde-light)); }
        .modern-card:hover { transform:translateY(-4px); box-shadow:0 10px 30px rgba(0,0,0,.12); }
        .modern-card h5 { color:var(--ceai-azul); font-weight:700; margin-bottom:16px; font-size:1.05rem; }

        /* ===== QUICK ACTIONS ===== */
        .quick-actions {
            background: linear-gradient(135deg,var(--ceai-azul) 0%,var(--ceai-azul-light) 100%);
            color: white;
            border-radius: 16px;
            padding: 22px 26px;
            margin-bottom: 24px;
            box-shadow: 0 6px 22px rgba(0,48,77,.3);
            flex-shrink: 0;
        }
        .quick-actions h5 { color:var(--ceai-verde); margin-bottom:14px; font-weight:700; text-transform:uppercase; letter-spacing:1px; font-size:.9rem; }
        .quick-actions .btn { width:auto !important; }
        .quick-actions .d-flex { flex-wrap: wrap; gap: 10px; }

        /* ===== FORM SECTION ===== */
        .form-section {
            background: white;
            padding: 28px 32px;
            border-radius: 16px;
            margin-bottom: 28px;
            box-shadow: 0 4px 20px rgba(0,0,0,.08);
            border-top: 5px solid var(--ceai-verde);
            flex-shrink: 0;
        }
        .form-section h5 { color:var(--ceai-azul); font-weight:700; margin-bottom:22px; font-size:1.2rem; }

        /* ===== TABLE SECTION ===== */
        .table-section {
            background: white;
            border-radius: 16px;
            padding: 24px 28px;
            box-shadow: 0 4px 20px rgba(0,0,0,.08);
            overflow-x: auto;
            flex: 1;
        }
        .table-section h5 { color:var(--ceai-azul); font-weight:700; margin-bottom:18px; font-size:1.1rem; }
        .table { width: 100%; table-layout: auto; }
        .table thead th {
            border-top: none;
            border-bottom: 3px solid var(--ceai-verde);
            color: var(--ceai-azul);
            font-weight: 700;
            text-transform: uppercase;
            font-size: .8rem;
            letter-spacing: .7px;
            padding: 12px 14px;
            vertical-align: middle;
            white-space: nowrap;
        }
        .table tbody tr { transition:background .2s ease; }
        .table tbody tr:hover { background-color:rgba(57,169,0,.05); }
        .table td { vertical-align:middle; padding: 10px 14px; font-size: .9rem; }
        .table th.col-acciones,
        .table td.col-acciones { width:1%; white-space:nowrap; text-align:center; }

        /* ===== CHARTS ROW ===== */
        .charts-row { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px; }
        .recent-row  { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 8px; }

        /* ===== MODAL ===== */
        .modal-content { border-radius:16px; border:none; box-shadow:0 15px 60px rgba(0,0,0,.22); }
        .modal-header { background:linear-gradient(90deg,var(--ceai-verde) 0%,var(--ceai-verde-light) 100%); color:white; border-radius:16px 16px 0 0; border:none; padding:18px 26px; }
        .modal-header .modal-title { color:white; font-weight:700; }
        .modal-header .btn-close { filter:brightness(0) invert(1); }
        .modal-footer .btn { width:auto !important; }

        /* ===== MISC ===== */
        .sidebar-toggle { display:none; position:fixed; top:18px; left:16px; z-index:1100; background:var(--ceai-verde); color:white; border:none; padding:11px 14px; border-radius:10px; font-size:1.2rem; box-shadow:0 4px 16px rgba(57,169,0,.4); cursor:pointer; transition:all .3s ease; }
        .sidebar-toggle:hover { background:var(--ceai-verde-oscuro); transform:scale(1.1); }
        .sidebar-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.55); z-index:999; opacity:0; transition:opacity .3s ease; backdrop-filter:blur(3px); }
        .sidebar-overlay.show { display:block; opacity:1; }
        .sidebar::-webkit-scrollbar { width:6px; }
        .sidebar::-webkit-scrollbar-track { background:rgba(0,0,0,.1); }
        .sidebar::-webkit-scrollbar-thumb { background:var(--ceai-verde); border-radius:8px; }
        .detail-box { white-space:pre-wrap; word-wrap:break-word; background:#f8f9fa; padding:14px; border-radius:10px; border:1px solid #e0e0e0; max-height:200px; overflow-y:auto; font-size:.9rem; }

        /* ===== CONTACTOS: tabla con columnas bien definidas ===== */
        #listaContactos .table { min-width: 700px; }
        #listaContactos td:nth-child(5) { max-width: 160px; }
        #listaContactos td:nth-child(5) small { display:block; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:160px; }

        /* ========== RESPONSIVE DETALLADO ========== */

        /* --- 1280px: sidebar un poco m√°s estrecha --- */
        @media (max-width:1280px) {
            .sidebar { width: 220px; }
            .content-wrapper { margin-left: 220px; width: calc(100% - 220px); padding: 26px 26px; }
        }

        /* --- 1100px: stats en 2 columnas, charts apiladas --- */
        @media (max-width:1100px) {
            .stats-row { grid-template-columns: repeat(2, 1fr); }
            .charts-row { grid-template-columns: 1fr; }
            .recent-row  { grid-template-columns: 1fr; }
        }

        /* --- 992px: sidebar oculta, toggle visible --- */
        @media (max-width:992px) {
            .sidebar { transform: translateX(-100%); width: 260px; }
            .sidebar.show { transform: translateX(0); }
            .content-wrapper { margin-left: 0; width: 100%; padding: 80px 20px 24px; }
            .sidebar-toggle { display: block; }
            .section-header h2 { font-size: 1.45rem; }
            .stat-card h3 { font-size: 2.2rem; }
            .stats-row { grid-template-columns: repeat(2, 1fr); gap: 16px; }
            .form-section { padding: 22px 22px; }
            .table-section { padding: 18px 18px; }
        }

        /* --- 768px: stack todo, ajustes de tabla --- */
        @media (max-width:768px) {
            .content-wrapper { padding: 76px 14px 20px; }
            .stats-row { grid-template-columns: repeat(2, 1fr); gap: 14px; margin-bottom: 18px; }
            .stat-card { padding: 18px 14px; }
            .stat-card h3 { font-size: 2rem; }
            .stat-card h5 { font-size: .78rem; }
            .charts-row, .recent-row { grid-template-columns: 1fr; gap: 16px; }
            .quick-actions { padding: 18px 18px; }
            .quick-actions .d-flex { gap: 8px; }
            .section-header { padding: 18px 20px; margin-bottom: 20px; }
            .section-header h2 { font-size: 1.25rem; }
            .form-section { padding: 18px 16px; }
            .form-section h5 { font-size: 1.05rem; }
            .table-section { padding: 14px 14px; }
            .table thead th { font-size: .75rem; padding: 10px 10px; }
            .table td { font-size: .85rem; padding: 9px 10px; }
            .table-actions .btn { padding: 3px 8px !important; font-size: 0.73rem !important; gap: 2px; }
        }

        /* --- 576px: m√≥vil chico, stats 1 columna --- */
        @media (max-width:576px) {
            .content-wrapper { padding: 72px 10px 16px; }
            .stats-row { grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 14px; }
            .stat-card { padding: 16px 10px; border-radius: 12px; }
            .stat-card h3 { font-size: 1.8rem; }
            .stat-card h5 { font-size: .72rem; margin-bottom: 6px; }
            .section-header { padding: 14px 16px; border-radius: 12px; margin-bottom: 16px; }
            .section-header h2 { font-size: 1.1rem; }
            .modern-card { padding: 16px; border-radius: 12px; }
            .quick-actions { padding: 14px 14px; border-radius: 12px; }
            .quick-actions .btn { width: 100% !important; margin: 0 !important; }
            .form-section { padding: 14px 12px; border-radius: 12px; }
            .form-section .btn-submit-full { width: 100% !important; }
            .table-section { padding: 12px 10px; border-radius: 12px; }
            .table-actions .btn { padding: 3px 6px !important; font-size: 0.7rem !important; }
            .modal-dialog { margin: 8px; }
            .modal-body { padding: 14px; }
            .sidebar-footer .btn { font-size: .8rem; padding: 7px 10px; }
        }

        /* --- 400px: pantallas muy peque√±as --- */
        @media (max-width:400px) {
            .stats-row { grid-template-columns: 1fr 1fr; gap: 8px; }
            .stat-card h3 { font-size: 1.6rem; }
            .content-wrapper { padding: 68px 8px 12px; }
        }
    </style>
</head>
<body>
    <script>
        if (localStorage.getItem('ceai_admin_logged') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <button class="sidebar-toggle" id="sidebarToggle">‚ò∞</button>

    <div class="admin-wrapper">
        <!-- SIDEBAR -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h4 class="fw-bold"><span>CEAI</span> Admin</h4>
            </div>
            <div class="sidebar-nav">
                <h5>üìã Men√∫ Principal</h5>
                <div class="sidebar-link active" data-section="dashboard"><span>üìä</span> Dashboard</div>
                <div class="sidebar-link" data-section="noticias"><span>üì∞</span> Noticias</div>
                <div class="sidebar-link" data-section="semilleros"><span>üå±</span> Semilleros</div>
                <div class="sidebar-link" data-section="proyectos"><span>üî¨</span> Proyectos</div>
                <div class="sidebar-link" data-section="documentos"><span>üìÑ</span> Documentos</div>
                <div class="sidebar-link" data-section="contactos"><span>üì®</span> Contactos</div>
            </div>
            <div class="sidebar-footer">
                <button class="btn btn-outline-light btn-sm"
                    onclick="localStorage.removeItem('ceai_admin_logged'); window.location.href='login.html';">
                    üö™ Cerrar sesi√≥n
                </button>
                <a href="index.html" class="btn btn-outline-light btn-sm">‚Üê Volver al sitio</a>
            </div>
        </div>

        <!-- CONTENIDO PRINCIPAL -->
        <div class="content-wrapper" id="contentWrapper">

            <!-- DASHBOARD -->
            <div id="dashboard" class="content-section active">
                <div class="section-header">
                    <h2>üìä Panel de Control</h2>
                    <p class="mb-0">Vista general del sistema CEAI</p>
                </div>

                <!-- Stats -->
                <div class="stats-row">
                    <div class="stat-card"><h5>üì∞ Noticias</h5><h3 id="countNoticias">0</h3></div>
                    <div class="stat-card variant-azul"><h5>üå± Semilleros</h5><h3 id="countSemilleros">0</h3></div>
                    <div class="stat-card"><h5>üî¨ Proyectos</h5><h3 id="countProyectos">0</h3></div>
                    <div class="stat-card variant-azul"><h5>üìÑ Documentos</h5><h3 id="countDocumentos">0</h3></div>
                </div>

                <!-- Acciones r√°pidas -->
                <div class="quick-actions">
                    <h5>‚ö° Acciones R√°pidas</h5>
                    <div class="d-flex flex-wrap gap-2">
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('noticias')">+ Nueva noticia</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('semilleros')">+ Nuevo semillero</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('proyectos')">+ Nuevo proyecto</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('documentos')">+ Subir documento</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('contactos')">üì® Ver contactos</button>
                    </div>
                </div>

                <!-- Gr√°ficas -->
                <div class="charts-row">
                    <div class="modern-card"><h5 class="mb-3">Distribuci√≥n de Contenido</h5><canvas id="chartContenido"></canvas></div>
                    <div class="modern-card"><h5 class="mb-3">Mensajes de Contacto</h5><canvas id="chartContactos"></canvas></div>
                </div>

                <!-- Listas recientes -->
                <div class="recent-row">
                    <div class="modern-card"><h5 class="mb-3">√öltimas Noticias</h5><ul id="ultimasNoticias" class="list-group list-group-flush"></ul></div>
                    <div class="modern-card"><h5 class="mb-3">√öltimos Contactos</h5><ul id="ultimosContactos" class="list-group list-group-flush"></ul></div>
                </div>
            </div>

            <!-- NOTICIAS -->
            <div id="noticias" class="content-section">
                <div class="section-header">
                    <h2>üì∞ Gestionar Noticias</h2>
                    <p class="mb-0">Crear, editar y eliminar noticias</p>
                </div>
                <div class="form-section">
                    <h5 id="tituloFormNoticia">‚ûï Nueva Noticia</h5>
                    <form id="formNoticia">
                        <input type="hidden" id="noticiaEditId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">T√≠tulo <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="noticiaTitulo" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Fecha <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="noticiaFecha" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Tipo</label>
                                <select class="form-control" id="noticiaTipo">
                                    <option value="Noticia">Noticia</option>
                                    <option value="Evento">Evento</option>
                                    <option value="Convocatoria">Convocatoria</option>
                                    <option value="Resultado">Resultado</option>
                                </select>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Descripci√≥n <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="noticiaDescripcion" rows="3" required></textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">URL Imagen</label>
                                <input type="url" class="form-control" id="noticiaImagen" placeholder="https://...">
                            </div>
                            <div class="col-md-6 mb-3 d-flex align-items-end">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="noticiaDestacada">
                                    <label class="form-check-label" for="noticiaDestacada">‚≠ê Destacar en carousel del home</label>
                                </div>
                            </div>
                            <div class="col-md-8 mb-3">
                                <button type="submit" class="btn btn-ceai btn-submit-full w-100" id="btnSubmitNoticia">‚úÖ Crear Noticia</button>
                            </div>
                            <div class="col-md-4 mb-3">
                                <button type="button" class="btn btn-outline-secondary btn-submit-full w-100" id="btnCancelNoticia" style="display:none" onclick="cancelarEdicionNoticia()">‚úñ Cancelar</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="table-section">
                    <h5 class="mb-3">üìã Noticias Registradas</h5>
                    <div class="table-responsive" id="listaNoticias"></div>
                </div>
            </div>

            <!-- SEMILLEROS -->
            <div id="semilleros" class="content-section">
                <div class="section-header">
                    <h2>üå± Gestionar Semilleros</h2>
                    <p class="mb-0">Crear, editar y eliminar semilleros</p>
                </div>
                <div class="form-section">
                    <h5 id="tituloFormSemillero">‚ûï Nuevo Semillero</h5>
                    <form id="formSemillero">
                        <input type="hidden" id="semilleroEditId">
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Categor√≠a / Servicio <span class="text-danger">*</span></label>
                                <select class="form-control" id="semilleroCategoria" required>
                                    <option value="Soluciones Digitales">Soluciones Digitales</option>
                                    <option value="Automatizaci√≥n e Instrumentaci√≥n">Automatizaci√≥n e Instrumentaci√≥n</option>
                                    <option value="F√°brica Digital Interactiva">F√°brica Digital Interactiva</option>
                                    <option value="Gesti√≥n Energ√©tica">Gesti√≥n Energ√©tica</option>
                                    <option value="IA Aplicada al Entorno">IA Aplicada al Entorno</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombre <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="semilleroNombre" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">L√≠nea de Investigaci√≥n <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="semilleroLinea" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Enfoque <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="semilleroEnfoque" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">URL Imagen</label>
                                <input type="url" class="form-control" id="semilleroImagen" placeholder="https://...">
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Descripci√≥n <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="semilleroDescripcion" rows="3" required></textarea>
                            </div>
                            <div class="col-md-8 mb-3">
                                <button type="submit" class="btn btn-ceai btn-submit-full w-100" id="btnSubmitSemillero">‚úÖ Crear Semillero</button>
                            </div>
                            <div class="col-md-4 mb-3">
                                <button type="button" class="btn btn-outline-secondary btn-submit-full w-100" id="btnCancelSemillero" style="display:none" onclick="cancelarEdicionSemillero()">‚úñ Cancelar</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="table-section">
                    <h5 class="mb-3">üìã Semilleros Registrados</h5>
                    <div class="table-responsive" id="listaSemilleros"></div>
                </div>
            </div>

            <!-- PROYECTOS -->
            <div id="proyectos" class="content-section">
                <div class="section-header">
                    <h2>üî¨ Gestionar Proyectos</h2>
                    <p class="mb-0">Crear, editar y eliminar proyectos</p>
                </div>
                <div class="form-section">
                    <h5 id="tituloFormProyecto">‚ûï Nuevo Proyecto</h5>
                    <form id="formProyecto">
                        <input type="hidden" id="proyectoEditId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Categor√≠a / Servicio</label>
                                <select class="form-control" id="proyectoCategoria">
                                    <option value="">-- Seleccionar categor√≠a --</option>
                                    <option value="Soluciones Digitales">Soluciones Digitales</option>
                                    <option value="Automatizaci√≥n e Instrumentaci√≥n">Automatizaci√≥n e Instrumentaci√≥n</option>
                                    <option value="F√°brica Digital Interactiva">F√°brica Digital Interactiva</option>
                                    <option value="Gesti√≥n Energ√©tica">Gesti√≥n Energ√©tica</option>
                                    <option value="IA Aplicada al Entorno">IA Aplicada al Entorno</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Semillero <span class="text-danger">*</span></label>
                                <select class="form-control" id="proyectoSemillero" required disabled>
                                    <option value="">-- Selecciona categor√≠a primero --</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">T√≠tulo <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="proyectoTitulo" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Estado <span class="text-danger">*</span></label>
                                <select class="form-control" id="proyectoEstado" required>
                                    <option value="En ejecuci√≥n">En ejecuci√≥n</option>
                                    <option value="Finalizado">Finalizado</option>
                                    <option value="En revisi√≥n">En revisi√≥n</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Aliados</label>
                                <input type="text" class="form-control" id="proyectoAliados">
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Objetivo</label>
                                <textarea class="form-control" id="proyectoObjetivo" rows="2"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Entregables</label>
                                <textarea class="form-control" id="proyectoEntregables" rows="2"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Evidencia</label>
                                <textarea class="form-control" id="proyectoEvidencia" rows="2"></textarea>
                            </div>
                            <div class="col-md-8 mb-3">
                                <button type="submit" class="btn btn-ceai btn-submit-full w-100" id="btnSubmitProyecto">‚úÖ Crear Proyecto</button>
                            </div>
                            <div class="col-md-4 mb-3">
                                <button type="button" class="btn btn-outline-secondary btn-submit-full w-100" id="btnCancelProyecto" style="display:none" onclick="cancelarEdicionProyecto()">‚úñ Cancelar</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="table-section">
                    <h5 class="mb-3">üìã Proyectos Registrados</h5>
                    <div class="table-responsive" id="listaProyectos"></div>
                </div>
            </div>

            <!-- DOCUMENTOS -->
            <div id="documentos" class="content-section">
                <div class="section-header">
                    <h2>üìÑ Gestionar Documentos</h2>
                    <p class="mb-0">Subir, editar y eliminar documentos PDF</p>
                </div>
                <div class="form-section">
                    <h5>‚ûï Nuevo Documento</h5>
                    <form id="formDocumento" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombre del Documento <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="docNombre" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Tipo <span class="text-danger">*</span></label>
                                <select class="form-control" id="docTipo" required>
                                    <option value="">-- Seleccionar --</option>
                                    <option value="Convocatoria">Convocatoria</option>
                                    <option value="Portafolio">Portafolio de Servicios</option>
                                    <option value="Informe">Informe</option>
                                    <option value="Manual">Manual</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Descripci√≥n</label>
                                <textarea class="form-control" id="docDescripcion" rows="2"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Archivo PDF <span class="text-danger">*</span></label>
                                <div id="dropZone" class="rounded p-5 text-center" style="border:2px dashed var(--ceai-verde);cursor:pointer;transition:all .3s;">
                                    <input type="file" id="docArchivo" class="form-control d-none" accept=".pdf" required>
                                    <div id="dropText">
                                        <p style="margin:0;color:var(--ceai-verde);font-weight:bold;">üìÅ Arrastra tu PDF aqu√≠</p>
                                        <p style="margin:5px 0 0 0;color:#666;font-size:14px;">o haz clic para seleccionar</p>
                                    </div>
                                    <div id="fileSelected" style="display:none;color:var(--ceai-verde);">
                                        <p style="margin:0;font-weight:bold;">‚úÖ Archivo listo:</p>
                                        <p id="fileName" style="margin:5px 0 0 0;"></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 mb-3">
                                <button type="submit" class="btn btn-ceai btn-submit-full w-100">üì§ Subir Documento</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="table-section">
                    <h5 class="mb-3">üìã Documentos Registrados</h5>
                    <div class="table-responsive" id="listaDocumentos"></div>
                </div>
            </div>

            <!-- CONTACTOS -->
            <div id="contactos" class="content-section">
                <div class="section-header">
                    <h2>üì® Mensajes de Contacto</h2>
                    <p class="mb-0">Ver y gestionar mensajes recibidos</p>
                </div>
                <div class="table-section">
                    <h5 class="mb-3">üìã Mensajes Recibidos</h5>
                    <div class="table-responsive" id="listaContactos"></div>
                </div>
            </div>

        </div><!-- /content-wrapper -->
    </div><!-- /admin-wrapper -->

    <!-- ===== MODALES ===== -->

    <!-- Modal Ver Noticia -->
    <div class="modal fade" id="verNoticiaModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">üëÅÔ∏è Detalle de Noticia</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <p><strong>T√≠tulo:</strong> <span id="vn_titulo"></span></p>
                            <p><strong>Fecha:</strong> <span id="vn_fecha"></span></p>
                            <p><strong>Tipo:</strong> <span id="vn_tipo" class="badge bg-secondary"></span></p>
                            <p><strong>Destacada:</strong> <span id="vn_destacada"></span></p>
                        </div>
                        <div class="col-md-4 text-center">
                            <img id="vn_imagen" src="" alt="Imagen" class="img-fluid rounded" style="max-height:150px;object-fit:cover;display:none;">
                        </div>
                    </div>
                    <p><strong>Descripci√≥n:</strong></p>
                    <div class="detail-box" id="vn_descripcion"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Noticia -->
    <div class="modal fade" id="editarNoticiaModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">‚úèÔ∏è Editar Noticia</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formEditarNoticia">
                        <input type="hidden" id="edit_n_id">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">T√≠tulo</label>
                                <input type="text" class="form-control" id="edit_n_titulo" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Fecha</label>
                                <input type="date" class="form-control" id="edit_n_fecha" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Tipo</label>
                                <select class="form-control" id="edit_n_tipo">
                                    <option value="Noticia">Noticia</option>
                                    <option value="Evento">Evento</option>
                                    <option value="Convocatoria">Convocatoria</option>
                                    <option value="Resultado">Resultado</option>
                                </select>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Descripci√≥n</label>
                                <textarea class="form-control" id="edit_n_descripcion" rows="4" required></textarea>
                            </div>
                            <div class="col-md-8 mb-3">
                                <label class="form-label">URL Imagen</label>
                                <input type="url" class="form-control" id="edit_n_imagen" placeholder="https://...">
                            </div>
                            <div class="col-md-4 mb-3 d-flex align-items-end">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="edit_n_destacada">
                                    <label class="form-check-label" for="edit_n_destacada">‚≠ê Destacada</label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-ceai" onclick="guardarEdicionNoticia()">üíæ Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ver Semillero -->
    <div class="modal fade" id="verSemilleroModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">üëÅÔ∏è Detalle de Semillero</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <p><strong>Nombre:</strong> <span id="vs_nombre"></span></p>
                            <p><strong>Categor√≠a:</strong> <span id="vs_categoria" class="badge bg-info"></span></p>
                            <p><strong>L√≠nea:</strong> <span id="vs_linea"></span></p>
                            <p><strong>Enfoque:</strong> <span id="vs_enfoque"></span></p>
                        </div>
                        <div class="col-md-4 text-center">
                            <img id="vs_imagen" src="" alt="Imagen" class="img-fluid rounded" style="max-height:150px;object-fit:cover;display:none;">
                        </div>
                    </div>
                    <p><strong>Descripci√≥n:</strong></p>
                    <div class="detail-box" id="vs_descripcion"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Semillero -->
    <div class="modal fade" id="editarSemilleroModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">‚úèÔ∏è Editar Semillero</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formEditarSemillero">
                        <input type="hidden" id="edit_s_id">
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label class="form-label">Categor√≠a</label>
                                <select class="form-control" id="edit_s_categoria" required>
                                    <option value="Soluciones Digitales">Soluciones Digitales</option>
                                    <option value="Automatizaci√≥n e Instrumentaci√≥n">Automatizaci√≥n e Instrumentaci√≥n</option>
                                    <option value="F√°brica Digital Interactiva">F√°brica Digital Interactiva</option>
                                    <option value="Gesti√≥n Energ√©tica">Gesti√≥n Energ√©tica</option>
                                    <option value="IA Aplicada al Entorno">IA Aplicada al Entorno</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombre</label>
                                <input type="text" class="form-control" id="edit_s_nombre" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">L√≠nea de Investigaci√≥n</label>
                                <input type="text" class="form-control" id="edit_s_linea" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Enfoque</label>
                                <input type="text" class="form-control" id="edit_s_enfoque" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">URL Imagen</label>
                                <input type="url" class="form-control" id="edit_s_imagen" placeholder="https://...">
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Descripci√≥n</label>
                                <textarea class="form-control" id="edit_s_descripcion" rows="4" required></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-ceai" onclick="guardarEdicionSemillero()">üíæ Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ver Proyecto -->
    <div class="modal fade" id="verProyectoModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">üëÅÔ∏è Detalle de Proyecto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p><strong>T√≠tulo:</strong> <span id="vp_titulo"></span></p>
                    <p><strong>Semillero:</strong> <span id="vp_semillero"></span></p>
                    <p><strong>Estado:</strong> <span id="vp_estado" class="badge"></span></p>
                    <p><strong>Aliados:</strong> <span id="vp_aliados"></span></p>
                    <hr>
                    <p><strong>Objetivo:</strong></p>
                    <div class="detail-box mb-3" id="vp_objetivo"></div>
                    <p><strong>Entregables:</strong></p>
                    <div class="detail-box mb-3" id="vp_entregables"></div>
                    <p><strong>Evidencia:</strong></p>
                    <div class="detail-box" id="vp_evidencia"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Proyecto -->
    <div class="modal fade" id="editarProyectoModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">‚úèÔ∏è Editar Proyecto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formEditarProyecto">
                        <input type="hidden" id="edit_p_id">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Semillero <span class="text-danger">*</span></label>
                                <select class="form-control" id="edit_p_semillero" required></select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">T√≠tulo <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="edit_p_titulo" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Estado</label>
                                <select class="form-control" id="edit_p_estado">
                                    <option value="En ejecuci√≥n">En ejecuci√≥n</option>
                                    <option value="Finalizado">Finalizado</option>
                                    <option value="En revisi√≥n">En revisi√≥n</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Aliados</label>
                                <input type="text" class="form-control" id="edit_p_aliados">
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Objetivo</label>
                                <textarea class="form-control" id="edit_p_objetivo" rows="2"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Entregables</label>
                                <textarea class="form-control" id="edit_p_entregables" rows="2"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Evidencia</label>
                                <textarea class="form-control" id="edit_p_evidencia" rows="2"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-ceai" onclick="guardarEdicionProyecto()">üíæ Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ver Documento -->
    <div class="modal fade" id="verDocumentoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">üëÅÔ∏è Detalle de Documento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Nombre:</strong> <span id="vd_nombre"></span></p>
                    <p><strong>Tipo:</strong> <span id="vd_tipo" class="badge bg-info"></span></p>
                    <p><strong>Descripci√≥n:</strong></p>
                    <div class="detail-box" id="vd_descripcion"></div>
                    <p class="mt-3"><strong>Archivo:</strong> <a id="vd_archivo" href="#" target="_blank" class="btn btn-sm btn-outline-primary">üì• Descargar PDF</a></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Documento -->
    <div class="modal fade" id="editarDocumentoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">‚úèÔ∏è Editar Documento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formEditarDocumento">
                        <input type="hidden" id="edit_d_id">
                        <div class="mb-3">
                            <label class="form-label">Nombre del Documento</label>
                            <input type="text" class="form-control" id="edit_d_nombre" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Tipo</label>
                            <select class="form-control" id="edit_d_tipo" required>
                                <option value="Convocatoria">Convocatoria</option>
                                <option value="Portafolio">Portafolio de Servicios</option>
                                <option value="Informe">Informe</option>
                                <option value="Manual">Manual</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Descripci√≥n</label>
                            <textarea class="form-control" id="edit_d_descripcion" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-ceai" onclick="guardarEdicionDocumento()">üíæ Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ver Contacto -->
    <div class="modal fade" id="contactoModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">üì® Detalle del Mensaje</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-3">Nombre</dt>
                        <dd class="col-sm-9" id="detalleNombre"></dd>
                        <dt class="col-sm-3">Email</dt>
                        <dd class="col-sm-9"><a id="detalleEmail" href="#"></a></dd>
                        <dt class="col-sm-3">Asunto</dt>
                        <dd class="col-sm-9" id="detalleAsunto"></dd>
                        <dt class="col-sm-3">Fecha</dt>
                        <dd class="col-sm-9" id="detalleFecha"></dd>
                        <dt class="col-sm-3">Mensaje</dt>
                        <dd class="col-sm-9"><div class="detail-box" id="detalleMensaje"></div></dd>
                    </dl>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/toasts.js"></script>

    <script>
        const API = 'https://ceai-web-production.up.railway.app';
        let chartContenidoRef = null;
        let chartContactosRef = null;
        let contactosCache = [];
        let noticiasCache = [];
        let semillerosCache = [];
        let proyectosCache = [];
        let documentosCache = [];
        let todosLosSemilleros = [];

        // ===== SIDEBAR MOBILE =====
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('show');
            sidebarOverlay.classList.toggle('show');
        });
        sidebarOverlay.addEventListener('click', () => {
            sidebar.classList.remove('show');
            sidebarOverlay.classList.remove('show');
        });
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 992) {
                    sidebar.classList.remove('show');
                    sidebarOverlay.classList.remove('show');
                }
            });
        });

        // ===== NAVEGACI√ìN =====
        function irSeccion(id) {
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.sidebar-link').forEach(el => el.classList.remove('active'));
            document.querySelector(`.sidebar-link[data-section="${id}"]`).classList.add('active');
            if (id === 'noticias') cargarNoticias();
            if (id === 'semilleros') cargarSemilleros();
            if (id === 'proyectos') cargarProyectos();
            if (id === 'documentos') cargarDocumentos();
            if (id === 'contactos') cargarContactos();
            if (id === 'dashboard') cargarDashboard();
        }
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', () => irSeccion(link.dataset.section));
        });

        // ===== DASHBOARD =====
        async function cargarDashboard() {
            const [noticias, semilleros, proyectos, documentos, contactos] = await Promise.all([
                fetch(`${API}/api/noticias`).then(r => r.json()),
                fetch(`${API}/api/semilleros`).then(r => r.json()),
                fetch(`${API}/api/proyectos`).then(r => r.json()),
                fetch(`${API}/api/documentos`).then(r => r.json()),
                fetch(`${API}/api/contactos`).then(r => r.json())
            ]);

            document.getElementById('countNoticias').textContent   = noticias.length;
            document.getElementById('countSemilleros').textContent = semilleros.length;
            document.getElementById('countProyectos').textContent  = proyectos.length;
            document.getElementById('countDocumentos').textContent = documentos.length;

            const ctx1 = document.getElementById('chartContenido').getContext('2d');
            if (chartContenidoRef) chartContenidoRef.destroy();
            chartContenidoRef = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['Noticias', 'Semilleros', 'Proyectos', 'Documentos'],
                    datasets: [{ data: [noticias.length, semilleros.length, proyectos.length, documentos.length], backgroundColor: ['#39A900','#2d8a00','#00304D','#76c043'] }]
                },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { precision: 0 } } } }
            });

            const porDia = {};
            contactos.forEach(c => {
                if (!c.created_at) return;
                const key = new Date(c.created_at).toLocaleDateString('es-ES');
                porDia[key] = (porDia[key] || 0) + 1;
            });
            const ctx2 = document.getElementById('chartContactos').getContext('2d');
            if (chartContactosRef) chartContactosRef.destroy();
            chartContactosRef = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: Object.keys(porDia),
                    datasets: [{ data: Object.values(porDia), borderColor: '#39A900', backgroundColor: 'rgba(57,169,0,0.2)', tension: 0.3, fill: true, pointRadius: 4 }]
                },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { precision: 0 } } } }
            });

            document.getElementById('ultimasNoticias').innerHTML = noticias.slice(-5).reverse()
                .map(n => `<li class="list-group-item d-flex justify-content-between"><span>${n.titulo}</span><small class="text-muted">${n.fecha}</small></li>`).join('');

            document.getElementById('ultimosContactos').innerHTML = contactos.slice(-5).reverse()
                .map(c => `<li class="list-group-item d-flex justify-content-between"><span>${c.nombre}</span><small class="text-muted">${c.created_at ? new Date(c.created_at).toLocaleDateString('es-ES') : ''}</small></li>`).join('');
        }

        // ===== NOTICIAS =====
        async function cargarNoticias() {
            const res = await fetch(`${API}/api/noticias`);
            noticiasCache = await res.json();
            const lista = document.getElementById('listaNoticias');
            if (!noticiasCache.length) { lista.innerHTML = '<p class="text-muted">No hay noticias a√∫n</p>'; return; }
            lista.innerHTML = `
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th><th>T√≠tulo</th><th>Fecha</th><th>Tipo</th><th>Dest.</th><th class="text-center col-acciones">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${noticiasCache.map(n => `
                            <tr>
                                <td>${n.id}</td>
                                <td>${n.titulo}</td>
                                <td>${n.fecha}</td>
                                <td><span class="badge bg-secondary">${n.tipo || 'Noticia'}</span></td>
                                <td>${n.destacada == 1 ? '‚≠ê' : '‚Äî'}</td>
                                <td class="col-acciones">
                                    <div class="table-actions">
                                        <button class="btn btn-sm btn-outline-primary" onclick="verNoticia(${n.id})" title="Ver detalle">üëÅÔ∏è Ver</button>
                                        <button class="btn btn-sm btn-warning" onclick="editarNoticia(${n.id})" title="Editar">‚úèÔ∏è Editar</button>
                                        <button class="btn btn-sm btn-danger" onclick="eliminarNoticia(${n.id})" title="Eliminar">üóëÔ∏è Eliminar</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>`;
        }

        function verNoticia(id) {
            const n = noticiasCache.find(x => x.id === id);
            if (!n) return;
            document.getElementById('vn_titulo').textContent = n.titulo;
            document.getElementById('vn_fecha').textContent = n.fecha;
            document.getElementById('vn_tipo').textContent = n.tipo || 'Noticia';
            document.getElementById('vn_destacada').textContent = n.destacada == 1 ? '‚≠ê S√≠' : 'No';
            document.getElementById('vn_descripcion').textContent = n.descripcion;
            const img = document.getElementById('vn_imagen');
            if (n.imagen) { img.src = n.imagen; img.style.display = 'block'; } else { img.style.display = 'none'; }
            new bootstrap.Modal(document.getElementById('verNoticiaModal')).show();
        }

        function editarNoticia(id) {
            const n = noticiasCache.find(x => x.id === id);
            if (!n) return;
            document.getElementById('edit_n_id').value = n.id;
            document.getElementById('edit_n_titulo').value = n.titulo;
            document.getElementById('edit_n_fecha').value = n.fecha;
            document.getElementById('edit_n_tipo').value = n.tipo || 'Noticia';
            document.getElementById('edit_n_descripcion').value = n.descripcion;
            document.getElementById('edit_n_imagen').value = n.imagen || '';
            document.getElementById('edit_n_destacada').checked = n.destacada == 1;
            new bootstrap.Modal(document.getElementById('editarNoticiaModal')).show();
        }

        async function guardarEdicionNoticia() {
            const id = document.getElementById('edit_n_id').value;
            const datos = {
                titulo: document.getElementById('edit_n_titulo').value,
                descripcion: document.getElementById('edit_n_descripcion').value,
                fecha: document.getElementById('edit_n_fecha').value,
                imagen: document.getElementById('edit_n_imagen').value,
                tipo: document.getElementById('edit_n_tipo').value,
                destacada: document.getElementById('edit_n_destacada').checked ? 1 : 0
            };
            const res = await fetch(`${API}/api/noticias/${id}`, {
                method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(datos)
            });
            if (res.ok) {
                bootstrap.Modal.getInstance(document.getElementById('editarNoticiaModal')).hide();
                toast.success('Noticia actualizada');
                cargarNoticias(); cargarDashboard();
            } else { toast.error('Error al actualizar noticia'); }
        }

        document.getElementById('formNoticia').addEventListener('submit', async (e) => {
            e.preventDefault();
            const datos = {
                titulo: document.getElementById('noticiaTitulo').value,
                descripcion: document.getElementById('noticiaDescripcion').value,
                fecha: document.getElementById('noticiaFecha').value,
                imagen: document.getElementById('noticiaImagen').value,
                tipo: document.getElementById('noticiaTipo').value,
                destacada: document.getElementById('noticiaDestacada').checked ? 1 : 0
            };
            const res = await fetch(`${API}/api/noticias`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(datos)
            });
            if (res.ok) {
                toast.success('Noticia creada');
                document.getElementById('formNoticia').reset();
                cargarNoticias(); cargarDashboard();
            } else { toast.error('Error al crear noticia'); }
        });

        async function eliminarNoticia(id) {
            if (!confirm('¬øEliminar esta noticia?')) return;
            const res = await fetch(`${API}/api/noticias/${id}`, { method: 'DELETE' });
            if (res.ok) { toast.info('Noticia eliminada'); cargarNoticias(); cargarDashboard(); }
            else { toast.error('Error al eliminar'); }
        }

        // ===== SEMILLEROS =====
        async function cargarSemilleros() {
            const res = await fetch(`${API}/api/semilleros`);
            semillerosCache = await res.json();
            todosLosSemilleros = semillerosCache;

            const categoriaSelect = document.getElementById('proyectoCategoria');
            if (categoriaSelect && !categoriaSelect.dataset.listenerSet) {
                categoriaSelect.dataset.listenerSet = 'true';
                categoriaSelect.addEventListener('change', function () {
                    filtrarSemillerosEnProyecto(this.value, 'proyectoSemillero');
                });
            }

            const lista = document.getElementById('listaSemilleros');
            if (!semillerosCache.length) { lista.innerHTML = '<p class="text-muted">No hay semilleros a√∫n</p>'; return; }
            lista.innerHTML = `
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr><th>ID</th><th>Nombre</th><th>Categor√≠a</th><th>L√≠nea</th><th class="text-center col-acciones">Acciones</th></tr>
                    </thead>
                    <tbody>
                        ${semillerosCache.map(s => `
                            <tr>
                                <td>${s.id}</td>
                                <td>${s.nombre}</td>
                                <td><span class="badge bg-info text-dark">${s.categoria || 'Sin categor√≠a'}</span></td>
                                <td>${s.linea}</td>
                                <td class="col-acciones">
                                    <div class="table-actions">
                                        <button class="btn btn-sm btn-outline-primary" onclick="verSemillero(${s.id})" title="Ver">üëÅÔ∏è Ver</button>
                                        <button class="btn btn-sm btn-warning" onclick="editarSemillero(${s.id})" title="Editar">‚úèÔ∏è Editar</button>
                                        <button class="btn btn-sm btn-danger" onclick="eliminarSemillero(${s.id})" title="Eliminar">üóëÔ∏è Eliminar</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>`;
        }

        function filtrarSemillerosEnProyecto(categoria, selectId) {
            const select = document.getElementById(selectId);
            if (!categoria) {
                select.disabled = true;
                select.innerHTML = '<option value="">-- Selecciona categor√≠a primero --</option>';
                return;
            }
            select.disabled = false;
            const filtrados = todosLosSemilleros.filter(s => s.categoria === categoria);
            select.innerHTML = filtrados.length
                ? '<option value="">-- Seleccionar semillero --</option>' + filtrados.map(s => `<option value="${s.id}">${s.nombre}</option>`).join('')
                : '<option value="">No hay semilleros en esta categor√≠a</option>';
        }

        function verSemillero(id) {
            const s = semillerosCache.find(x => x.id === id);
            if (!s) return;
            document.getElementById('vs_nombre').textContent = s.nombre;
            document.getElementById('vs_categoria').textContent = s.categoria || 'Sin categor√≠a';
            document.getElementById('vs_linea').textContent = s.linea;
            document.getElementById('vs_enfoque').textContent = s.enfoque;
            document.getElementById('vs_descripcion').textContent = s.descripcion;
            const img = document.getElementById('vs_imagen');
            if (s.imagen) { img.src = s.imagen; img.style.display = 'block'; } else { img.style.display = 'none'; }
            new bootstrap.Modal(document.getElementById('verSemilleroModal')).show();
        }

        function editarSemillero(id) {
            const s = semillerosCache.find(x => x.id === id);
            if (!s) return;
            document.getElementById('edit_s_id').value = s.id;
            document.getElementById('edit_s_categoria').value = s.categoria || 'Soluciones Digitales';
            document.getElementById('edit_s_nombre').value = s.nombre;
            document.getElementById('edit_s_linea').value = s.linea;
            document.getElementById('edit_s_enfoque').value = s.enfoque;
            document.getElementById('edit_s_imagen').value = s.imagen || '';
            document.getElementById('edit_s_descripcion').value = s.descripcion;
            new bootstrap.Modal(document.getElementById('editarSemilleroModal')).show();
        }

        async function guardarEdicionSemillero() {
            const id = document.getElementById('edit_s_id').value;
            const datos = {
                nombre: document.getElementById('edit_s_nombre').value,
                linea: document.getElementById('edit_s_linea').value,
                enfoque: document.getElementById('edit_s_enfoque').value,
                descripcion: document.getElementById('edit_s_descripcion').value,
                imagen: document.getElementById('edit_s_imagen').value,
                categoria: document.getElementById('edit_s_categoria').value
            };
            const res = await fetch(`${API}/api/semilleros/${id}`, {
                method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(datos)
            });
            if (res.ok) {
                bootstrap.Modal.getInstance(document.getElementById('editarSemilleroModal')).hide();
                toast.success('Semillero actualizado');
                cargarSemilleros(); cargarDashboard();
            } else { toast.error('Error al actualizar semillero'); }
        }

        document.getElementById('formSemillero').addEventListener('submit', async (e) => {
            e.preventDefault();
            const datos = {
                nombre: document.getElementById('semilleroNombre').value,
                linea: document.getElementById('semilleroLinea').value,
                enfoque: document.getElementById('semilleroEnfoque').value,
                descripcion: document.getElementById('semilleroDescripcion').value,
                imagen: document.getElementById('semilleroImagen').value,
                categoria: document.getElementById('semilleroCategoria').value
            };
            const res = await fetch(`${API}/api/semilleros`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(datos)
            });
            if (res.ok) {
                toast.success('Semillero creado');
                document.getElementById('formSemillero').reset();
                cargarSemilleros(); cargarDashboard();
            } else { toast.error('Error al crear semillero'); }
        });

        async function eliminarSemillero(id) {
            if (!confirm('¬øEliminar este semillero? Tambi√©n se eliminar√°n sus proyectos asociados.')) return;
            const res = await fetch(`${API}/api/semilleros/${id}`, { method: 'DELETE' });
            if (res.ok) { toast.info('Semillero eliminado'); cargarSemilleros(); cargarDashboard(); }
            else { toast.error('Error al eliminar'); }
        }

        // ===== PROYECTOS =====
        async function cargarProyectos() {
            const res = await fetch(`${API}/api/proyectos`);
            proyectosCache = await res.json();

            if (!todosLosSemilleros.length) {
                const resSem = await fetch(`${API}/api/semilleros`);
                todosLosSemilleros = await resSem.json();
            }

            const editSelect = document.getElementById('edit_p_semillero');
            editSelect.innerHTML = todosLosSemilleros.map(s => `<option value="${s.id}">${s.nombre} (${s.categoria})</option>`).join('');

            const lista = document.getElementById('listaProyectos');
            if (!proyectosCache.length) { lista.innerHTML = '<p class="text-muted">No hay proyectos a√∫n</p>'; return; }
            lista.innerHTML = `
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr><th>ID</th><th>T√≠tulo</th><th>Semillero</th><th>Estado</th><th class="text-center col-acciones">Acciones</th></tr>
                    </thead>
                    <tbody>
                        ${proyectosCache.map(p => {
                            const semNombre = todosLosSemilleros.find(s => s.id === p.semillero_id);
                            const badgeClass = p.estado === 'En ejecuci√≥n' ? 'bg-primary' : p.estado === 'Finalizado' ? 'bg-success' : 'bg-warning text-dark';
                            return `
                            <tr>
                                <td>${p.id}</td>
                                <td>${p.titulo}</td>
                                <td><small>${semNombre ? semNombre.nombre : 'ID: ' + p.semillero_id}</small></td>
                                <td><span class="badge ${badgeClass}">${p.estado}</span></td>
                                <td class="col-acciones">
                                    <div class="table-actions">
                                        <button class="btn btn-sm btn-outline-primary" onclick="verProyecto(${p.id})" title="Ver">üëÅÔ∏è Ver</button>
                                        <button class="btn btn-sm btn-warning" onclick="editarProyecto(${p.id})" title="Editar">‚úèÔ∏è Editar</button>
                                        <button class="btn btn-sm btn-danger" onclick="eliminarProyecto(${p.id})" title="Eliminar">üóëÔ∏è Eliminar</button>
                                    </div>
                                </td>
                            </tr>`;
                        }).join('')}
                    </tbody>
                </table>`;
        }

        function verProyecto(id) {
            const p = proyectosCache.find(x => x.id === id);
            if (!p) return;
            const semNombre = todosLosSemilleros.find(s => s.id === p.semillero_id);
            document.getElementById('vp_titulo').textContent = p.titulo;
            document.getElementById('vp_semillero').textContent = semNombre ? `${semNombre.nombre} (ID: ${p.semillero_id})` : `ID: ${p.semillero_id}`;
            const badge = document.getElementById('vp_estado');
            badge.textContent = p.estado;
            badge.className = 'badge ' + (p.estado === 'En ejecuci√≥n' ? 'bg-primary' : p.estado === 'Finalizado' ? 'bg-success' : 'bg-warning text-dark');
            document.getElementById('vp_aliados').textContent = p.aliados || '‚Äî';
            document.getElementById('vp_objetivo').textContent = p.objetivo || '‚Äî';
            document.getElementById('vp_entregables').textContent = p.entregables || '‚Äî';
            document.getElementById('vp_evidencia').textContent = p.evidencia || '‚Äî';
            new bootstrap.Modal(document.getElementById('verProyectoModal')).show();
        }

        function editarProyecto(id) {
            const p = proyectosCache.find(x => x.id === id);
            if (!p) return;
            document.getElementById('edit_p_id').value = p.id;
            document.getElementById('edit_p_semillero').value = p.semillero_id;
            document.getElementById('edit_p_titulo').value = p.titulo;
            document.getElementById('edit_p_estado').value = p.estado;
            document.getElementById('edit_p_aliados').value = p.aliados || '';
            document.getElementById('edit_p_objetivo').value = p.objetivo || '';
            document.getElementById('edit_p_entregables').value = p.entregables || '';
            document.getElementById('edit_p_evidencia').value = p.evidencia || '';
            new bootstrap.Modal(document.getElementById('editarProyectoModal')).show();
        }

        async function guardarEdicionProyecto() {
            const id = document.getElementById('edit_p_id').value;
            const datos = {
                semillero_id: document.getElementById('edit_p_semillero').value,
                titulo: document.getElementById('edit_p_titulo').value,
                estado: document.getElementById('edit_p_estado').value,
                aliados: document.getElementById('edit_p_aliados').value,
                objetivo: document.getElementById('edit_p_objetivo').value,
                entregables: document.getElementById('edit_p_entregables').value,
                evidencia: document.getElementById('edit_p_evidencia').value
            };
            const res = await fetch(`${API}/api/proyectos/${id}`, {
                method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(datos)
            });
            if (res.ok) {
                bootstrap.Modal.getInstance(document.getElementById('editarProyectoModal')).hide();
                toast.success('Proyecto actualizado');
                cargarProyectos(); cargarDashboard();
            } else { toast.error('Error al actualizar proyecto'); }
        }

        document.getElementById('formProyecto').addEventListener('submit', async (e) => {
            e.preventDefault();
            const datos = {
                semillero_id: document.getElementById('proyectoSemillero').value,
                titulo: document.getElementById('proyectoTitulo').value,
                estado: document.getElementById('proyectoEstado').value,
                aliados: document.getElementById('proyectoAliados').value,
                objetivo: document.getElementById('proyectoObjetivo').value,
                entregables: document.getElementById('proyectoEntregables').value,
                evidencia: document.getElementById('proyectoEvidencia').value
            };
            const res = await fetch(`${API}/api/proyectos`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(datos)
            });
            if (res.ok) {
                toast.success('Proyecto creado');
                document.getElementById('formProyecto').reset();
                document.getElementById('proyectoSemillero').disabled = true;
                cargarProyectos(); cargarDashboard();
            } else { toast.error('Error al crear proyecto'); }
        });

        async function eliminarProyecto(id) {
            if (!confirm('¬øEliminar este proyecto?')) return;
            const res = await fetch(`${API}/api/proyectos/${id}`, { method: 'DELETE' });
            if (res.ok) { toast.info('Proyecto eliminado'); cargarProyectos(); cargarDashboard(); }
            else { toast.error('Error al eliminar'); }
        }

        // ===== DOCUMENTOS =====
        const dropZone = document.getElementById('dropZone');
        const docArchivo = document.getElementById('docArchivo');
        const dropText = document.getElementById('dropText');
        const fileSelected = document.getElementById('fileSelected');
        const fileName = document.getElementById('fileName');

        dropZone.addEventListener('click', () => docArchivo.click());
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.style.backgroundColor = 'rgba(57,169,0,0.1)'; });
        dropZone.addEventListener('dragleave', () => { dropZone.style.backgroundColor = 'transparent'; });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault(); dropZone.style.backgroundColor = 'transparent';
            const files = e.dataTransfer.files;
            if (files.length > 0) { docArchivo.files = files; actualizarNombreArchivo(files[0]); }
        });
        docArchivo.addEventListener('change', () => { if (docArchivo.files.length > 0) actualizarNombreArchivo(docArchivo.files[0]); });

        function actualizarNombreArchivo(file) {
            if (file.type !== 'application/pdf') {
                toast.warning('Solo se permiten archivos PDF');
                docArchivo.value = ''; dropText.style.display = 'block'; fileSelected.style.display = 'none'; return;
            }
            fileName.textContent = file.name;
            dropText.style.display = 'none'; fileSelected.style.display = 'block';
        }

        async function cargarDocumentos() {
            const res = await fetch(`${API}/api/documentos`);
            documentosCache = await res.json();
            const lista = document.getElementById('listaDocumentos');
            if (!documentosCache.length) { lista.innerHTML = '<p class="text-muted">No hay documentos a√∫n</p>'; return; }
            lista.innerHTML = `
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr><th>ID</th><th>Nombre</th><th>Tipo</th><th>Descripci√≥n</th><th class="text-center col-acciones">Acciones</th></tr>
                    </thead>
                    <tbody>
                        ${documentosCache.map(doc => `
                            <tr>
                                <td>${doc.id}</td>
                                <td>${doc.nombre}</td>
                                <td><span class="badge bg-info text-dark">${doc.tipo}</span></td>
                                <td><small class="text-muted">${(doc.descripcion || '').substring(0,60)}${doc.descripcion && doc.descripcion.length > 60 ? '...' : ''}</small></td>
                                <td class="col-acciones">
                                    <div class="table-actions">
                                        <button class="btn btn-sm btn-outline-primary" onclick="verDocumento(${doc.id})" title="Ver">üëÅÔ∏è Ver</button>
                                        <button class="btn btn-sm btn-warning" onclick="editarDocumento(${doc.id})" title="Editar">‚úèÔ∏è Editar</button>
                                        <button class="btn btn-sm btn-danger" onclick="eliminarDocumento(${doc.id})" title="Eliminar">üóëÔ∏è Eliminar</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>`;
        }

        function verDocumento(id) {
            const doc = documentosCache.find(x => x.id === id);
            if (!doc) return;
            document.getElementById('vd_nombre').textContent = doc.nombre;
            document.getElementById('vd_tipo').textContent = doc.tipo;
            document.getElementById('vd_descripcion').textContent = doc.descripcion || 'Sin descripci√≥n';
            const link = document.getElementById('vd_archivo');
            link.href = `${API}${doc.ruta_archivo}`;
            new bootstrap.Modal(document.getElementById('verDocumentoModal')).show();
        }

        function editarDocumento(id) {
            const doc = documentosCache.find(x => x.id === id);
            if (!doc) return;
            document.getElementById('edit_d_id').value = doc.id;
            document.getElementById('edit_d_nombre').value = doc.nombre;
            document.getElementById('edit_d_tipo').value = doc.tipo;
            document.getElementById('edit_d_descripcion').value = doc.descripcion || '';
            new bootstrap.Modal(document.getElementById('editarDocumentoModal')).show();
        }

        async function guardarEdicionDocumento() {
            const id = document.getElementById('edit_d_id').value;
            const datos = {
                nombre: document.getElementById('edit_d_nombre').value,
                tipo: document.getElementById('edit_d_tipo').value,
                descripcion: document.getElementById('edit_d_descripcion').value
            };
            const res = await fetch(`${API}/api/documentos/${id}`, {
                method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(datos)
            });
            if (res.ok) {
                bootstrap.Modal.getInstance(document.getElementById('editarDocumentoModal')).hide();
                toast.success('Documento actualizado');
                cargarDocumentos();
            } else { toast.error('Error al actualizar documento'); }
        }

        document.getElementById('formDocumento').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!docArchivo.files.length) { toast.warning('Por favor selecciona un archivo PDF'); return; }
            const formData = new FormData();
            formData.append('nombre', document.getElementById('docNombre').value);
            formData.append('tipo', document.getElementById('docTipo').value);
            formData.append('descripcion', document.getElementById('docDescripcion').value);
            formData.append('archivo', docArchivo.files[0]);
            try {
                const res = await fetch(`${API}/api/documentos`, { method: 'POST', body: formData });
                if (res.ok) {
                    toast.success('Documento agregado');
                    document.getElementById('formDocumento').reset();
                    docArchivo.value = ''; dropText.style.display = 'block'; fileSelected.style.display = 'none';
                    cargarDocumentos(); cargarDashboard();
                } else { const err = await res.json(); toast.error('Error: ' + (err.error || '')); }
            } catch (err) { toast.error('Error al subir: ' + err.message); }
        });

        async function eliminarDocumento(id) {
            if (!confirm('¬øEliminar este documento?')) return;
            const res = await fetch(`${API}/api/documentos/${id}`, { method: 'DELETE' });
            if (res.ok) { toast.info('Documento eliminado'); cargarDocumentos(); cargarDashboard(); }
            else { toast.error('Error al eliminar'); }
        }

        // ===== CONTACTOS =====
        async function cargarContactos() {
            const res = await fetch(`${API}/api/contactos`);
            contactosCache = await res.json();
            const lista = document.getElementById('listaContactos');
            if (!contactosCache.length) { lista.innerHTML = '<p class="text-muted">No hay mensajes a√∫n</p>'; return; }
            lista.innerHTML = `
                <table class="table table-hover table-sm align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th><th>Nombre</th><th>Email</th><th>Asunto</th><th>Mensaje</th><th>Fecha</th><th class="text-center col-acciones">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${contactosCache.map(c => `
                            <tr class="${c.leido == 1 ? '' : 'fw-bold'}">
                                <td>${c.id}</td>
                                <td>${c.nombre}</td>
                                <td><small>${c.email}</small></td>
                                <td><small>${c.asunto}</small></td>
                                <td style="max-width:160px;"><small class="text-muted text-truncate d-inline-block" style="max-width:150px;">${c.mensaje}</small></td>
                                <td><small>${c.created_at ? new Date(c.created_at).toLocaleDateString('es-ES') : ''}</small></td>
                                <td class="col-acciones">
                                    <div class="table-actions">
                                        <button class="btn btn-sm btn-outline-primary" onclick="verContacto(${c.id})" title="Ver mensaje">üëÅÔ∏è Ver</button>
                                        <button class="btn btn-sm btn-danger" onclick="eliminarContacto(${c.id})" title="Eliminar">üóëÔ∏è Eliminar</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>`;
        }

        function verContacto(id) {
            const c = contactosCache.find(x => x.id === id);
            if (!c) return;
            document.getElementById('detalleNombre').textContent = c.nombre;
            const emailEl = document.getElementById('detalleEmail');
            emailEl.textContent = c.email; emailEl.href = `mailto:${c.email}`;
            document.getElementById('detalleAsunto').textContent = c.asunto;
            document.getElementById('detalleFecha').textContent = c.created_at ? new Date(c.created_at).toLocaleString('es-ES') : '';
            document.getElementById('detalleMensaje').textContent = c.mensaje;
            new bootstrap.Modal(document.getElementById('contactoModal')).show();
            if (c.leido != 1) {
                fetch(`${API}/api/contactos/${id}`, {
                    method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ leido: 1 })
                }).then(() => { c.leido = 1; cargarContactos(); });
            }
        }

        async function eliminarContacto(id) {
            if (!confirm('¬øEliminar este mensaje?')) return;
            const res = await fetch(`${API}/api/contactos/${id}`, { method: 'DELETE' });
            if (res.ok) { toast.info('Mensaje eliminado'); cargarContactos(); cargarDashboard(); }
            else { toast.error('Error al eliminar'); }
        }

        // ===== INIT =====
        cargarDashboard();
    </script>
</body>
</html>
