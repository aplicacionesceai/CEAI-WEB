<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo - CEAI SENA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ===== BASE ===== */
        *, *::before, *::after { box-sizing: border-box; }
        html, body { height: 100%; margin: 0; padding: 0; }
        body {
            background: #f0f2f5;
            font-family: 'Roboto', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* ===== OVERRIDE: botones admin NO full-width ===== */
        .admin-btn, .table .btn, .table .btn-sm,
        .modal .btn, .modal .btn-sm,
        .form-section .btn, .quick-actions .btn, .sidebar-footer .btn {
            width: auto !important;
        }

        /* ===== BOTONES TABLA ===== */
        .table-actions { display:flex; align-items:center; justify-content:center; gap:4px; flex-wrap:nowrap; white-space:nowrap; }
        .table-actions .btn { width:auto !important; padding:4px 10px !important; font-size:.78rem !important; font-weight:600 !important; border-radius:6px !important; display:inline-flex; align-items:center; gap:3px; white-space:nowrap; flex-shrink:0; }

        /* ===== SIDEBAR ===== */
        .sidebar {
            background: linear-gradient(180deg, var(--ceai-azul) 0%, #001f33 100%);
            color: white;
            height: 100vh;
            padding: 0;
            position: fixed;
            top: 0; left: 0;
            width: 240px;
            box-shadow: 4px 0 24px rgba(0,0,0,.2);
            z-index: 1000;
            transition: transform .3s ease;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .sidebar-brand {
            padding: 18px 20px 16px;
            border-bottom: 1px solid rgba(57,169,0,.25);
            flex-shrink: 0;
        }

        /* ===== LOGO BRAND (NUEVO) ===== */
        .sidebar-brand__inner {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .sidebar-brand__logo {
            width: 48px;
            height: 48px;
            object-fit: contain;
            flex: 0 0 auto;
            background: rgba(255,255,255,0.95);
            border-radius: 10px;
            padding: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,.25);
            transition: transform .2s ease;
        }
        .sidebar-brand__inner:hover .sidebar-brand__logo {
            transform: scale(1.05);
        }
        .sidebar-brand__texts {
            min-width: 0;
            flex: 1;
        }
        .sidebar-brand__texts h4 {
            color: white;
            font-weight: 800;
            font-size: 1.35rem;
            margin: 0;
            letter-spacing: -.5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .sidebar-brand__texts h4 span { color: var(--ceai-verde); }
        .sidebar-brand__texts small {
            display: block;
            color: rgba(255,255,255,.45);
            font-size: .72rem;
            margin-top: 2px;
            white-space: nowrap;
        }

        .sidebar h5.nav-label { color:rgba(255,255,255,.4); font-size:.7rem; text-transform:uppercase; letter-spacing:1.5px; margin:18px 20px 6px; font-weight:700; flex-shrink:0; }
        .sidebar-link {
            color: rgba(255,255,255,.72);
            margin: 2px 10px;
            cursor: pointer;
            border-radius: 10px;
            padding: 11px 14px;
            transition: all .25s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            font-weight: 500;
            font-size: .88rem;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        .sidebar-link .nav-icon { font-size:1.1rem; width:22px; text-align:center; flex-shrink:0; }
        .sidebar-link .nav-badge { margin-left:auto; background:var(--ceai-verde); color:white; border-radius:20px; padding:1px 7px; font-size:.68rem; font-weight:700; display:none; }
        .sidebar-link.has-badge .nav-badge { display:inline-block; }
        .sidebar-link:hover, .sidebar-link.active {
            background: rgba(57,169,0,.18);
            color: white;
            transform: translateX(3px);
        }
        .sidebar-link.active { background: linear-gradient(90deg, rgba(57,169,0,.28) 0%, rgba(57,169,0,.08) 100%); border-left: 3px solid var(--ceai-verde); padding-left: 11px; }
        .sidebar-nav { flex:1; padding: 6px 0; }
        .sidebar-footer {
            padding: 14px 14px;
            border-top: 1px solid rgba(255,255,255,.08);
            display: flex; flex-direction: column; gap: 8px; flex-shrink: 0;
        }
        .sidebar-footer .btn { width:100% !important; font-size:.83rem; padding:8px 12px; }
        .sidebar::-webkit-scrollbar { width:4px; }
        .sidebar::-webkit-scrollbar-thumb { background:rgba(57,169,0,.4); border-radius:8px; }

        /* ===== LAYOUT ===== */
        .admin-wrapper { display:flex; min-height:100vh; width:100%; }
        .content-wrapper {
            margin-left: 240px;
            width: calc(100% - 240px);
            min-height: 100vh;
            padding: 28px 30px;
            transition: margin-left .3s ease, width .3s ease;
            display: flex; flex-direction: column;
        }
        .content-section { display:none; animation:fadeIn .4s ease; flex:1; }
        .content-section.active { display:flex; flex-direction:column; }
        @keyframes fadeIn { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }

        /* ===== TOP BAR DASHBOARD ===== */
        .dash-topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 12px;
            flex-shrink: 0;
        }
        .dash-topbar-left h2 { color:var(--ceai-azul); font-weight:800; margin:0; font-size:1.6rem; }
        .dash-topbar-left p { color:#6c757d; margin:4px 0 0; font-size:.9rem; }
        .dash-topbar-right { display:flex; gap:10px; align-items:center; }
        .dash-date-badge {
            background: white;
            border-radius: 10px;
            padding: 8px 16px;
            font-size: .82rem;
            color: #495057;
            box-shadow: 0 2px 10px rgba(0,0,0,.07);
            font-weight: 600;
        }
        .btn-refresh {
            background: var(--ceai-verde);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 8px 14px;
            font-size: .82rem;
            font-weight: 600;
            cursor: pointer;
            transition: all .2s;
        }
        .btn-refresh:hover { background: var(--ceai-verde-oscuro); transform: scale(1.05); }

        /* ===== SECTION HEADER ===== */
        .section-header {
            background: linear-gradient(135deg, white 0%, #f8f9fa 100%);
            border-radius: 14px; padding: 22px 28px; margin-bottom: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,.07);
            border-left: 5px solid var(--ceai-verde); flex-shrink:0;
        }
        .section-header h2 { color:var(--ceai-azul); font-weight:800; margin:0; font-size:1.65rem; }
        .section-header p { margin:5px 0 0; color:#6c757d; font-size:.92rem; }

        /* ===== KPI CARDS ===== */
        .kpi-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:18px; margin-bottom:22px; flex-shrink:0; }
        .kpi-card {
            background: white;
            border-radius: 14px;
            padding: 20px 18px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,.07);
            border: 1px solid rgba(0,0,0,.04);
            transition: transform .25s ease, box-shadow .25s ease;
            position: relative;
            overflow: hidden;
        }
        .kpi-card::after { content:''; position:absolute; top:0; right:0; width:4px; height:100%; border-radius:0 14px 14px 0; }
        .kpi-card.kpi-green::after  { background: var(--ceai-verde); }
        .kpi-card.kpi-blue::after   { background: var(--ceai-azul); }
        .kpi-card.kpi-teal::after   { background: #0891b2; }
        .kpi-card.kpi-orange::after { background: #f59e0b; }
        .kpi-card:hover { transform:translateY(-4px); box-shadow:0 8px 24px rgba(0,0,0,.12); }
        .kpi-icon {
            width: 52px; height: 52px; border-radius: 13px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; flex-shrink: 0;
        }
        .kpi-green  .kpi-icon { background: rgba(57,169,0,.12);  }
        .kpi-blue   .kpi-icon { background: rgba(0,48,77,.1);    }
        .kpi-teal   .kpi-icon { background: rgba(8,145,178,.12); }
        .kpi-orange .kpi-icon { background: rgba(245,158,11,.12);}
        .kpi-body { flex:1; min-width:0; }
        .kpi-body .kpi-value { font-size:2rem; font-weight:900; color:#1a1a2e; line-height:1; margin-bottom:3px; }
        .kpi-body .kpi-label { font-size:.78rem; color:#6c757d; font-weight:600; text-transform:uppercase; letter-spacing:.7px; }
        .kpi-body .kpi-sub { font-size:.72rem; color:#9ca3af; margin-top:2px; }

        /* ===== ALERT STRIP ===== */
        .alert-strip {
            background: linear-gradient(90deg, #fff7ed 0%, #fef3c7 100%);
            border: 1px solid #fcd34d;
            border-radius: 12px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-shrink: 0;
            font-size: .88rem;
            color: #92400e;
            font-weight: 500;
        }
        .alert-strip.hidden { display:none; }

        /* ===== QUICK ACTIONS ===== */
        .quick-actions {
            background: linear-gradient(135deg, var(--ceai-azul) 0%, #005580 100%);
            color: white; border-radius: 14px; padding: 18px 22px;
            margin-bottom: 22px; box-shadow: 0 4px 18px rgba(0,48,77,.25);
            flex-shrink: 0;
        }
        .quick-actions .qa-label { color:rgba(255,255,255,.6); font-size:.72rem; text-transform:uppercase; letter-spacing:1.2px; font-weight:700; margin-bottom:10px; }
        .quick-actions .btn { width:auto !important; }
        .quick-actions .d-flex { flex-wrap:wrap; gap:8px; }

        /* ===== CARD BASE ===== */
        .dash-card {
            background: white;
            border-radius: 14px;
            box-shadow: 0 2px 12px rgba(0,0,0,.07);
            border: 1px solid rgba(0,0,0,.04);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .dash-card-header {
            padding: 16px 20px 12px;
            border-bottom: 1px solid #f1f3f5;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }
        .dash-card-header h5 { color:var(--ceai-azul); font-weight:700; margin:0; font-size:.98rem; }
        .dash-card-header .card-action { font-size:.75rem; color:var(--ceai-verde); font-weight:600; cursor:pointer; text-decoration:none; }
        .dash-card-header .card-action:hover { text-decoration:underline; }
        .dash-card-body { padding:18px 20px; flex:1; }
        .dash-card-body.p-0 { padding:0; }

        /* ===== CHARTS GRID ===== */
        .charts-grid-3 { display:grid; grid-template-columns:5fr 4fr 3fr; gap:18px; margin-bottom:20px; align-items:stretch; }
        .charts-grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:18px; margin-bottom:20px; align-items:stretch; }
        .charts-grid-2b { display:grid; grid-template-columns:3fr 2fr; gap:18px; margin-bottom:20px; align-items:stretch; }

        /* ===== ACTIVITY LIST ===== */
        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid #f8f9fa;
        }
        .activity-item:last-child { border-bottom:none; }
        .activity-dot {
            width: 34px; height: 34px; border-radius: 10px;
            display: flex; align-items:center; justify-content:center;
            font-size: .95rem; flex-shrink:0; margin-top:1px;
        }
        .dot-green  { background:rgba(57,169,0,.12); }
        .dot-blue   { background:rgba(0,48,77,.1); }
        .dot-teal   { background:rgba(8,145,178,.12); }
        .dot-orange { background:rgba(245,158,11,.12); }
        .dot-red    { background:rgba(220,53,69,.12); }
        .activity-body .a-title { font-size:.85rem; font-weight:600; color:#1a1a2e; margin-bottom:1px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:200px; }
        .activity-body .a-meta  { font-size:.75rem; color:#9ca3af; }

        /* ===== CONTACT TABLE ===== */
        .mini-contact-table { width:100%; font-size:.82rem; }
        .mini-contact-table th { color:#6c757d; font-weight:700; font-size:.72rem; text-transform:uppercase; letter-spacing:.6px; padding:8px 12px; border-bottom:2px solid #f1f3f5; white-space:nowrap; }
        .mini-contact-table td { padding:9px 12px; border-bottom:1px solid #f8f9fa; vertical-align:middle; }
        .mini-contact-table tr:last-child td { border-bottom:none; }
        .mini-contact-table tr:hover td { background:#fafbfc; }

        /* ===== PROGRESS BARS ===== */
        .progress-item { margin-bottom:14px; }
        .progress-item:last-child { margin-bottom:0; }
        .progress-label { display:flex; justify-content:space-between; margin-bottom:5px; font-size:.82rem; }
        .progress-label span:first-child { color:#374151; font-weight:600; }
        .progress-label span:last-child  { color:#6b7280; font-weight:700; }
        .progress-bar-track { background:#f1f3f5; border-radius:20px; height:8px; overflow:hidden; }
        .progress-bar-fill  { height:100%; border-radius:20px; transition:width .8s ease; }
        .fill-green  { background: linear-gradient(90deg,#39a900,#4dc800); }
        .fill-blue   { background: linear-gradient(90deg,#00304d,#005580); }
        .fill-teal   { background: linear-gradient(90deg,#0891b2,#06b6d4); }
        .fill-orange { background: linear-gradient(90deg,#f59e0b,#fbbf24); }

        /* ===== ESTADO CHIP ===== */
        .chip { display:inline-flex; align-items:center; gap:4px; padding:3px 9px; border-radius:20px; font-size:.72rem; font-weight:700; }
        .chip-green  { background:rgba(57,169,0,.12);  color:#2d7a00; }
        .chip-blue   { background:rgba(0,85,128,.12);  color:#004566; }
        .chip-yellow { background:rgba(245,158,11,.15);color:#92400e; }
        .chip-red    { background:rgba(220,53,69,.12); color:#b02a37; }

        /* ===== FORM SECTION ===== */
        .form-section {
            background:white; padding:26px 30px; border-radius:14px; margin-bottom:26px;
            box-shadow:0 2px 12px rgba(0,0,0,.07); border-top:4px solid var(--ceai-verde); flex-shrink:0;
        }
        .form-section h5 { color:var(--ceai-azul); font-weight:700; margin-bottom:20px; font-size:1.1rem; }

        /* ===== TABLE SECTION ===== */
        .table-section {
            background:white; border-radius:14px; padding:22px 26px;
            box-shadow:0 2px 12px rgba(0,0,0,.07); overflow-x:auto; flex:1;
        }
        .table-section h5 { color:var(--ceai-azul); font-weight:700; margin-bottom:16px; font-size:1.05rem; }
        .table { width:100%; table-layout:auto; }
        .table thead th {
            border-top:none; border-bottom:3px solid var(--ceai-verde);
            color:var(--ceai-azul); font-weight:700; text-transform:uppercase;
            font-size:.78rem; letter-spacing:.7px; padding:11px 13px;
            vertical-align:middle; white-space:nowrap;
        }
        .table tbody tr { transition:background .2s ease; }
        .table tbody tr:hover { background-color:rgba(57,169,0,.04); }
        .table td { vertical-align:middle; padding:9px 13px; font-size:.88rem; }
        .table th.col-acciones, .table td.col-acciones { width:1%; white-space:nowrap; text-align:center; }

        /* ===== QUILL ===== */
        .quill-wrapper { border-radius:8px; overflow:hidden; border:1px solid #ced4da; }
        .quill-wrapper .ql-toolbar { border:none; border-bottom:1px solid #ced4da; background:#f8f9fa; padding:8px 10px; }
        .quill-wrapper .ql-container { border:none; font-family:'Roboto',sans-serif; font-size:14px; }
        .quill-wrapper .ql-editor { min-height:160px; max-height:320px; overflow-y:auto; }
        .quill-wrapper:focus-within { border-color:var(--ceai-verde); box-shadow:0 0 0 3px rgba(57,169,0,.15); }
        .form-label.quill-label { font-size:.9rem; font-weight:600; margin-bottom:6px; color:#333; }

        /* ===== MISC ===== */
        .sidebar-toggle { display:none; position:fixed; top:16px; left:14px; z-index:1100; background:var(--ceai-verde); color:white; border:none; padding:10px 13px; border-radius:10px; font-size:1.15rem; box-shadow:0 4px 14px rgba(57,169,0,.4); cursor:pointer; transition:all .25s; }
        .sidebar-toggle:hover { background:var(--ceai-verde-oscuro); }
        .sidebar-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.5); z-index:999; opacity:0; transition:opacity .3s; backdrop-filter:blur(3px); }
        .sidebar-overlay.show { display:block; opacity:1; }
        .detail-box { white-space:pre-wrap; word-wrap:break-word; background:#f8f9fa; padding:12px; border-radius:10px; border:1px solid #e0e0e0; max-height:200px; overflow-y:auto; font-size:.88rem; }
        #listaContactos .table { min-width:700px; }
        #listaContactos td:nth-child(5) { max-width:150px; }
        #listaContactos td:nth-child(5) small { display:block; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:150px; }

        /* ===== MODAL ===== */
        .modal-content { border-radius:14px; border:none; box-shadow:0 15px 50px rgba(0,0,0,.2); }
        .modal-header { background:linear-gradient(90deg,var(--ceai-verde),var(--ceai-verde-light)); color:white; border-radius:14px 14px 0 0; border:none; padding:16px 24px; }
        .modal-header .modal-title { color:white; font-weight:700; }
        .modal-header .btn-close { filter:brightness(0) invert(1); }
        .modal-footer .btn { width:auto !important; }

        /* ===== RESPONSIVE ===== */
        @media (max-width:1400px) { .charts-grid-3 { grid-template-columns:1fr 1fr; } .charts-grid-3 > :last-child { grid-column:1/-1; } }
        @media (max-width:1280px) { .sidebar { width:220px; } .content-wrapper { margin-left:220px; width:calc(100% - 220px); padding:24px; } }
        @media (max-width:1100px) { .kpi-grid { grid-template-columns:repeat(2,1fr); } .charts-grid-3 { grid-template-columns:1fr; } .charts-grid-2 { grid-template-columns:1fr; } .charts-grid-2b { grid-template-columns:1fr; } }
        @media (max-width:992px) {
            .sidebar { transform:translateX(-100%); width:260px; }
            .sidebar.show { transform:translateX(0); }
            .content-wrapper { margin-left:0; width:100%; padding:76px 18px 22px; }
            .sidebar-toggle { display:block; }
            .section-header h2 { font-size:1.4rem; }
            .dash-topbar-left h2 { font-size:1.3rem; }
            .kpi-grid { grid-template-columns:repeat(2,1fr); gap:14px; }
        }
        @media (max-width:768px) {
            .content-wrapper { padding:72px 13px 18px; }
            .kpi-grid { grid-template-columns:repeat(2,1fr); gap:12px; }
            .kpi-card { padding:14px 12px; gap:10px; }
            .kpi-icon { width:42px; height:42px; font-size:1.2rem; }
            .kpi-body .kpi-value { font-size:1.65rem; }
            .charts-grid-3, .charts-grid-2, .charts-grid-2b { grid-template-columns:1fr; }
            .dash-topbar { flex-direction:column; align-items:flex-start; }
            .dash-topbar-right { width:100%; justify-content:flex-end; }
            .section-header { padding:16px 18px; }
            .form-section { padding:18px 16px; }
            .table-section { padding:14px 13px; }
            .table thead th { font-size:.73rem; padding:9px 9px; }
            .table td { font-size:.83rem; padding:8px 9px; }
            .table-actions .btn { padding:3px 7px !important; font-size:.71rem !important; }
            .quick-actions { padding:16px 16px; }
        }
        @media (max-width:576px) {
            .content-wrapper { padding:68px 9px 14px; }
            .kpi-grid { grid-template-columns:1fr 1fr; gap:9px; }
            .kpi-card { padding:12px 10px; border-radius:10px; gap:8px; }
            .kpi-icon { width:36px; height:36px; font-size:1rem; border-radius:9px; }
            .kpi-body .kpi-value { font-size:1.45rem; }
            .kpi-body .kpi-label { font-size:.68rem; }
            .section-header { padding:12px 14px; border-radius:10px; }
            .section-header h2 { font-size:1.1rem; }
            .form-section { padding:12px 11px; border-radius:10px; }
            .table-section { padding:11px 9px; border-radius:10px; }
            .modal-dialog { margin:8px; }
            .modal-body { padding:13px; }
            .sidebar-footer .btn { font-size:.78rem; padding:7px 10px; }
            .quick-actions .btn { width:100% !important; }
            .dash-topbar-right { gap:7px; }
            /* Logo m√°s peque√±o en mobile */
            .sidebar-brand__logo { width:38px; height:38px; }
            .sidebar-brand__texts h4 { font-size:1.1rem; }
        }
        @media (max-width:400px) {
            .kpi-body .kpi-value { font-size:1.3rem; }
            .content-wrapper { padding:64px 7px 12px; }
        }
    </style>
</head>
<body>
    <script>
        if (localStorage.getItem('ceai_admin_logged') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <button class="sidebar-toggle" id="sidebarToggle">‚ò∞</button>

    <div class="admin-wrapper">
        <!-- SIDEBAR -->
        <div class="sidebar" id="sidebar">

            <!-- ‚úÖ BRAND CON LOGO (NUEVO) -->
            <div class="sidebar-brand">
                <div class="sidebar-brand__inner">
                    <img
                        src="https://i.postimg.cc/cHpqyBX5/Logo-sena.jpg"
                        alt="Logo SENA"
                        class="sidebar-brand__logo"
                        loading="lazy"
                        decoding="async"
                    >
                    <div class="sidebar-brand__texts">
                        <h4><span>CEAI</span> Admin</h4>
                        <small>Panel de Control SENA</small>
                    </div>
                </div>
            </div>

            <div class="sidebar-nav">
                <h5 class="nav-label">Principal</h5>
                <div class="sidebar-link active" data-section="dashboard">
                    <span class="nav-icon">üìä</span> Dashboard
                </div>
                <h5 class="nav-label">Gesti√≥n</h5>
                <div class="sidebar-link" data-section="noticias">
                    <span class="nav-icon">üì∞</span> Noticias
                </div>
                <div class="sidebar-link" data-section="semilleros">
                    <span class="nav-icon">üå±</span> Semilleros
                </div>
                <div class="sidebar-link" data-section="proyectos">
                    <span class="nav-icon">üî¨</span> Proyectos
                </div>
                <div class="sidebar-link" data-section="documentos">
                    <span class="nav-icon">üìÑ</span> Documentos
                </div>
                <h5 class="nav-label">Comunicaci√≥n</h5>
                <div class="sidebar-link has-badge" data-section="contactos" id="linkContactos">
                    <span class="nav-icon">üì®</span> Contactos
                    <span class="nav-badge" id="badgeContactos">0</span>
                </div>
            </div>
            <div class="sidebar-footer">
                <button class="btn btn-outline-light btn-sm"
                    onclick="localStorage.removeItem('ceai_admin_logged'); window.location.href='login.html';">üö™ Cerrar sesi√≥n</button>
                <a href="index.html" class="btn btn-outline-light btn-sm">‚Üê Volver al sitio</a>
            </div>
        </div>

        <!-- CONTENIDO PRINCIPAL -->
        <div class="content-wrapper" id="contentWrapper">

            <!-- ==================== DASHBOARD ==================== -->
            <div id="dashboard" class="content-section active">

                <!-- Top Bar -->
                <div class="dash-topbar">
                    <div class="dash-topbar-left">
                        <h2>üìä Panel de Control</h2>
                        <p id="dashSubtitle">Cargando datos del sistema‚Ä¶</p>
                    </div>
                    <div class="dash-topbar-right">
                        <div class="dash-date-badge" id="dashDate"></div>
                        <button class="btn-refresh" onclick="cargarDashboard()">üîÑ Actualizar</button>
                    </div>
                </div>

                <!-- Alerta mensajes no le√≠dos -->
                <div class="alert-strip hidden" id="alertMensajes">
                    <span>‚ö†Ô∏è</span>
                    <span id="alertMensajesText"></span>
                    <a href="#" onclick="irSeccion('contactos'); return false;" style="margin-left:auto; color:#92400e; font-weight:700;">Ver ahora ‚Üí</a>
                </div>

                <!-- KPI Cards -->
                <div class="kpi-grid">
                    <div class="kpi-card kpi-green">
                        <div class="kpi-icon">üì∞</div>
                        <div class="kpi-body">
                            <div class="kpi-value" id="countNoticias">‚Äî</div>
                            <div class="kpi-label">Noticias</div>
                            <div class="kpi-sub" id="subNoticias">publicadas</div>
                        </div>
                    </div>
                    <div class="kpi-card kpi-blue">
                        <div class="kpi-icon">üå±</div>
                        <div class="kpi-body">
                            <div class="kpi-value" id="countSemilleros">‚Äî</div>
                            <div class="kpi-label">Semilleros</div>
                            <div class="kpi-sub" id="subSemilleros">activos</div>
                        </div>
                    </div>
                    <div class="kpi-card kpi-teal">
                        <div class="kpi-icon">üî¨</div>
                        <div class="kpi-body">
                            <div class="kpi-value" id="countProyectos">‚Äî</div>
                            <div class="kpi-label">Proyectos</div>
                            <div class="kpi-sub" id="subProyectos">registrados</div>
                        </div>
                    </div>
                    <div class="kpi-card kpi-orange">
                        <div class="kpi-icon">üì®</div>
                        <div class="kpi-body">
                            <div class="kpi-value" id="countContactos">‚Äî</div>
                            <div class="kpi-label">Mensajes</div>
                            <div class="kpi-sub" id="subContactos">recibidos</div>
                        </div>
                    </div>
                </div>

                <!-- Acciones R√°pidas -->
                <div class="quick-actions">
                    <div class="qa-label">‚ö° Acciones R√°pidas</div>
                    <div class="d-flex">
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('noticias')">+ Nueva Noticia</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('semilleros')">+ Nuevo Semillero</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('proyectos')">+ Nuevo Proyecto</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('documentos')">+ Subir Documento</button>
                        <button class="btn btn-outline-light btn-sm" onclick="irSeccion('contactos')">üì® Ver Contactos</button>
                    </div>
                </div>

                <!-- Fila 1: Gr√°fico barras proyectos + Donut contenido + Estado proyectos -->
                <div class="charts-grid-3">
                    <div class="dash-card">
                        <div class="dash-card-header"><h5>üìä Proyectos por Estado</h5></div>
                        <div class="dash-card-body"><canvas id="chartProyectosEstado" style="max-height:220px;"></canvas></div>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-header"><h5>üóÇÔ∏è Distribuci√≥n de Contenido</h5></div>
                        <div class="dash-card-body"><canvas id="chartContenido" style="max-height:220px;"></canvas></div>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-header"><h5>üìà Resumen</h5></div>
                        <div class="dash-card-body">
                            <div class="progress-item">
                                <div class="progress-label"><span>üì∞ Noticias destacadas</span><span id="pctDestacadas">0</span></div>
                                <div class="progress-bar-track"><div class="progress-bar-fill fill-green" id="barDestacadas" style="width:0%"></div></div>
                            </div>
                            <div class="progress-item">
                                <div class="progress-label"><span>üî¨ En ejecuci√≥n</span><span id="pctEjecucion">0</span></div>
                                <div class="progress-bar-track"><div class="progress-bar-fill fill-teal" id="barEjecucion" style="width:0%"></div></div>
                            </div>
                            <div class="progress-item">
                                <div class="progress-label"><span>‚úÖ Finalizados</span><span id="pctFinalizados">0</span></div>
                                <div class="progress-bar-track"><div class="progress-bar-fill fill-blue" id="barFinalizados" style="width:0%"></div></div>
                            </div>
                            <div class="progress-item">
                                <div class="progress-label"><span>üì© Mensajes sin leer</span><span id="pctSinLeer">0</span></div>
                                <div class="progress-bar-track"><div class="progress-bar-fill fill-orange" id="barSinLeer" style="width:0%"></div></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fila 2: Mensajes contacto + Semilleros por categor√≠a -->
                <div class="charts-grid-2">
                    <div class="dash-card">
                        <div class="dash-card-header"><h5>üì¨ Mensajes de Contacto</h5></div>
                        <div class="dash-card-body"><canvas id="chartContactos" style="max-height:200px;"></canvas></div>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-header"><h5>üå± Semilleros por Categor√≠a</h5></div>
                        <div class="dash-card-body"><canvas id="chartSemillerosCat" style="max-height:200px;"></canvas></div>
                    </div>
                </div>

                <!-- Fila 3: √öltimas noticias + √öltimos contactos -->
                <div class="charts-grid-2b">
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h5>üóûÔ∏è √öltimas Noticias</h5>
                            <a class="card-action" onclick="irSeccion('noticias')">Ver todas ‚Üí</a>
                        </div>
                        <div class="dash-card-body p-0">
                            <div id="actividadNoticias" style="padding:4px 0;"></div>
                        </div>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h5>üì® Mensajes Recientes</h5>
                            <a class="card-action" onclick="irSeccion('contactos')">Ver todos ‚Üí</a>
                        </div>
                        <div class="dash-card-body p-0">
                            <div style="overflow-x:auto;">
                                <table class="mini-contact-table" id="tablaContactos">
                                    <thead><tr><th>Nombre</th><th>Asunto</th><th>Estado</th></tr></thead>
                                    <tbody id="bodyContactos"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

            </div><!-- /dashboard -->

            <!-- ==================== NOTICIAS ==================== -->
            <div id="noticias" class="content-section">
                <div class="section-header"><h2>üì∞ Gestionar Noticias</h2><p class="mb-0">Crear, editar y eliminar noticias</p></div>
                <div class="form-section">
                    <h5 id="tituloFormNoticia">‚ûï Nueva Noticia</h5>
                    <form id="formNoticia">
                        <input type="hidden" id="noticiaEditId">
                        <div class="row">
                            <div class="col-md-6 mb-3"><label class="form-label">T√≠tulo <span class="text-danger">*</span></label><input type="text" class="form-control" id="noticiaTitulo" required></div>
                            <div class="col-md-3 mb-3"><label class="form-label">Fecha <span class="text-danger">*</span></label><input type="date" class="form-control" id="noticiaFecha" required></div>
                            <div class="col-md-3 mb-3"><label class="form-label">Tipo</label><select class="form-control" id="noticiaTipo"><option value="Noticia">Noticia</option><option value="Evento">Evento</option><option value="Convocatoria">Convocatoria</option><option value="Resultado">Resultado</option></select></div>
                            <div class="col-12 mb-3"><label class="form-label quill-label">Descripci√≥n <span class="text-danger">*</span></label><div class="quill-wrapper"><div id="editorNoticia"></div></div><input type="hidden" id="noticiaDescripcion"></div>
                            <div class="col-md-6 mb-3"><label class="form-label">URL Imagen</label><input type="url" class="form-control" id="noticiaImagen" placeholder="https://..."></div>
                            <div class="col-md-6 mb-3 d-flex align-items-end"><div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="noticiaDestacada"><label class="form-check-label" for="noticiaDestacada">‚≠ê Destacar en carousel del home</label></div></div>
                            <div class="col-md-8 mb-3"><button type="submit" class="btn btn-ceai btn-submit-full w-100" id="btnSubmitNoticia">‚úÖ Crear Noticia</button></div>
                            <div class="col-md-4 mb-3"><button type="button" class="btn btn-outline-secondary btn-submit-full w-100" id="btnCancelNoticia" style="display:none" onclick="cancelarEdicionNoticia()">‚úñ Cancelar</button></div>
                        </div>
                    </form>
                </div>
                <div class="table-section"><h5 class="mb-3">üìã Noticias Registradas</h5><div class="table-responsive" id="listaNoticias"></div></div>
            </div>

            <!-- ==================== SEMILLEROS ==================== -->
            <div id="semilleros" class="content-section">
                <div class="section-header"><h2>üå± Gestionar Semilleros</h2><p class="mb-0">Crear, editar y eliminar semilleros</p></div>
                <div class="form-section">
                    <h5 id="tituloFormSemillero">‚ûï Nuevo Semillero</h5>
                    <form id="formSemillero">
                        <input type="hidden" id="semilleroEditId">
                        <div class="row">
                            <div class="col-md-12 mb-3"><label class="form-label">Categor√≠a / Servicio <span class="text-danger">*</span></label><select class="form-control" id="semilleroCategoria" required><option value="Soluciones Digitales">Soluciones Digitales</option><option value="Automatizaci√≥n e Instrumentaci√≥n">Automatizaci√≥n e Instrumentaci√≥n</option><option value="F√°brica Digital Interactiva">F√°brica Digital Interactiva</option><option value="Gesti√≥n Energ√©tica">Gesti√≥n Energ√©tica</option><option value="IA Aplicada al Entorno">IA Aplicada al Entorno</option></select></div>
                            <div class="col-md-6 mb-3"><label class="form-label">Nombre <span class="text-danger">*</span></label><input type="text" class="form-control" id="semilleroNombre" required></div>
                            <div class="col-md-6 mb-3"><label class="form-label">L√≠nea de Investigaci√≥n <span class="text-danger">*</span></label><input type="text" class="form-control" id="semilleroLinea" required></div>
                            <div class="col-md-6 mb-3"><label class="form-label">Enfoque <span class="text-danger">*</span></label><input type="text" class="form-control" id="semilleroEnfoque" required></div>
                            <div class="col-md-6 mb-3"><label class="form-label">URL Imagen</label><input type="url" class="form-control" id="semilleroImagen" placeholder="https://..."></div>
                            <div class="col-12 mb-3"><label class="form-label quill-label">Descripci√≥n <span class="text-danger">*</span></label><div class="quill-wrapper"><div id="editorSemillero"></div></div><input type="hidden" id="semilleroDescripcion"></div>
                            <div class="col-md-8 mb-3"><button type="submit" class="btn btn-ceai btn-submit-full w-100" id="btnSubmitSemillero">‚úÖ Crear Semillero</button></div>
                            <div class="col-md-4 mb-3"><button type="button" class="btn btn-outline-secondary btn-submit-full w-100" id="btnCancelSemillero" style="display:none" onclick="cancelarEdicionSemillero()">‚úñ Cancelar</button></div>
                        </div>
                    </form>
                </div>
                <div class="table-section"><h5 class="mb-3">üìã Semilleros Registrados</h5><div class="table-responsive" id="listaSemilleros"></div></div>
            </div>

            <!-- ==================== PROYECTOS ==================== -->
            <div id="proyectos" class="content-section">
                <div class="section-header"><h2>üî¨ Gestionar Proyectos</h2><p class="mb-0">Crear, editar y eliminar proyectos</p></div>
                <div class="form-section">
                    <h5 id="tituloFormProyecto">‚ûï Nuevo Proyecto</h5>
                    <form id="formProyecto">
                        <input type="hidden" id="proyectoEditId">
                        <div class="row">
                            <div class="col-md-6 mb-3"><label class="form-label">Categor√≠a / Servicio</label><select class="form-control" id="proyectoCategoria"><option value="">-- Seleccionar categor√≠a --</option><option value="Soluciones Digitales">Soluciones Digitales</option><option value="Automatizaci√≥n e Instrumentaci√≥n">Automatizaci√≥n e Instrumentaci√≥n</option><option value="F√°brica Digital Interactiva">F√°brica Digital Interactiva</option><option value="Gesti√≥n Energ√©tica">Gesti√≥n Energ√©tica</option><option value="IA Aplicada al Entorno">IA Aplicada al Entorno</option></select></div>
                            <div class="col-md-6 mb-3"><label class="form-label">Semillero <span class="text-danger">*</span></label><select class="form-control" id="proyectoSemillero" required disabled><option value="">-- Selecciona categor√≠a primero --</option></select></div>
                            <div class="col-md-6 mb-3"><label class="form-label">T√≠tulo <span class="text-danger">*</span></label><input type="text" class="form-control" id="proyectoTitulo" required></div>
                            <div class="col-md-6 mb-3"><label class="form-label">Estado <span class="text-danger">*</span></label><select class="form-control" id="proyectoEstado" required><option value="En ejecuci√≥n">En ejecuci√≥n</option><option value="Finalizado">Finalizado</option><option value="En revisi√≥n">En revisi√≥n</option></select></div>
                            <div class="col-md-6 mb-3"><label class="form-label">Aliados</label><input type="text" class="form-control" id="proyectoAliados"></div>
                            <div class="col-12 mb-3"><label class="form-label">Objetivo</label><textarea class="form-control" id="proyectoObjetivo" rows="2"></textarea></div>
                            <div class="col-12 mb-3"><label class="form-label">Entregables</label><textarea class="form-control" id="proyectoEntregables" rows="2"></textarea></div>
                            <div class="col-12 mb-3"><label class="form-label">Evidencia</label><textarea class="form-control" id="proyectoEvidencia" rows="2"></textarea></div>
                            <div class="col-md-8 mb-3"><button type="submit" class="btn btn-ceai btn-submit-full w-100" id="btnSubmitProyecto">‚úÖ Crear Proyecto</button></div>
                            <div class="col-md-4 mb-3"><button type="button" class="btn btn-outline-secondary btn-submit-full w-100" id="btnCancelProyecto" style="display:none" onclick="cancelarEdicionProyecto()">‚úñ Cancelar</button></div>
                        </div>
                    </form>
                </div>
                <div class="table-section"><h5 class="mb-3">üìã Proyectos Registrados</h5><div class="table-responsive" id="listaProyectos"></div></div>
            </div>

            <!-- ==================== DOCUMENTOS ==================== -->
            <div id="documentos" class="content-section">
                <div class="section-header"><h2>üìÑ Gestionar Documentos</h2><p class="mb-0">Subir, editar y eliminar documentos PDF</p></div>
                <div class="form-section">
                    <h5>‚ûï Nuevo Documento</h5>
                    <form id="formDocumento" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6 mb-3"><label class="form-label">Nombre del Documento <span class="text-danger">*</span></label><input type="text" class="form-control" id="docNombre" required></div>
                            <div class="col-md-6 mb-3"><label class="form-label">Tipo <span class="text-danger">*</span></label><select class="form-control" id="docTipo" required><option value="">-- Seleccionar --</option><option value="Convocatoria">Convocatoria</option><option value="Portafolio">Portafolio de Servicios</option><option value="Informe">Informe</option><option value="Manual">Manual</option><option value="Otro">Otro</option></select></div>
                            <div class="col-12 mb-3"><label class="form-label quill-label">Descripci√≥n</label><div class="quill-wrapper"><div id="editorDocumento"></div></div><input type="hidden" id="docDescripcion"></div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Archivo PDF <span class="text-danger">*</span></label>
                                <div id="dropZone" class="rounded p-5 text-center" style="border:2px dashed var(--ceai-verde);cursor:pointer;transition:all .3s;">
                                    <input type="file" id="docArchivo" class="form-control d-none" accept=".pdf" required>
                                    <div id="dropText"><p style="margin:0;color:var(--ceai-verde);font-weight:bold;">üìÅ Arrastra tu PDF aqu√≠</p><p style="margin:5px 0 0;color:#666;font-size:14px;">o haz clic para seleccionar</p></div>
                                    <div id="fileSelected" style="display:none;color:var(--ceai-verde);"><p style="margin:0;font-weight:bold;">‚úÖ Archivo listo:</p><p id="fileName" style="margin:5px 0 0;"></p></div>
                                </div>
                            </div>
                            <div class="col-12 mb-3"><button type="submit" class="btn btn-ceai btn-submit-full w-100">üì§ Subir Documento</button></div>
                        </div>
                    </form>
                </div>
                <div class="table-section"><h5 class="mb-3">üìã Documentos Registrados</h5><div class="table-responsive" id="listaDocumentos"></div></div>
            </div>

            <!-- ==================== CONTACTOS ==================== -->
            <div id="contactos" class="content-section">
                <div class="section-header"><h2>üì® Mensajes de Contacto</h2><p class="mb-0">Ver y gestionar mensajes recibidos</p></div>
                <div class="table-section"><h5 class="mb-3">üìã Mensajes Recibidos</h5><div class="table-responsive" id="listaContactos"></div></div>
            </div>

        </div><!-- /content-wrapper -->
    </div><!-- /admin-wrapper -->

    <!-- ===== MODALES ===== -->
    <div class="modal fade" id="verProyectoModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">üëÅÔ∏è Detalle de Proyecto</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <p><strong>T√≠tulo:</strong> <span id="vp_titulo"></span></p>
                    <p><strong>Semillero:</strong> <span id="vp_semillero"></span></p>
                    <p><strong>Estado:</strong> <span id="vp_estado" class="badge"></span></p>
                    <p><strong>Aliados:</strong> <span id="vp_aliados"></span></p>
                    <hr>
                    <p><strong>Objetivo:</strong></p><div class="detail-box mb-3" id="vp_objetivo"></div>
                    <p><strong>Entregables:</strong></p><div class="detail-box mb-3" id="vp_entregables"></div>
                    <p><strong>Evidencia:</strong></p><div class="detail-box" id="vp_evidencia"></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editarProyectoModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">‚úèÔ∏è Editar Proyecto</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="formEditarProyecto">
                        <input type="hidden" id="edit_p_id">
                        <div class="row">
                            <div class="col-md-6 mb-3"><label class="form-label">Semillero <span class="text-danger">*</span></label><select class="form-control" id="edit_p_semillero" required></select></div>
                            <div class="col-md-6 mb-3"><label class="form-label">T√≠tulo <span class="text-danger">*</span></label><input type="text" class="form-control" id="edit_p_titulo" required></div>
                            <div class="col-md-6 mb-3"><label class="form-label">Estado</label><select class="form-control" id="edit_p_estado"><option value="En ejecuci√≥n">En ejecuci√≥n</option><option value="Finalizado">Finalizado</option><option value="En revisi√≥n">En revisi√≥n</option></select></div>
                            <div class="col-md-6 mb-3"><label class="form-label">Aliados</label><input type="text" class="form-control" id="edit_p_aliados"></div>
                            <div class="col-12 mb-3"><label class="form-label">Objetivo</label><textarea class="form-control" id="edit_p_objetivo" rows="2"></textarea></div>
                            <div class="col-12 mb-3"><label class="form-label">Entregables</label><textarea class="form-control" id="edit_p_entregables" rows="2"></textarea></div>
                            <div class="col-12 mb-3"><label class="form-label">Evidencia</label><textarea class="form-control" id="edit_p_evidencia" rows="2"></textarea></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-ceai" onclick="guardarEdicionProyecto()">üíæ Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="verDocumentoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">üëÅÔ∏è Detalle de Documento</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <p><strong>Nombre:</strong> <span id="vd_nombre"></span></p>
                    <p><strong>Tipo:</strong> <span id="vd_tipo" class="badge bg-info"></span></p>
                    <p><strong>Descripci√≥n:</strong></p><div class="detail-box" id="vd_descripcion"></div>
                    <p class="mt-3"><strong>Archivo:</strong> <a id="vd_archivo" href="#" target="_blank" class="btn btn-sm btn-outline-primary">üì• Descargar PDF</a></p>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editarNoticiaModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">‚úèÔ∏è Editar Noticia</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="formEditarNoticia">
                        <input type="hidden" id="edit_n_id">
                        <div class="row">
                            <div class="col-md-6 mb-3"><label class="form-label">T√≠tulo</label><input type="text" class="form-control" id="edit_n_titulo"></div>
                            <div class="col-md-3 mb-3"><label class="form-label">Fecha</label><input type="date" class="form-control" id="edit_n_fecha"></div>
                            <div class="col-md-3 mb-3"><label class="form-label">Tipo</label><select class="form-control" id="edit_n_tipo"><option value="Noticia">Noticia</option><option value="Evento">Evento</option><option value="Convocatoria">Convocatoria</option><option value="Resultado">Resultado</option></select></div>
                            <div class="col-12 mb-3"><label class="form-label quill-label">Descripci√≥n</label><div class="quill-wrapper"><div id="editorEditNoticia"></div></div><input type="hidden" id="edit_n_descripcion"></div>
                            <div class="col-md-6 mb-3"><label class="form-label">URL Imagen</label><input type="url" class="form-control" id="edit_n_imagen" placeholder="https://..."></div>
                            <div class="col-md-6 mb-3 d-flex align-items-center"><div class="form-check"><input class="form-check-input" type="checkbox" id="edit_n_destacada"><label class="form-check-label" for="edit_n_destacada">‚≠ê Destacar en carousel</label></div></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-ceai" onclick="guardarEdicionNoticia()">üíæ Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editarSemilleroModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">‚úèÔ∏è Editar Semillero</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="formEditarSemillero">
                        <input type="hidden" id="edit_s_id">
                        <div class="row">
                            <div class="col-md-12 mb-3"><label class="form-label">Categor√≠a</label><select class="form-control" id="edit_s_categoria"><option value="Soluciones Digitales">Soluciones Digitales</option><option value="Automatizaci√≥n e Instrumentaci√≥n">Automatizaci√≥n e Instrumentaci√≥n</option><option value="F√°brica Digital Interactiva">F√°brica Digital Interactiva</option><option value="Gesti√≥n Energ√©tica">Gesti√≥n Energ√©tica</option><option value="IA Aplicada al Entorno">IA Aplicada al Entorno</option></select></div>
                            <div class="col-md-6 mb-3"><label class="form-label">Nombre</label><input type="text" class="form-control" id="edit_s_nombre"></div>
                            <div class="col-md-6 mb-3"><label class="form-label">L√≠nea de Investigaci√≥n</label><input type="text" class="form-control" id="edit_s_linea"></div>
                            <div class="col-md-6 mb-3"><label class="form-label">Enfoque</label><input type="text" class="form-control" id="edit_s_enfoque"></div>
                            <div class="col-md-6 mb-3"><label class="form-label">URL Imagen</label><input type="url" class="form-control" id="edit_s_imagen" placeholder="https://..."></div>
                            <div class="col-12 mb-3"><label class="form-label quill-label">Descripci√≥n</label><div class="quill-wrapper"><div id="editorEditSemillero"></div></div><input type="hidden" id="edit_s_descripcion"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-ceai" onclick="guardarEdicionSemillero()">üíæ Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editarDocumentoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">‚úèÔ∏è Editar Documento</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="formEditarDocumento">
                        <input type="hidden" id="edit_d_id">
                        <div class="row">
                            <div class="col-md-6 mb-3"><label class="form-label">Nombre</label><input type="text" class="form-control" id="edit_d_nombre"></div>
                            <div class="col-md-6 mb-3"><label class="form-label">Tipo</label><select class="form-control" id="edit_d_tipo"><option value="Convocatoria">Convocatoria</option><option value="Portafolio">Portafolio de Servicios</option><option value="Informe">Informe</option><option value="Manual">Manual</option><option value="Otro">Otro</option></select></div>
                            <div class="col-12 mb-3"><label class="form-label quill-label">Descripci√≥n</label><div class="quill-wrapper"><div id="editorEditDocumento"></div></div><input type="hidden" id="edit_d_descripcion"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-ceai" onclick="guardarEdicionDocumento()">üíæ Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toastContainer" style="position:fixed;top:20px;right:20px;z-index:9999;"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
    <script>
        const API = 'https://ceai-web-production.up.railway.app';
        let noticiasCache=[], semillerosCache=[], proyectosCache=[], documentosCache=[], contactosCache=[];
        let todosLosSemilleros=[];
        let chartContenidoInst=null, chartContactosInst=null, chartProyEstadoInst=null, chartSemCatInst=null;

        // ===== FECHA TOPBAR =====
        (function() {
            const now = new Date();
            const opts = { weekday:'long', year:'numeric', month:'long', day:'numeric' };
            document.getElementById('dashDate').textContent = now.toLocaleDateString('es-CO', opts);
        })();

        // ===== QUILL =====
        const quillOpts = { theme:'snow', modules:{ toolbar:[[{'font':[]},{'size':['small',false,'large','huge']}],['bold','italic','underline','strike'],[{'color':[]},{'background':[]}],[{'align':[]}],[{'list':'ordered'},{'list':'bullet'}],['link'],['clean']] }, placeholder:'Escribe la descripci√≥n aqu√≠...' };
        const quillNoticia       = new Quill('#editorNoticia',       quillOpts);
        const quillSemillero     = new Quill('#editorSemillero',     quillOpts);
        const quillDocumento     = new Quill('#editorDocumento',     quillOpts);
        const quillEditNoticia   = new Quill('#editorEditNoticia',   quillOpts);
        const quillEditSemillero = new Quill('#editorEditSemillero', quillOpts);
        const quillEditDocumento = new Quill('#editorEditDocumento', quillOpts);
        function getQuillHTML(q) { const h=q.root.innerHTML; return h==='<p><br></p>'?'':h; }

        // ===== TOAST =====
        const toast = {
            show:(msg,type='success')=>{
                const id='t_'+Date.now();
                const bg=type==='success'?'#198754':type==='error'?'#dc3545':'#0dcaf0';
                const el=document.createElement('div');
                el.style.cssText=`background:${bg};color:white;padding:12px 18px;border-radius:10px;margin-bottom:8px;font-weight:600;font-size:.88rem;box-shadow:0 4px 14px rgba(0,0,0,.2);animation:fadeIn .3s ease;max-width:320px;`;
                el.textContent=msg;
                document.getElementById('toastContainer').appendChild(el);
                setTimeout(()=>{el.style.opacity='0';el.style.transition='opacity .4s';setTimeout(()=>el.remove(),400);},3000);
            },
            success:m=>toast.show(m,'success'),
            error:m=>toast.show(m,'error'),
            info:m=>toast.show(m,'info')
        };

        // ===== NAVEGACI√ìN =====
        document.querySelectorAll('.sidebar-link').forEach(link=>{
            link.addEventListener('click',()=>{
                document.querySelectorAll('.sidebar-link').forEach(l=>l.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active'));
                link.classList.add('active');
                const sec=link.dataset.section;
                document.getElementById(sec).classList.add('active');
                if(sec==='noticias') cargarNoticias();
                else if(sec==='semilleros') cargarSemilleros();
                else if(sec==='proyectos') cargarProyectos();
                else if(sec==='documentos') cargarDocumentos();
                else if(sec==='contactos') cargarContactos();
                if(window.innerWidth<=992) cerrarSidebar();
            });
        });

        function irSeccion(sec){
            document.querySelectorAll('.sidebar-link').forEach(l=>l.classList.remove('active'));
            document.querySelector(`[data-section="${sec}"]`).classList.add('active');
            document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active'));
            document.getElementById(sec).classList.add('active');
            if(sec==='noticias') cargarNoticias();
            else if(sec==='semilleros') cargarSemilleros();
            else if(sec==='proyectos') cargarProyectos();
            else if(sec==='documentos') cargarDocumentos();
            else if(sec==='contactos') cargarContactos();
        }

        // ===== SIDEBAR TOGGLE =====
        const sidebarToggle=document.getElementById('sidebarToggle');
        const sidebar=document.getElementById('sidebar');
        const sidebarOverlay=document.getElementById('sidebarOverlay');
        function cerrarSidebar(){sidebar.classList.remove('show');sidebarOverlay.classList.remove('show');}
        sidebarToggle.addEventListener('click',()=>{
            const open=sidebar.classList.toggle('show');
            open?sidebarOverlay.classList.add('show'):sidebarOverlay.classList.remove('show');
        });
        sidebarOverlay.addEventListener('click',cerrarSidebar);

        // ===== DASHBOARD =====
        async function cargarDashboard(){
            document.getElementById('dashSubtitle').textContent='Cargando datos del sistema‚Ä¶';
            try{
                const [rN,rS,rP,rD,rC]=await Promise.all([
                    fetch(`${API}/api/noticias`),fetch(`${API}/api/semilleros`),
                    fetch(`${API}/api/proyectos`),fetch(`${API}/api/documentos`),
                    fetch(`${API}/api/contactos`)
                ]);
                const [n,s,p,d,c]=await Promise.all([rN.json(),rS.json(),rP.json(),rD.json(),rC.json()]);

                document.getElementById('countNoticias').textContent=n.length||0;
                document.getElementById('countSemilleros').textContent=s.length||0;
                document.getElementById('countProyectos').textContent=p.length||0;
                document.getElementById('countContactos').textContent=c.length||0;

                const destacadas=n.filter(x=>x.destacada==1).length;
                document.getElementById('subNoticias').textContent=destacadas>0?`${destacadas} destacadas`:'publicadas';
                const sinLeer=c.filter(x=>!x.leido).length;
                document.getElementById('subContactos').textContent=sinLeer>0?`‚ö†Ô∏è ${sinLeer} sin leer`:'todos le√≠dos';

                const badge=document.getElementById('badgeContactos');
                if(sinLeer>0){badge.textContent=sinLeer;document.getElementById('linkContactos').classList.add('has-badge');}
                else{document.getElementById('linkContactos').classList.remove('has-badge');}

                const alertEl=document.getElementById('alertMensajes');
                if(sinLeer>0){document.getElementById('alertMensajesText').textContent=`Tienes ${sinLeer} mensaje${sinLeer>1?'s':''} sin leer en tu bandeja de contacto.`;alertEl.classList.remove('hidden');}
                else{alertEl.classList.add('hidden');}

                document.getElementById('dashSubtitle').textContent=`${n.length} noticias ¬∑ ${s.length} semilleros ¬∑ ${p.length} proyectos ¬∑ ${c.length} mensajes`;

                const enEjec=p.filter(x=>x.estado==='En ejecuci√≥n').length;
                const finalizados=p.filter(x=>x.estado==='Finalizado').length;
                const totalP=p.length||1; const totalN=n.length||1; const totalC=c.length||1;
                setProgress('pctDestacadas','barDestacadas',destacadas,totalN);
                setProgress('pctEjecucion','barEjecucion',enEjec,totalP);
                setProgress('pctFinalizados','barFinalizados',finalizados,totalP);
                setProgress('pctSinLeer','barSinLeer',sinLeer,totalC);

                const enRevision=p.filter(x=>x.estado==='En revisi√≥n').length;
                if(chartProyEstadoInst){chartProyEstadoInst.destroy();}
                chartProyEstadoInst=new Chart(document.getElementById('chartProyectosEstado'),{type:'bar',data:{labels:['En ejecuci√≥n','Finalizado','En revisi√≥n'],datasets:[{label:'Proyectos',data:[enEjec,finalizados,enRevision],backgroundColor:['rgba(8,145,178,.75)','rgba(57,169,0,.75)','rgba(245,158,11,.75)'],borderColor:['#0891b2','#39a900','#f59e0b'],borderWidth:2,borderRadius:8,borderSkipped:false}]},options:{responsive:true,indexAxis:'y',plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>`${ctx.parsed.x} proyecto${ctx.parsed.x!==1?'s':''}`}}},scales:{x:{beginAtZero:true,ticks:{stepSize:1},grid:{color:'rgba(0,0,0,.05)'}},y:{grid:{display:false}}}}});

                if(chartContenidoInst){chartContenidoInst.destroy();}
                chartContenidoInst=new Chart(document.getElementById('chartContenido'),{type:'doughnut',data:{labels:['Noticias','Semilleros','Proyectos','Documentos'],datasets:[{data:[n.length,s.length,p.length,d.length],backgroundColor:['#39a900','#00304d','#0891b2','#f59e0b'],borderWidth:3,borderColor:'#fff',hoverOffset:6}]},options:{responsive:true,cutout:'62%',plugins:{legend:{position:'bottom',labels:{padding:12,font:{size:11}}}}}});

                const leidos=c.filter(x=>x.leido==1).length;
                if(chartContactosInst){chartContactosInst.destroy();}
                chartContactosInst=new Chart(document.getElementById('chartContactos'),{type:'bar',data:{labels:['Le√≠dos','Sin leer'],datasets:[{data:[leidos,sinLeer],backgroundColor:['rgba(57,169,0,.75)','rgba(220,53,69,.7)'],borderColor:['#39a900','#dc3545'],borderWidth:2,borderRadius:8,borderSkipped:false}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,ticks:{stepSize:1},grid:{color:'rgba(0,0,0,.05)'}},x:{grid:{display:false}}}}});

                const catMap={};
                s.forEach(x=>{ const k=x.categoria||'Sin categor√≠a'; catMap[k]=(catMap[k]||0)+1; });
                const catLabels=Object.keys(catMap); const catVals=Object.values(catMap);
                const catColors=['#39a900','#00304d','#0891b2','#f59e0b','#6366f1'];
                if(chartSemCatInst){chartSemCatInst.destroy();}
                chartSemCatInst=new Chart(document.getElementById('chartSemillerosCat'),{type:'polarArea',data:{labels:catLabels,datasets:[{data:catVals,backgroundColor:catColors.slice(0,catLabels.length).map(c=>c+'bb'),borderColor:catColors.slice(0,catLabels.length),borderWidth:2}]},options:{responsive:true,plugins:{legend:{position:'bottom',labels:{padding:10,font:{size:10}}}}}});

                const actEl=document.getElementById('actividadNoticias');
                const nSlice=n.slice(0,6);
                if(!nSlice.length){ actEl.innerHTML='<p class="text-muted" style="padding:16px 20px;font-size:.85rem;">Sin noticias registradas</p>'; }
                else{ actEl.innerHTML=nSlice.map(x=>{ const tipo=x.tipo||'Noticia'; const dotCls=tipo==='Evento'?'dot-teal':tipo==='Convocatoria'?'dot-orange':tipo==='Resultado'?'dot-blue':'dot-green'; const chipCls=tipo==='Evento'?'chip-blue':tipo==='Convocatoria'?'chip-yellow':tipo==='Resultado'?'chip-blue':'chip-green'; return `<div class="activity-item" style="padding:10px 20px;"><div class="activity-dot ${dotCls}">${tipo==='Evento'?'üìÖ':tipo==='Convocatoria'?'üì¢':tipo==='Resultado'?'üèÜ':'üì∞'}</div><div class="activity-body" style="flex:1;min-width:0;"><div class="a-title">${x.titulo}</div><div class="a-meta">${x.fecha} ¬∑ <span class="chip ${chipCls}">${tipo}</span>${x.destacada==1?' ¬∑ ‚≠ê Destacada':''}</div></div></div>`; }).join(''); }

                const tbody=document.getElementById('bodyContactos');
                const cSlice=c.slice(0,6);
                if(!cSlice.length){ tbody.innerHTML='<tr><td colspan="3" class="text-muted" style="padding:14px;">Sin mensajes</td></tr>'; }
                else{ tbody.innerHTML=cSlice.map(x=>`<tr><td style="font-weight:600;">${x.nombre}</td><td style="max-width:140px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${x.asunto}</td><td><span class="chip ${x.leido?'chip-green':'chip-yellow'}">${x.leido?'Le√≠do':'Nuevo'}</span></td></tr>`).join(''); }

            } catch(err){ console.error('Error dashboard:',err); document.getElementById('dashSubtitle').textContent='Error al cargar datos.'; }
        }

        function setProgress(labelId, barId, val, total){
            const pct=total>0?Math.round((val/total)*100):0;
            document.getElementById(labelId).textContent=val;
            document.getElementById(barId).style.width=pct+'%';
        }

        // ===== NOTICIAS =====
        async function cargarNoticias(){
            const res=await fetch(`${API}/api/noticias`);
            noticiasCache=await res.json();
            const lista=document.getElementById('listaNoticias');
            if(!noticiasCache.length){lista.innerHTML='<p class="text-muted">No hay noticias a√∫n</p>';return;}
            lista.innerHTML=`<table class="table table-hover align-middle"><thead class="table-light"><tr><th>ID</th><th>T√≠tulo</th><th>Fecha</th><th>Tipo</th><th class="text-center col-acciones">Acciones</th></tr></thead><tbody>${noticiasCache.map(n=>`<tr><td>${n.id}</td><td>${n.titulo}</td><td>${n.fecha}</td><td><span class="badge bg-secondary">${n.tipo||'Noticia'}</span></td><td class="col-acciones"><div class="table-actions"><button class="btn btn-sm btn-outline-primary" onclick="editarNoticia(${n.id})">‚úèÔ∏è Editar</button><button class="btn btn-sm btn-danger" onclick="eliminarNoticia(${n.id})">üóëÔ∏è Eliminar</button></div></td></tr>`).join('')}</tbody></table>`;
        }
        document.getElementById('formNoticia').addEventListener('submit',async e=>{
            e.preventDefault();
            const desc=getQuillHTML(quillNoticia);
            if(!desc){toast.error('La descripci√≥n es requerida');return;}
            document.getElementById('noticiaDescripcion').value=desc;
            const body={titulo:document.getElementById('noticiaTitulo').value,descripcion:desc,fecha:document.getElementById('noticiaFecha').value,imagen:document.getElementById('noticiaImagen').value,tipo:document.getElementById('noticiaTipo').value,destacada:document.getElementById('noticiaDestacada').checked};
            const editId=document.getElementById('noticiaEditId').value;
            const res=await fetch(editId?`${API}/api/noticias/${editId}`:`${API}/api/noticias`,{method:editId?'PUT':'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
            if(res.ok){toast.success(editId?'Noticia actualizada':'Noticia creada');cancelarEdicionNoticia();cargarNoticias();cargarDashboard();}
            else{toast.error('Error al guardar');}
        });
        function cancelarEdicionNoticia(){document.getElementById('formNoticia').reset();quillNoticia.setContents([]);document.getElementById('noticiaEditId').value='';document.getElementById('tituloFormNoticia').textContent='‚ûï Nueva Noticia';document.getElementById('btnSubmitNoticia').textContent='‚úÖ Crear Noticia';document.getElementById('btnCancelNoticia').style.display='none';}
        function editarNoticia(id){
            const n=noticiasCache.find(x=>x.id===id);if(!n)return;
            document.getElementById('noticiaEditId').value=n.id;document.getElementById('noticiaTitulo').value=n.titulo;document.getElementById('noticiaFecha').value=n.fecha;document.getElementById('noticiaTipo').value=n.tipo||'Noticia';document.getElementById('noticiaImagen').value=n.imagen||'';document.getElementById('noticiaDestacada').checked=n.destacada==1;
            quillNoticia.root.innerHTML=n.descripcion||'';
            document.getElementById('tituloFormNoticia').textContent='‚úèÔ∏è Editando Noticia';document.getElementById('btnSubmitNoticia').textContent='üíæ Actualizar';document.getElementById('btnCancelNoticia').style.display='block';
            window.scrollTo({top:0,behavior:'smooth'});
        }
        async function eliminarNoticia(id){
            if(!confirm('¬øEliminar esta noticia?'))return;
            const res=await fetch(`${API}/api/noticias/${id}`,{method:'DELETE'});
            if(res.ok){toast.info('Noticia eliminada');cargarNoticias();cargarDashboard();}else{toast.error('Error al eliminar');}
        }
        async function guardarEdicionNoticia(){
            const desc=getQuillHTML(quillEditNoticia);document.getElementById('edit_n_descripcion').value=desc;
            const id=document.getElementById('edit_n_id').value;
            const body={titulo:document.getElementById('edit_n_titulo').value,descripcion:desc,fecha:document.getElementById('edit_n_fecha').value,imagen:document.getElementById('edit_n_imagen').value,tipo:document.getElementById('edit_n_tipo').value,destacada:document.getElementById('edit_n_destacada').checked};
            const res=await fetch(`${API}/api/noticias/${id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
            if(res.ok){toast.success('Noticia actualizada');bootstrap.Modal.getInstance(document.getElementById('editarNoticiaModal')).hide();cargarNoticias();cargarDashboard();}else{toast.error('Error al guardar');}
        }

        // ===== SEMILLEROS =====
        async function cargarSemilleros(){
            const res=await fetch(`${API}/api/semilleros`);
            semillerosCache=await res.json();todosLosSemilleros=semillerosCache;
            const lista=document.getElementById('listaSemilleros');
            if(!semillerosCache.length){lista.innerHTML='<p class="text-muted">No hay semilleros a√∫n</p>';return;}
            lista.innerHTML=`<table class="table table-hover align-middle"><thead class="table-light"><tr><th>ID</th><th>Nombre</th><th>Categor√≠a</th><th>L√≠nea</th><th class="text-center col-acciones">Acciones</th></tr></thead><tbody>${semillerosCache.map(s=>`<tr><td>${s.id}</td><td>${s.nombre}</td><td><span class="badge bg-info" style="font-size:.75rem;">${s.categoria||''}</span></td><td><small>${s.linea}</small></td><td class="col-acciones"><div class="table-actions"><button class="btn btn-sm btn-outline-primary" onclick="editarSemillero(${s.id})">‚úèÔ∏è Editar</button><button class="btn btn-sm btn-danger" onclick="eliminarSemillero(${s.id})">üóëÔ∏è Eliminar</button></div></td></tr>`).join('')}</tbody></table>`;
        }
        document.getElementById('formSemillero').addEventListener('submit',async e=>{
            e.preventDefault();
            const desc=getQuillHTML(quillSemillero);
            if(!desc){toast.error('La descripci√≥n es requerida');return;}
            document.getElementById('semilleroDescripcion').value=desc;
            const body={nombre:document.getElementById('semilleroNombre').value,linea:document.getElementById('semilleroLinea').value,enfoque:document.getElementById('semilleroEnfoque').value,descripcion:desc,imagen:document.getElementById('semilleroImagen').value,categoria:document.getElementById('semilleroCategoria').value};
            const editId=document.getElementById('semilleroEditId').value;
            const res=await fetch(editId?`${API}/api/semilleros/${editId}`:`${API}/api/semilleros`,{method:editId?'PUT':'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
            if(res.ok){toast.success(editId?'Semillero actualizado':'Semillero creado');cancelarEdicionSemillero();cargarSemilleros();cargarDashboard();}else{toast.error('Error al guardar');}
        });
        function cancelarEdicionSemillero(){document.getElementById('formSemillero').reset();quillSemillero.setContents([]);document.getElementById('semilleroEditId').value='';document.getElementById('tituloFormSemillero').textContent='‚ûï Nuevo Semillero';document.getElementById('btnSubmitSemillero').textContent='‚úÖ Crear Semillero';document.getElementById('btnCancelSemillero').style.display='none';}
        function editarSemillero(id){
            const s=semillerosCache.find(x=>x.id===id);if(!s)return;
            document.getElementById('semilleroEditId').value=s.id;document.getElementById('semilleroNombre').value=s.nombre;document.getElementById('semilleroLinea').value=s.linea;document.getElementById('semilleroEnfoque').value=s.enfoque;document.getElementById('semilleroImagen').value=s.imagen||'';document.getElementById('semilleroCategoria').value=s.categoria||'Soluciones Digitales';
            quillSemillero.root.innerHTML=s.descripcion||'';
            document.getElementById('tituloFormSemillero').textContent='‚úèÔ∏è Editando Semillero';document.getElementById('btnSubmitSemillero').textContent='üíæ Actualizar';document.getElementById('btnCancelSemillero').style.display='block';
            window.scrollTo({top:0,behavior:'smooth'});
        }
        async function eliminarSemillero(id){
            if(!confirm('¬øEliminar este semillero? Tambi√©n se eliminar√°n sus proyectos asociados.'))return;
            const res=await fetch(`${API}/api/semilleros/${id}`,{method:'DELETE'});
            if(res.ok){toast.info('Semillero eliminado');cargarSemilleros();cargarDashboard();}else{toast.error('Error al eliminar');}
        }
        async function guardarEdicionSemillero(){
            const desc=getQuillHTML(quillEditSemillero);document.getElementById('edit_s_descripcion').value=desc;
            const id=document.getElementById('edit_s_id').value;
            const body={nombre:document.getElementById('edit_s_nombre').value,linea:document.getElementById('edit_s_linea').value,enfoque:document.getElementById('edit_s_enfoque').value,descripcion:desc,imagen:document.getElementById('edit_s_imagen').value,categoria:document.getElementById('edit_s_categoria').value};
            const res=await fetch(`${API}/api/semilleros/${id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
            if(res.ok){toast.success('Semillero actualizado');bootstrap.Modal.getInstance(document.getElementById('editarSemilleroModal')).hide();cargarSemilleros();cargarDashboard();}else{toast.error('Error al guardar');}
        }

        // ===== PROYECTOS =====
        async function cargarProyectos(){
            const res=await fetch(`${API}/api/proyectos`);
            proyectosCache=await res.json();
            if(!todosLosSemilleros.length){const resSem=await fetch(`${API}/api/semilleros`);todosLosSemilleros=await resSem.json();}
            const editSelect=document.getElementById('edit_p_semillero');
            editSelect.innerHTML=todosLosSemilleros.map(s=>`<option value="${s.id}">${s.nombre} (${s.categoria})</option>`).join('');
            const lista=document.getElementById('listaProyectos');
            if(!proyectosCache.length){lista.innerHTML='<p class="text-muted">No hay proyectos a√∫n</p>';return;}
            lista.innerHTML=`<table class="table table-hover align-middle"><thead class="table-light"><tr><th>ID</th><th>T√≠tulo</th><th>Semillero</th><th>Estado</th><th class="text-center col-acciones">Acciones</th></tr></thead><tbody>${proyectosCache.map(p=>{const sem=todosLosSemilleros.find(s=>s.id===p.semillero_id);const bc=p.estado==='En ejecuci√≥n'?'bg-primary':p.estado==='Finalizado'?'bg-success':'bg-warning text-dark';return `<tr><td>${p.id}</td><td>${p.titulo}</td><td><small>${sem?sem.nombre:'ID: '+p.semillero_id}</small></td><td><span class="badge ${bc}">${p.estado}</span></td><td class="col-acciones"><div class="table-actions"><button class="btn btn-sm btn-outline-primary" onclick="verProyecto(${p.id})">üëÅÔ∏è Ver</button><button class="btn btn-sm btn-warning" onclick="editarProyecto(${p.id})">‚úèÔ∏è Editar</button><button class="btn btn-sm btn-danger" onclick="eliminarProyecto(${p.id})">üóëÔ∏è Eliminar</button></div></td></tr>`;}).join('')}</tbody></table>`;
        }
        document.getElementById('formProyecto').addEventListener('submit',async e=>{
            e.preventDefault();
            const body={semillero_id:document.getElementById('proyectoSemillero').value,titulo:document.getElementById('proyectoTitulo').value,estado:document.getElementById('proyectoEstado').value,aliados:document.getElementById('proyectoAliados').value,objetivo:document.getElementById('proyectoObjetivo').value,entregables:document.getElementById('proyectoEntregables').value,evidencia:document.getElementById('proyectoEvidencia').value};
            const editId=document.getElementById('proyectoEditId').value;
            const res=await fetch(editId?`${API}/api/proyectos/${editId}`:`${API}/api/proyectos`,{method:editId?'PUT':'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
            if(res.ok){toast.success(editId?'Proyecto actualizado':'Proyecto creado');cancelarEdicionProyecto();cargarProyectos();cargarDashboard();}else{toast.error('Error al guardar');}
        });
        document.getElementById('proyectoCategoria').addEventListener('change',async function(){
            const cat=this.value;const sel=document.getElementById('proyectoSemillero');
            if(!cat){sel.innerHTML='<option value="">-- Selecciona categor√≠a primero --</option>';sel.disabled=true;return;}
            const res=await fetch(`${API}/api/semilleros/categoria/${encodeURIComponent(cat)}`);
            const sems=await res.json();
            sel.innerHTML=sems.length?sems.map(s=>`<option value="${s.id}">${s.nombre}</option>`).join(''):'<option value="">Sin semilleros en esta categor√≠a</option>';
            sel.disabled=false;
        });
        function cancelarEdicionProyecto(){document.getElementById('formProyecto').reset();document.getElementById('proyectoEditId').value='';document.getElementById('tituloFormProyecto').textContent='‚ûï Nuevo Proyecto';document.getElementById('btnSubmitProyecto').textContent='‚úÖ Crear Proyecto';document.getElementById('btnCancelProyecto').style.display='none';document.getElementById('proyectoSemillero').disabled=true;}
        function verProyecto(id){
            const p=proyectosCache.find(x=>x.id===id);if(!p)return;
            const sem=todosLosSemilleros.find(s=>s.id===p.semillero_id);
            document.getElementById('vp_titulo').textContent=p.titulo;document.getElementById('vp_semillero').textContent=sem?`${sem.nombre} (ID: ${p.semillero_id})`:`ID: ${p.semillero_id}`;
            const badge=document.getElementById('vp_estado');badge.textContent=p.estado;badge.className='badge '+(p.estado==='En ejecuci√≥n'?'bg-primary':p.estado==='Finalizado'?'bg-success':'bg-warning text-dark');
            document.getElementById('vp_aliados').textContent=p.aliados||'‚Äî';document.getElementById('vp_objetivo').textContent=p.objetivo||'‚Äî';document.getElementById('vp_entregables').textContent=p.entregables||'‚Äî';document.getElementById('vp_evidencia').textContent=p.evidencia||'‚Äî';
            new bootstrap.Modal(document.getElementById('verProyectoModal')).show();
        }
        function editarProyecto(id){
            const p=proyectosCache.find(x=>x.id===id);if(!p)return;
            document.getElementById('edit_p_id').value=p.id;document.getElementById('edit_p_semillero').value=p.semillero_id;document.getElementById('edit_p_titulo').value=p.titulo;document.getElementById('edit_p_estado').value=p.estado;document.getElementById('edit_p_aliados').value=p.aliados||'';document.getElementById('edit_p_objetivo').value=p.objetivo||'';document.getElementById('edit_p_entregables').value=p.entregables||'';document.getElementById('edit_p_evidencia').value=p.evidencia||'';
            new bootstrap.Modal(document.getElementById('editarProyectoModal')).show();
        }
        async function guardarEdicionProyecto(){
            const id=document.getElementById('edit_p_id').value;
            const body={semillero_id:document.getElementById('edit_p_semillero').value,titulo:document.getElementById('edit_p_titulo').value,estado:document.getElementById('edit_p_estado').value,aliados:document.getElementById('edit_p_aliados').value,objetivo:document.getElementById('edit_p_objetivo').value,entregables:document.getElementById('edit_p_entregables').value,evidencia:document.getElementById('edit_p_evidencia').value};
            const res=await fetch(`${API}/api/proyectos/${id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
            if(res.ok){toast.success('Proyecto actualizado');bootstrap.Modal.getInstance(document.getElementById('editarProyectoModal')).hide();cargarProyectos();cargarDashboard();}else{toast.error('Error al guardar');}
        }
        async function eliminarProyecto(id){
            if(!confirm('¬øEliminar este proyecto?'))return;
            const res=await fetch(`${API}/api/proyectos/${id}`,{method:'DELETE'});
            if(res.ok){toast.info('Proyecto eliminado');cargarProyectos();cargarDashboard();}else{toast.error('Error al eliminar');}
        }

        // ===== DOCUMENTOS =====
        async function cargarDocumentos(){
            const res=await fetch(`${API}/api/documentos`);
            documentosCache=await res.json();
            const lista=document.getElementById('listaDocumentos');
            if(!documentosCache.length){lista.innerHTML='<p class="text-muted">No hay documentos a√∫n</p>';return;}
            lista.innerHTML=`<table class="table table-hover align-middle"><thead class="table-light"><tr><th>ID</th><th>Nombre</th><th>Tipo</th><th>Fecha</th><th class="text-center col-acciones">Acciones</th></tr></thead><tbody>${documentosCache.map(d=>`<tr><td>${d.id}</td><td>${d.nombre}</td><td><span class="badge bg-info" style="font-size:.75rem;">${d.tipo}</span></td><td><small>${new Date(d.created_at).toLocaleDateString('es-CO')}</small></td><td class="col-acciones"><div class="table-actions"><button class="btn btn-sm btn-outline-primary" onclick="verDocumento(${d.id})">üëÅÔ∏è Ver</button><button class="btn btn-sm btn-warning" onclick="editarDocumento(${d.id})">‚úèÔ∏è Editar</button><button class="btn btn-sm btn-danger" onclick="eliminarDocumento(${d.id})">üóëÔ∏è Eliminar</button></div></td></tr>`).join('')}</tbody></table>`;
        }
        document.getElementById('formDocumento').addEventListener('submit',async e=>{
            e.preventDefault();
            const desc=getQuillHTML(quillDocumento);document.getElementById('docDescripcion').value=desc;
            const formData=new FormData();
            formData.append('nombre',document.getElementById('docNombre').value);formData.append('tipo',document.getElementById('docTipo').value);formData.append('descripcion',desc);formData.append('archivo',document.getElementById('docArchivo').files[0]);
            const res=await fetch(`${API}/api/documentos`,{method:'POST',body:formData});
            if(res.ok){toast.success('Documento subido');document.getElementById('formDocumento').reset();quillDocumento.setContents([]);document.getElementById('dropText').style.display='block';document.getElementById('fileSelected').style.display='none';cargarDocumentos();cargarDashboard();}
            else{const err=await res.json();toast.error(err.error||'Error al subir');}
        });
        const dropZone=document.getElementById('dropZone');const docArchivoInput=document.getElementById('docArchivo');
        dropZone.addEventListener('click',()=>docArchivoInput.click());
        dropZone.addEventListener('dragover',e=>{e.preventDefault();dropZone.style.background='rgba(57,169,0,.08)';});
        dropZone.addEventListener('dragleave',()=>{dropZone.style.background='';});
        dropZone.addEventListener('drop',e=>{e.preventDefault();dropZone.style.background='';const file=e.dataTransfer.files[0];if(file&&file.type==='application/pdf'){const dt=new DataTransfer();dt.items.add(file);docArchivoInput.files=dt.files;mostrarArchivoSeleccionado(file.name);}else{toast.error('Solo se permiten archivos PDF');}});
        docArchivoInput.addEventListener('change',()=>{if(docArchivoInput.files[0])mostrarArchivoSeleccionado(docArchivoInput.files[0].name);});
        function mostrarArchivoSeleccionado(nombre){document.getElementById('dropText').style.display='none';document.getElementById('fileSelected').style.display='block';document.getElementById('fileName').textContent=nombre;}
        function verDocumento(id){
            const d=documentosCache.find(x=>x.id===id);if(!d)return;
            document.getElementById('vd_nombre').textContent=d.nombre;document.getElementById('vd_tipo').textContent=d.tipo;
            document.getElementById('vd_descripcion').innerHTML=d.descripcion||'‚Äî';
            document.getElementById('vd_archivo').href=`https://ceai-web-production.up.railway.app${d.ruta_archivo}`;
            new bootstrap.Modal(document.getElementById('verDocumentoModal')).show();
        }
        function editarDocumento(id){
            const d=documentosCache.find(x=>x.id===id);if(!d)return;
            document.getElementById('edit_d_id').value=d.id;document.getElementById('edit_d_nombre').value=d.nombre;document.getElementById('edit_d_tipo').value=d.tipo;
            quillEditDocumento.root.innerHTML=d.descripcion||'';
            new bootstrap.Modal(document.getElementById('editarDocumentoModal')).show();
        }
        async function guardarEdicionDocumento(){
            const desc=getQuillHTML(quillEditDocumento);document.getElementById('edit_d_descripcion').value=desc;
            const id=document.getElementById('edit_d_id').value;
            const body={nombre:document.getElementById('edit_d_nombre').value,tipo:document.getElementById('edit_d_tipo').value,descripcion:desc};
            const res=await fetch(`${API}/api/documentos/${id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
            if(res.ok){toast.success('Documento actualizado');bootstrap.Modal.getInstance(document.getElementById('editarDocumentoModal')).hide();cargarDocumentos();}else{toast.error('Error al guardar');}
        }
        async function eliminarDocumento(id){
            if(!confirm('¬øEliminar este documento?'))return;
            const res=await fetch(`${API}/api/documentos/${id}`,{method:'DELETE'});
            if(res.ok){toast.info('Documento eliminado');cargarDocumentos();cargarDashboard();}else{toast.error('Error al eliminar');}
        }

        // ===== CONTACTOS =====
        async function cargarContactos(){
            const res=await fetch(`${API}/api/contactos`);
            contactosCache=await res.json();
            const lista=document.getElementById('listaContactos');
            if(!contactosCache.length){lista.innerHTML='<p class="text-muted">No hay mensajes a√∫n</p>';return;}
            lista.innerHTML=`<table class="table table-hover align-middle"><thead class="table-light"><tr><th>ID</th><th>Nombre</th><th>Email</th><th>Asunto</th><th>Mensaje</th><th>Estado</th><th class="text-center col-acciones">Acciones</th></tr></thead><tbody>${contactosCache.map(c=>`<tr><td>${c.id}</td><td>${c.nombre}</td><td><small>${c.email}</small></td><td>${c.asunto}</td><td><small>${(c.mensaje||'').substring(0,50)}...</small></td><td><span class="badge ${c.leido?'bg-success':'bg-warning text-dark'}">${c.leido?'Le√≠do':'Nuevo'}</span></td><td class="col-acciones"><div class="table-actions"><button class="btn btn-sm btn-outline-success" onclick="marcarLeido(${c.id},${c.leido?0:1})">${c.leido?'No le√≠do':'‚úî Le√≠do'}</button><button class="btn btn-sm btn-danger" onclick="eliminarContacto(${c.id})">üóëÔ∏è</button></div></td></tr>`).join('')}</tbody></table>`;
        }
        async function marcarLeido(id,leido){
            const res=await fetch(`${API}/api/contactos/${id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({leido})});
            if(res.ok){cargarContactos();cargarDashboard();}
        }
        async function eliminarContacto(id){
            if(!confirm('¬øEliminar este mensaje?'))return;
            const res=await fetch(`${API}/api/contactos/${id}`,{method:'DELETE'});
            if(res.ok){toast.info('Mensaje eliminado');cargarContactos();cargarDashboard();}
        }

        // ===== INIT =====
        document.addEventListener('DOMContentLoaded',cargarDashboard);
    </script>
</body>
</html>
