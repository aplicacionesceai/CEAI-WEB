<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo - CEAI SENA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <!-- Quill Editor CSS -->
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ===== BASE ADMIN ===== */
        * { box-sizing: border-box; }
        html, body { height: 100%; margin: 0; padding: 0; }
        body {
            background: linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%);
            font-family:'Roboto',sans-serif;
            overflow-x:hidden;
            min-height: 100vh;
        }

        /* ===== OVERRIDE GLOBAL: botones en admin NO full-width ===== */
        .admin-btn,
        .table .btn,
        .table .btn-sm,
        .modal .btn,
        .modal .btn-sm,
        .form-section .btn,
        .quick-actions .btn,
        .sidebar-footer .btn {
            width: auto !important;
        }

        /* ===== BOTONES DE ACCI√ìN EN TABLAS ===== */
        .table-actions {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            flex-wrap: nowrap;
            white-space: nowrap;
        }
        .table-actions .btn {
            width: auto !important;
            padding: 4px 10px !important;
            font-size: 0.78rem !important;
            font-weight: 600 !important;
            border-radius: 6px !important;
            display: inline-flex;
            align-items: center;
            gap: 3px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            background: linear-gradient(180deg,var(--ceai-azul) 0%,var(--ceai-azul-dark) 100%);
            color: white;
            height: 100vh;
            padding: 25px 20px;
            position: fixed;
            top: 0;
            left: 0;
            width: 240px;
            box-shadow: 4px 0 20px rgba(0,0,0,.15);
            z-index: 1000;
            transition: transform .3s ease;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .sidebar-header {
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(57,169,0,.3);
            margin-bottom: 25px;
            flex-shrink: 0;
        }
        .sidebar-header h4 { color:white; font-weight:800; font-size:1.5rem; margin:0; letter-spacing:-.5px; }
        .sidebar-header span { color:var(--ceai-verde); text-shadow:0 0 15px rgba(57,169,0,.6); animation:pulseGlow 2s ease infinite; }
        @keyframes pulseGlow { 0%,100%{text-shadow:0 0 15px rgba(57,169,0,.6)} 50%{text-shadow:0 0 25px rgba(57,169,0,.9)} }
        .sidebar h5 { color:var(--ceai-verde); font-size:.8rem; text-transform:uppercase; letter-spacing:1.5px; margin-bottom:12px; margin-top:16px; font-weight:700; flex-shrink:0; }
        .sidebar-link {
            color: rgba(255,255,255,.75);
            margin-bottom: 6px;
            cursor: pointer;
            border-radius: 10px;
            padding: 12px 16px;
            transition: all .3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            font-weight: 500;
            font-size: .9rem;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        .sidebar-link::before { content:''; position:absolute; left:0; top:0; bottom:0; width:4px; background:var(--ceai-verde); transform:scaleY(0); transition:transform .3s ease; }
        .sidebar-link:hover,.sidebar-link.active { background:linear-gradient(90deg,var(--ceai-verde) 0%,var(--ceai-verde-light) 100%); color:white; transform:translateX(5px); box-shadow:0 4px 20px rgba(57,169,0,.45); }
        .sidebar-link:hover::before,.sidebar-link.active::before { transform:scaleY(1); }
        .sidebar-nav { flex: 1; display: flex; flex-direction: column; }
        .sidebar-footer {
            margin-top: auto;
            padding-top: 18px;
            border-top: 1px solid rgba(255,255,255,.1);
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-shrink: 0;
        }
        .sidebar-footer .btn { width: 100% !important; font-size: .85rem; padding: 8px 12px; }

        /* ===== LAYOUT PRINCIPAL ===== */
        .admin-wrapper { display: flex; min-height: 100vh; width: 100%; }
        .content-wrapper {
            margin-left: 240px;
            width: calc(100% - 240px);
            min-height: 100vh;
            padding: 30px 32px;
            transition: margin-left .3s ease, width .3s ease;
            display: flex;
            flex-direction: column;
        }
        .content-section { display:none; animation:fadeInContent .45s ease; flex: 1; }
        .content-section.active { display:flex; flex-direction:column; }
        @keyframes fadeInContent { from{opacity:0;transform:translateY(24px)} to{opacity:1;transform:translateY(0)} }

        /* ===== SECTION HEADER ===== */
        .section-header {
            background: linear-gradient(135deg,white 0%,#f8f9fa 100%);
            border-radius: 16px;
            padding: 24px 30px;
            margin-bottom: 28px;
            box-shadow: 0 4px 20px rgba(0,0,0,.08);
            border-left: 6px solid var(--ceai-verde);
            flex-shrink: 0;
        }
        .section-header h2 { color:var(--ceai-azul); font-weight:800; margin:0; font-size:1.75rem; }
        .section-header p { margin:6px 0 0 0; color:#6c757d; font-size:.95rem; }

        /* ===== STAT CARDS ===== */
        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px; }
        .stat-card {
            background: linear-gradient(135deg,var(--ceai-verde) 0%,var(--ceai-verde-light) 100%);
            color: white;
            border-radius: 16px;
            padding: 24px 20px;
            text-align: center;
            transition: all .4s ease;
            border: none;
            box-shadow: 0 6px 20px rgba(57,169,0,.3);
            position: relative;
            overflow: hidden;
        }
        .stat-card::after { content:''; position:absolute; top:-50%; right:-50%; width:200%; height:200%; background:radial-gradient(circle,rgba(255,255,255,.1) 0%,transparent 70%); pointer-events:none; }
        .stat-card:hover { transform:translateY(-8px) scale(1.02); box-shadow:0 14px 36px rgba(57,169,0,.45); }
        .stat-card.variant-azul { background:linear-gradient(135deg,var(--ceai-azul) 0%,var(--ceai-azul-light) 100%); box-shadow:0 6px 20px rgba(0,48,77,.3); }
        .stat-card.variant-azul:hover { box-shadow:0 14px 36px rgba(0,48,77,.45); }
        .stat-card h5 { color:rgba(255,255,255,.92); font-size:.88rem; margin-bottom:10px; font-weight:600; text-transform:uppercase; letter-spacing:1px; }
        .stat-card h3 { color:white; font-size:2.6rem; font-weight:900; margin:0; text-shadow:0 3px 12px rgba(0,0,0,.2); }

        /* ===== MODERN CARDS ===== */
        .modern-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,.08);
            border: 1px solid rgba(0,0,0,.04);
            transition: all .3s ease;
            position: relative;
            overflow: hidden;
            height: 100%;
        }
        .modern-card::before { content:''; position:absolute; top:0; left:0; right:0; height:4px; background:linear-gradient(90deg,var(--ceai-verde),var(--ceai-verde-light)); }
        .modern-card:hover { transform:translateY(-4px); box-shadow:0 10px 30px rgba(0,0,0,.12); }
        .modern-card h5 { color:var(--ceai-azul); font-weight:700; margin-bottom:16px; font-size:1.05rem; }

        /* ===== QUICK ACTIONS ===== */
        .quick-actions {
            background: linear-gradient(135deg,var(--ceai-azul) 0%,var(--ceai-azul-light) 100%);
            color: white;
            border-radius: 16px;
            padding: 22px 26px;
            margin-bottom: 24px;
            box-shadow: 0 6px 22px rgba(0,48,77,.3);
            flex-shrink: 0;
        }
        .quick-actions h5 { color:var(--ceai-verde); margin-bottom:14px; font-weight:700; text-transform:uppercase; letter-spacing:1px; font-size:.9rem; }
        .quick-actions .btn { width:auto !important; }
        .quick-actions .d-flex { flex-wrap: wrap; gap: 10px; }

        /* ===== FORM SECTION ===== */
        .form-section {
            background: white;
            padding: 28px 32px;
            border-radius: 16px;
            margin-bottom: 28px;
            box-shadow: 0 4px 20px rgba(0,0,0,.08);
            border-top: 5px solid var(--ceai-verde);
            flex-shrink: 0;
        }
        .form-section h5 { color:var(--ceai-azul); font-weight:700; margin-bottom:22px; font-size:1.2rem; }

        /* ===== TABLE SECTION ===== */
        .table-section {
            background: white;
            border-radius: 16px;
            padding: 24px 28px;
            box-shadow: 0 4px 20px rgba(0,0,0,.08);
            overflow-x: auto;
            flex: 1;
        }
        .table-section h5 { color:var(--ceai-azul); font-weight:700; margin-bottom:18px; font-size:1.1rem; }
        .table { width: 100%; table-layout: auto; }
        .table thead th {
            border-top: none;
            border-bottom: 3px solid var(--ceai-verde);
            color: var(--ceai-azul);
            font-weight: 700;
            text-transform: uppercase;
            font-size: .8rem;
            letter-spacing: .7px;
            padding: 12px 14px;
            vertical-align: middle;
            white-space: nowrap;
        }
        .table tbody tr { transition:background .2s ease; }
        .table tbody tr:hover { background-color:rgba(57,169,0,.05); }
        .table td { vertical-align:middle; padding: 10px 14px; font-size: .9rem; }
        .table th.col-acciones,
        .table td.col-acciones { width:1%; white-space:nowrap; text-align:center; }

        /* ===== CHARTS ROW ===== */
        .charts-row { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px; }
        .recent-row  { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 8px; }

        /* ===== MODAL ===== */
        .modal-content { border-radius:16px; border:none; box-shadow:0 15px 60px rgba(0,0,0,.22); }
        .modal-header { background:linear-gradient(90deg,var(--ceai-verde) 0%,var(--ceai-verde-light) 100%); color:white; border-radius:16px 16px 0 0; border:none; padding:18px 26px; }
        .modal-header .modal-title { color:white; font-weight:700; }
        .modal-header .btn-close { filter:brightness(0) invert(1); }
        .modal-footer .btn { width:auto !important; }

        /* ===== QUILL EDITOR STYLES ===== */
        .quill-wrapper {
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #ced4da;
        }
        .quill-wrapper .ql-toolbar {
            border: none;
            border-bottom: 1px solid #ced4da;
            background: #f8f9fa;
            padding: 8px 10px;
        }
        .quill-wrapper .ql-container {
            border: none;
            font-family: 'Roboto', sans-serif;
            font-size: 14px;
        }
        .quill-wrapper .ql-editor {
            min-height: 160px;
            max-height: 320px;
            overflow-y: auto;
        }
        .quill-wrapper .ql-editor:focus { outline: none; }
        .quill-wrapper:focus-within {
            border-color: var(--ceai-verde, #39a900);
            box-shadow: 0 0 0 3px rgba(57,169,0,0.15);
        }
        .form-label.quill-label {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 6px;
            color: #333;
        }

        /* ===== MISC ===== */
        .sidebar-toggle { display:none; position:fixed; top:18px; left:16px; z-index:1100; background:var(--ceai-verde); color:white; border:none; padding:11px 14px; border-radius:10px; font-size:1.2rem; box-shadow:0 4px 16px rgba(57,169,0,.4); cursor:pointer; transition:all .3s ease; }
        .sidebar-toggle:hover { background:var(--ceai-verde-oscuro); transform:scale(1.1); }
        .sidebar-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.55); z-index:999; opacity:0; transition:opacity .3s ease; backdrop-filter:blur(3px); }
        .sidebar-overlay.show { display:block; opacity:1; }
        .sidebar::-webkit-scrollbar { width:6px; }
        .sidebar::-webkit-scrollbar-track { background:rgba(0,0,0,.1); }
        .sidebar::-webkit-scrollbar-thumb { background:var(--ceai-verde); border-radius:8px; }
        .detail-box { white-space:pre-wrap; word-wrap:break-word; background:#f8f9fa; padding:14px; border-radius:10px; border:1px solid #e0e0e0; max-height:200px; overflow-y:auto; font-size:.9rem; }

        /* ===== CONTACTOS: tabla con columnas bien definidas ===== */
        #listaContactos .table { min-width: 700px; }
        #listaContactos td:nth-child(5) { max-width: 160px; }
        #listaContactos td:nth-child(5) small { display:block; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:160px; }

        /* ========== RESPONSIVE ========== */
        @media (max-width:1280px) { .sidebar { width: 220px; } .content-wrapper { margin-left: 220px; width: calc(100% - 220px); padding: 26px 26px; } }
        @media (max-width:1100px) { .stats-row { grid-template-columns: repeat(2, 1fr); } .charts-row { grid-template-columns: 1fr; } .recent-row { grid-template-columns: 1fr; } }
        @media (max-width:992px) {
            .sidebar { transform: translateX(-100%); width: 260px; }
            .sidebar.show { transform: translateX(0); }
            .content-wrapper { margin-left: 0; width: 100%; padding: 80px 20px 24px; }
            .sidebar-toggle { display: block; }
            .section-header h2 { font-size: 1.45rem; }
            .stat-card h3 { font-size: 2.2rem; }
            .stats-row { grid-template-columns: repeat(2, 1fr); gap: 16px; }
            .form-section { padding: 22px 22px; }
            .table-section { padding: 18px 18px; }
        }
        @media (max-width:768px) {
            .content-wrapper { padding: 76px 14px 20px; }
            .stats-row { grid-template-columns: repeat(2, 1fr); gap: 14px; margin-bottom: 18px; }
            .stat-card { padding: 18px 14px; }
            .stat-card h3 { font-size: 2rem; }
            .stat-card h5 { font-size: .78rem; }
            .charts-row, .recent-row { grid-template-columns: 1fr; gap: 16px; }
            .quick-actions { padding: 18px 18px; }
            .quick-actions .d-flex { gap: 8px; }
            .section-header { padding: 18px 20px; margin-bottom: 20px; }
            .section-header h2 { font-size: 1.25rem; }
            .form-section { padding: 18px 16px; }
            .form-section h5 { font-size: 1.05rem; }
            .table-section { padding: 14px 14px; }
            .table thead th { font-size: .75rem; padding: 10px 10px; }
            .table td { font-size: .85rem; padding: 9px 10px; }
            .table-actions .btn { padding: 3px 8px !important; font-size: 0.73rem !important; gap: 2px; }
        }
        @media (max-width:576px) {
            .content-wrapper { padding: 72px 10px 16px; }
            .stats-row { grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 14px; }
            .stat-card { padding: 16px 10px; border-radius: 12px; }
            .stat-card h3 { font-size: 1.8rem; }
            .stat-card h5 { font-size: .72rem; margin-bottom: 6px; }
            .section-header { padding: 14px 16px; border-radius: 12px; margin-bottom: 16px; }
            .section-header h2 { font-size: 1.1rem; }
            .modern-card { padding: 16px; border-radius: 12px; }
            .quick-actions { padding: 14px 14px; border-radius: 12px; }
            .quick-actions .btn { width: 100% !important; margin: 0 !important; }
            .form-section { padding: 14px 12px; border-radius: 12px; }
            .form-section .btn-submit-full { width: 100% !important; }
            .table-section { padding: 12px 10px; border-radius: 12px; }
            .table-actions .btn { padding: 3px 6px !important; font-size: 0.7rem !important; }
            .modal-dialog { margin: 8px; }
            .modal-body { padding: 14px; }
            .sidebar-footer .btn { font-size: .8rem; padding: 7px 10px; }
        }
        @media (max-width:400px) {
            .stats-row { grid-template-columns: 1fr 1fr; gap: 8px; }
            .stat-card h3 { font-size: 1.6rem; }
            .content-wrapper { padding: 68px 8px 12px; }
        }
    </style>
</head>
<body>
    <script>
        if (localStorage.getItem('ceai_admin_logged') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <button class="sidebar-toggle" id="sidebarToggle">‚ò∞</button>

    <div class="admin-wrapper">
        <!-- SIDEBAR -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h4 class="fw-bold"><span>CEAI</span> Admin</h4>
            </div>
            <div class="sidebar-nav">
                <h5>üìã Men√∫ Principal</h5>
                <div class="sidebar-link active" data-section="dashboard"><span>üìä</span> Dashboard</div>
                <div class="sidebar-link" data-section="noticias"><span>üì∞</span> Noticias</div>
                <div class="sidebar-link" data-section="semilleros"><span>üå±</span> Semilleros</div>
                <div class="sidebar-link" data-section="proyectos"><span>üî¨</span> Proyectos</div>
                <div class="sidebar-link" data-section="documentos"><span>üìÑ</span> Documentos</div>
                <div class="sidebar-link" data-section="contactos"><span>üì®</span> Contactos</div>
            </div>
            <div class="sidebar-footer">
                <button class="btn btn-outline-light btn-sm"
                    onclick="localStorage.removeItem('ceai_admin_logged'); window.location.href='login.html';">
                    üö™ Cerrar sesi√≥n
                </button>
                <a href="index.html" class="btn btn-outline-light btn-sm">‚Üê Volver al sitio</a>
            </div>
        </div>

        <!-- CONTENIDO PRINCIPAL -->
        <div class="content-wrapper" id="contentWrapper">

            <!-- DASHBOARD -->
            <div id="dashboard" class="content-section active">
                <div class="section-header">
                    <h2>üìä Panel de Control</h2>
                    <p class="mb-0">Vista general del sistema CEAI</p>
                </div>
                <div class="stats-row">
                    <div class="stat-card"><h5>üì∞ Noticias</h5><h3 id="countNoticias">0</h3></div>
                    <div class="stat-card variant-azul"><h5>üå± Semilleros</h5><h3 id="countSemilleros">0</h3></div>
                    <div class="stat-card"><h5>üî¨ Proyectos</h5><h3 id="countProyectos">0</h3></div>
                    <div class="stat-card variant-azul"><h5>üìÑ Documentos</h5><h3 id="countDocumentos">0</h3></div>
                </div>
                <div class="quick-actions">
                    <h5>‚ö° Acciones R√°pidas</h5>
                    <div class="d-flex flex-wrap gap-2">
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('noticias')">+ Nueva noticia</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('semilleros')">+ Nuevo semillero</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('proyectos')">+ Nuevo proyecto</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('documentos')">+ Subir documento</button>
                        <button class="btn btn-ceai btn-sm" onclick="irSeccion('contactos')">üì® Ver contactos</button>
                    </div>
                </div>
                <div class="charts-row">
                    <div class="modern-card"><h5 class="mb-3">Distribuci√≥n de Contenido</h5><canvas id="chartContenido"></canvas></div>
                    <div class="modern-card"><h5 class="mb-3">Mensajes de Contacto</h5><canvas id="chartContactos"></canvas></div>
                </div>
                <div class="recent-row">
                    <div class="modern-card"><h5 class="mb-3">√öltimas Noticias</h5><ul id="ultimasNoticias" class="list-group list-group-flush"></ul></div>
                    <div class="modern-card"><h5 class="mb-3">√öltimos Contactos</h5><ul id="ultimosContactos" class="list-group list-group-flush"></ul></div>
                </div>
            </div>

            <!-- NOTICIAS -->
            <div id="noticias" class="content-section">
                <div class="section-header">
                    <h2>üì∞ Gestionar Noticias</h2>
                    <p class="mb-0">Crear, editar y eliminar noticias</p>
                </div>
                <div class="form-section">
                    <h5 id="tituloFormNoticia">‚ûï Nueva Noticia</h5>
                    <form id="formNoticia">
                        <input type="hidden" id="noticiaEditId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">T√≠tulo <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="noticiaTitulo" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Fecha <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="noticiaFecha" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Tipo</label>
                                <select class="form-control" id="noticiaTipo">
                                    <option value="Noticia">Noticia</option>
                                    <option value="Evento">Evento</option>
                                    <option value="Convocatoria">Convocatoria</option>
                                    <option value="Resultado">Resultado</option>
                                </select>
                            </div>
                            <!-- EDITOR QUILL PARA DESCRIPCI√ìN NOTICIA -->
                            <div class="col-12 mb-3">
                                <label class="form-label quill-label">Descripci√≥n <span class="text-danger">*</span></label>
                                <div class="quill-wrapper">
                                    <div id="editorNoticia"></div>
                                </div>
                                <input type="hidden" id="noticiaDescripcion">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">URL Imagen</label>
                                <input type="url" class="form-control" id="noticiaImagen" placeholder="https://...">
                            </div>
                            <div class="col-md-6 mb-3 d-flex align-items-end">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="noticiaDestacada">
                                    <label class="form-check-label" for="noticiaDestacada">‚≠ê Destacar en carousel del home</label>
                                </div>
                            </div>
                            <div class="col-md-8 mb-3">
                                <button type="submit" class="btn btn-ceai btn-submit-full w-100" id="btnSubmitNoticia">‚úÖ Crear Noticia</button>
                            </div>
                            <div class="col-md-4 mb-3">
                                <button type="button" class="btn btn-outline-secondary btn-submit-full w-100" id="btnCancelNoticia" style="display:none" onclick="cancelarEdicionNoticia()">‚úñ Cancelar</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="table-section">
                    <h5 class="mb-3">üìã Noticias Registradas</h5>
                    <div class="table-responsive" id="listaNoticias"></div>
                </div>
            </div>

            <!-- SEMILLEROS -->
            <div id="semilleros" class="content-section">
                <div class="section-header">
                    <h2>üå± Gestionar Semilleros</h2>
                    <p class="mb-0">Crear, editar y eliminar semilleros</p>
                </div>
                <div class="form-section">
                    <h5 id="tituloFormSemillero">‚ûï Nuevo Semillero</h5>
                    <form id="formSemillero">
                        <input type="hidden" id="semilleroEditId">
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Categor√≠a / Servicio <span class="text-danger">*</span></label>
                                <select class="form-control" id="semilleroCategoria" required>
                                    <option value="Soluciones Digitales">Soluciones Digitales</option>
                                    <option value="Automatizaci√≥n e Instrumentaci√≥n">Automatizaci√≥n e Instrumentaci√≥n</option>
                                    <option value="F√°brica Digital Interactiva">F√°brica Digital Interactiva</option>
                                    <option value="Gesti√≥n Energ√©tica">Gesti√≥n Energ√©tica</option>
                                    <option value="IA Aplicada al Entorno">IA Aplicada al Entorno</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombre <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="semilleroNombre" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">L√≠nea de Investigaci√≥n <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="semilleroLinea" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Enfoque <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="semilleroEnfoque" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">URL Imagen</label>
                                <input type="url" class="form-control" id="semilleroImagen" placeholder="https://...">
                            </div>
                            <!-- EDITOR QUILL PARA DESCRIPCI√ìN SEMILLERO -->
                            <div class="col-12 mb-3">
                                <label class="form-label quill-label">Descripci√≥n <span class="text-danger">*</span></label>
                                <div class="quill-wrapper">
                                    <div id="editorSemillero"></div>
                                </div>
                                <input type="hidden" id="semilleroDescripcion">
                            </div>
                            <div class="col-md-8 mb-3">
                                <button type="submit" class="btn btn-ceai btn-submit-full w-100" id="btnSubmitSemillero">‚úÖ Crear Semillero</button>
                            </div>
                            <div class="col-md-4 mb-3">
                                <button type="button" class="btn btn-outline-secondary btn-submit-full w-100" id="btnCancelSemillero" style="display:none" onclick="cancelarEdicionSemillero()">‚úñ Cancelar</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="table-section">
                    <h5 class="mb-3">üìã Semilleros Registrados</h5>
                    <div class="table-responsive" id="listaSemilleros"></div>
                </div>
            </div>

            <!-- PROYECTOS -->
            <div id="proyectos" class="content-section">
                <div class="section-header">
                    <h2>üî¨ Gestionar Proyectos</h2>
                    <p class="mb-0">Crear, editar y eliminar proyectos</p>
                </div>
                <div class="form-section">
                    <h5 id="tituloFormProyecto">‚ûï Nuevo Proyecto</h5>
                    <form id="formProyecto">
                        <input type="hidden" id="proyectoEditId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Categor√≠a / Servicio</label>
                                <select class="form-control" id="proyectoCategoria">
                                    <option value="">-- Seleccionar categor√≠a --</option>
                                    <option value="Soluciones Digitales">Soluciones Digitales</option>
                                    <option value="Automatizaci√≥n e Instrumentaci√≥n">Automatizaci√≥n e Instrumentaci√≥n</option>
                                    <option value="F√°brica Digital Interactiva">F√°brica Digital Interactiva</option>
                                    <option value="Gesti√≥n Energ√©tica">Gesti√≥n Energ√©tica</option>
                                    <option value="IA Aplicada al Entorno">IA Aplicada al Entorno</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Semillero <span class="text-danger">*</span></label>
                                <select class="form-control" id="proyectoSemillero" required disabled>
                                    <option value="">-- Selecciona categor√≠a primero --</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">T√≠tulo <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="proyectoTitulo" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Estado <span class="text-danger">*</span></label>
                                <select class="form-control" id="proyectoEstado" required>
                                    <option value="En ejecuci√≥n">En ejecuci√≥n</option>
                                    <option value="Finalizado">Finalizado</option>
                                    <option value="En revisi√≥n">En revisi√≥n</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Aliados</label>
                                <input type="text" class="form-control" id="proyectoAliados">
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Objetivo</label>
                                <textarea class="form-control" id="proyectoObjetivo" rows="2"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Entregables</label>
                                <textarea class="form-control" id="proyectoEntregables" rows="2"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Evidencia</label>
                                <textarea class="form-control" id="proyectoEvidencia" rows="2"></textarea>
                            </div>
                            <div class="col-md-8 mb-3">
                                <button type="submit" class="btn btn-ceai btn-submit-full w-100" id="btnSubmitProyecto">‚úÖ Crear Proyecto</button>
                            </div>
                            <div class="col-md-4 mb-3">
                                <button type="button" class="btn btn-outline-secondary btn-submit-full w-100" id="btnCancelProyecto" style="display:none" onclick="cancelarEdicionProyecto()">‚úñ Cancelar</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="table-section">
                    <h5 class="mb-3">üìã Proyectos Registrados</h5>
                    <div class="table-responsive" id="listaProyectos"></div>
                </div>
            </div>

            <!-- DOCUMENTOS -->
            <div id="documentos" class="content-section">
                <div class="section-header">
                    <h2>üìÑ Gestionar Documentos</h2>
                    <p class="mb-0">Subir, editar y eliminar documentos PDF</p>
                </div>
                <div class="form-section">
                    <h5>‚ûï Nuevo Documento</h5>
                    <form id="formDocumento" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombre del Documento <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="docNombre" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Tipo <span class="text-danger">*</span></label>
                                <select class="form-control" id="docTipo" required>
                                    <option value="">-- Seleccionar --</option>
                                    <option value="Convocatoria">Convocatoria</option>
                                    <option value="Portafolio">Portafolio de Servicios</option>
                                    <option value="Informe">Informe</option>
                                    <option value="Manual">Manual</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                            <!-- EDITOR QUILL PARA DESCRIPCI√ìN DOCUMENTO -->
                            <div class="col-12 mb-3">
                                <label class="form-label quill-label">Descripci√≥n</label>
                                <div class="quill-wrapper">
                                    <div id="editorDocumento"></div>
                                </div>
                                <input type="hidden" id="docDescripcion">
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Archivo PDF <span class="text-danger">*</span></label>
                                <div id="dropZone" class="rounded p-5 text-center" style="border:2px dashed var(--ceai-verde);cursor:pointer;transition:all .3s;">
                                    <input type="file" id="docArchivo" class="form-control d-none" accept=".pdf" required>
                                    <div id="dropText">
                                        <p style="margin:0;color:var(--ceai-verde);font-weight:bold;">üìÅ Arrastra tu PDF aqu√≠</p>
                                        <p style="margin:5px 0 0 0;color:#666;font-size:14px;">o haz clic para seleccionar</p>
                                    </div>
                                    <div id="fileSelected" style="display:none;color:var(--ceai-verde);">
                                        <p style="margin:0;font-weight:bold;">‚úÖ Archivo listo:</p>
                                        <p id="fileName" style="margin:5px 0 0 0;"></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 mb-3">
                                <button type="submit" class="btn btn-ceai btn-submit-full w-100">üì§ Subir Documento</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="table-section">
                    <h5 class="mb-3">üìã Documentos Registrados</h5>
                    <div class="table-responsive" id="listaDocumentos"></div>
                </div>
            </div>

            <!-- CONTACTOS -->
            <div id="contactos" class="content-section">
                <div class="section-header">
                    <h2>üì® Mensajes de Contacto</h2>
                    <p class="mb-0">Ver y gestionar mensajes recibidos</p>
                </div>
                <div class="table-section">
                    <h5 class="mb-3">üìã Mensajes Recibidos</h5>
                    <div class="table-responsive" id="listaContactos"></div>
                </div>
            </div>

        </div><!-- /content-wrapper -->
    </div><!-- /admin-wrapper -->

    <!-- ===== MODALES ===== -->
    <!-- Modal Ver Proyecto -->
    <div class="modal fade" id="verProyectoModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">üëÅÔ∏è Detalle de Proyecto</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <p><strong>T√≠tulo:</strong> <span id="vp_titulo"></span></p>
                    <p><strong>Semillero:</strong> <span id="vp_semillero"></span></p>
                    <p><strong>Estado:</strong> <span id="vp_estado" class="badge"></span></p>
                    <p><strong>Aliados:</strong> <span id="vp_aliados"></span></p>
                    <hr>
                    <p><strong>Objetivo:</strong></p><div class="detail-box mb-3" id="vp_objetivo"></div>
                    <p><strong>Entregables:</strong></p><div class="detail-box mb-3" id="vp_entregables"></div>
                    <p><strong>Evidencia:</strong></p><div class="detail-box" id="vp_evidencia"></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button></div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Proyecto -->
    <div class="modal fade" id="editarProyectoModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">‚úèÔ∏è Editar Proyecto</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="formEditarProyecto">
                        <input type="hidden" id="edit_p_id">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Semillero <span class="text-danger">*</span></label>
                                <select class="form-control" id="edit_p_semillero" required></select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">T√≠tulo <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="edit_p_titulo" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Estado</label>
                                <select class="form-control" id="edit_p_estado">
                                    <option value="En ejecuci√≥n">En ejecuci√≥n</option>
                                    <option value="Finalizado">Finalizado</option>
                                    <option value="En revisi√≥n">En revisi√≥n</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Aliados</label>
                                <input type="text" class="form-control" id="edit_p_aliados">
                            </div>
                            <div class="col-12 mb-3"><label class="form-label">Objetivo</label><textarea class="form-control" id="edit_p_objetivo" rows="2"></textarea></div>
                            <div class="col-12 mb-3"><label class="form-label">Entregables</label><textarea class="form-control" id="edit_p_entregables" rows="2"></textarea></div>
                            <div class="col-12 mb-3"><label class="form-label">Evidencia</label><textarea class="form-control" id="edit_p_evidencia" rows="2"></textarea></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-ceai" onclick="guardarEdicionProyecto()">üíæ Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ver Documento -->
    <div class="modal fade" id="verDocumentoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">üëÅÔ∏è Detalle de Documento</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <p><strong>Nombre:</strong> <span id="vd_nombre"></span></p>
                    <p><strong>Tipo:</strong> <span id="vd_tipo" class="badge bg-info"></span></p>
                    <p><strong>Descripci√≥n:</strong></p>
                    <div class="detail-box" id="vd_descripcion"></div>
                    <p class="mt-3"><strong>Archivo:</strong> <a id="vd_archivo" href="#" target="_blank" class="btn btn-sm btn-outline-primary">üì• Descargar PDF</a></p>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button></div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Noticia -->
    <div class="modal fade" id="editarNoticiaModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">‚úèÔ∏è Editar Noticia</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="formEditarNoticia">
                        <input type="hidden" id="edit_n_id">
                        <div class="row">
                            <div class="col-md-6 mb-3"><label class="form-label">T√≠tulo</label><input type="text" class="form-control" id="edit_n_titulo"></div>
                            <div class="col-md-3 mb-3"><label class="form-label">Fecha</label><input type="date" class="form-control" id="edit_n_fecha"></div>
                            <div class="col-md-3 mb-3"><label class="form-label">Tipo</label><select class="form-control" id="edit_n_tipo"><option value="Noticia">Noticia</option><option value="Evento">Evento</option><option value="Convocatoria">Convocatoria</option><option value="Resultado">Resultado</option></select></div>
                            <div class="col-12 mb-3">
                                <label class="form-label quill-label">Descripci√≥n</label>
                                <div class="quill-wrapper"><div id="editorEditNoticia"></div></div>
                                <input type="hidden" id="edit_n_descripcion">
                            </div>
                            <div class="col-md-6 mb-3"><label class="form-label">URL Imagen</label><input type="url" class="form-control" id="edit_n_imagen" placeholder="https://..."></div>
                            <div class="col-md-6 mb-3 d-flex align-items-center"><div class="form-check"><input class="form-check-input" type="checkbox" id="edit_n_destacada"><label class="form-check-label" for="edit_n_destacada">‚≠ê Destacar en carousel</label></div></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-ceai" onclick="guardarEdicionNoticia()">üíæ Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Semillero -->
    <div class="modal fade" id="editarSemilleroModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">‚úèÔ∏è Editar Semillero</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="formEditarSemillero">
                        <input type="hidden" id="edit_s_id">
                        <div class="row">
                            <div class="col-md-12 mb-3"><label class="form-label">Categor√≠a</label><select class="form-control" id="edit_s_categoria"><option value="Soluciones Digitales">Soluciones Digitales</option><option value="Automatizaci√≥n e Instrumentaci√≥n">Automatizaci√≥n e Instrumentaci√≥n</option><option value="F√°brica Digital Interactiva">F√°brica Digital Interactiva</option><option value="Gesti√≥n Energ√©tica">Gesti√≥n Energ√©tica</option><option value="IA Aplicada al Entorno">IA Aplicada al Entorno</option></select></div>
                            <div class="col-md-6 mb-3"><label class="form-label">Nombre</label><input type="text" class="form-control" id="edit_s_nombre"></div>
                            <div class="col-md-6 mb-3"><label class="form-label">L√≠nea de Investigaci√≥n</label><input type="text" class="form-control" id="edit_s_linea"></div>
                            <div class="col-md-6 mb-3"><label class="form-label">Enfoque</label><input type="text" class="form-control" id="edit_s_enfoque"></div>
                            <div class="col-md-6 mb-3"><label class="form-label">URL Imagen</label><input type="url" class="form-control" id="edit_s_imagen" placeholder="https://..."></div>
                            <div class="col-12 mb-3">
                                <label class="form-label quill-label">Descripci√≥n</label>
                                <div class="quill-wrapper"><div id="editorEditSemillero"></div></div>
                                <input type="hidden" id="edit_s_descripcion">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-ceai" onclick="guardarEdicionSemillero()">üíæ Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Documento -->
    <div class="modal fade" id="editarDocumentoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">‚úèÔ∏è Editar Documento</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="formEditarDocumento">
                        <input type="hidden" id="edit_d_id">
                        <div class="row">
                            <div class="col-md-6 mb-3"><label class="form-label">Nombre</label><input type="text" class="form-control" id="edit_d_nombre"></div>
                            <div class="col-md-6 mb-3"><label class="form-label">Tipo</label><select class="form-control" id="edit_d_tipo"><option value="Convocatoria">Convocatoria</option><option value="Portafolio">Portafolio de Servicios</option><option value="Informe">Informe</option><option value="Manual">Manual</option><option value="Otro">Otro</option></select></div>
                            <div class="col-12 mb-3">
                                <label class="form-label quill-label">Descripci√≥n</label>
                                <div class="quill-wrapper"><div id="editorEditDocumento"></div></div>
                                <input type="hidden" id="edit_d_descripcion">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-ceai" onclick="guardarEdicionDocumento()">üíæ Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toastContainer" style="position:fixed;top:20px;right:20px;z-index:9999;"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Quill Editor JS -->
    <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
    <script>
        const API = 'https://ceai-web-production.up.railway.app';
        let noticiasCache = [], semillerosCache = [], proyectosCache = [], documentosCache = [], contactosCache = [];
        let todosLosSemilleros = [];

        // ===================== QUILL EDITORS =====================
        const quillOpts = {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'font': [] }, { 'size': ['small', false, 'large', 'huge'] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'color': [] }, { 'background': [] }],
                    [{ 'align': [] }],
                    [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                    ['link'],
                    ['clean']
                ]
            },
            placeholder: 'Escribe la descripci√≥n aqu√≠...'
        };

        // Instancias de Quill
        const quillNoticia        = new Quill('#editorNoticia',        quillOpts);
        const quillSemillero      = new Quill('#editorSemillero',      quillOpts);
        const quillDocumento      = new Quill('#editorDocumento',      quillOpts);
        const quillEditNoticia    = new Quill('#editorEditNoticia',    quillOpts);
        const quillEditSemillero  = new Quill('#editorEditSemillero',  quillOpts);
        const quillEditDocumento  = new Quill('#editorEditDocumento',  quillOpts);

        // Helper: obtener HTML de un editor Quill
        function getQuillHTML(quillInstance) {
            const html = quillInstance.root.innerHTML;
            return html === '<p><br></p>' ? '' : html;
        }

        // ===================== TOAST =====================
        const toast = {
            show: (msg, type='success') => {
                const id = 'toast_' + Date.now();
                const bg = type === 'success' ? '#198754' : type === 'error' ? '#dc3545' : '#0dcaf0';
                const el = document.createElement('div');
                el.id = id;
                el.style.cssText = `background:${bg};color:white;padding:12px 18px;border-radius:10px;margin-bottom:8px;font-weight:600;font-size:.9rem;box-shadow:0 4px 14px rgba(0,0,0,.2);animation:fadeInContent .3s ease;max-width:320px;`;
                el.textContent = msg;
                document.getElementById('toastContainer').appendChild(el);
                setTimeout(() => { el.style.opacity = '0'; el.style.transition = 'opacity .4s'; setTimeout(() => el.remove(), 400); }, 3000);
            },
            success: msg => toast.show(msg, 'success'),
            error:   msg => toast.show(msg, 'error'),
            info:    msg => toast.show(msg, 'info')
        };

        // ===================== NAVEGACI√ìN =====================
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', () => {
                document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                link.classList.add('active');
                const sec = link.dataset.section;
                document.getElementById(sec).classList.add('active');
                if (sec === 'noticias') cargarNoticias();
                else if (sec === 'semilleros') cargarSemilleros();
                else if (sec === 'proyectos') cargarProyectos();
                else if (sec === 'documentos') cargarDocumentos();
                else if (sec === 'contactos') cargarContactos();
                if (window.innerWidth <= 992) cerrarSidebar();
            });
        });

        function irSeccion(sec) {
            document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
            document.querySelector(`[data-section="${sec}"]`).classList.add('active');
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.getElementById(sec).classList.add('active');
            if (sec === 'noticias') cargarNoticias();
            else if (sec === 'semilleros') cargarSemilleros();
            else if (sec === 'proyectos') cargarProyectos();
            else if (sec === 'documentos') cargarDocumentos();
            else if (sec === 'contactos') cargarContactos();
        }

        // ===================== SIDEBAR TOGGLE =====================
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        function cerrarSidebar() { sidebar.classList.remove('show'); sidebarOverlay.classList.remove('show'); }
        sidebarToggle.addEventListener('click', () => {
            const open = sidebar.classList.toggle('show');
            open ? sidebarOverlay.classList.add('show') : sidebarOverlay.classList.remove('show');
        });
        sidebarOverlay.addEventListener('click', cerrarSidebar);

        // ===================== DASHBOARD =====================
        async function cargarDashboard() {
            try {
                const [rN, rS, rP, rD, rC] = await Promise.all([
                    fetch(`${API}/api/noticias`), fetch(`${API}/api/semilleros`),
                    fetch(`${API}/api/proyectos`), fetch(`${API}/api/documentos`),
                    fetch(`${API}/api/contactos`)
                ]);
                const [n, s, p, d, c] = await Promise.all([rN.json(), rS.json(), rP.json(), rD.json(), rC.json()]);
                document.getElementById('countNoticias').textContent = n.length || 0;
                document.getElementById('countSemilleros').textContent = s.length || 0;
                document.getElementById('countProyectos').textContent = p.length || 0;
                document.getElementById('countDocumentos').textContent = d.length || 0;

                // Charts
                new Chart(document.getElementById('chartContenido'), {
                    type: 'doughnut',
                    data: { labels: ['Noticias', 'Semilleros', 'Proyectos', 'Documentos'],
                        datasets: [{ data: [n.length, s.length, p.length, d.length], backgroundColor: ['#39a900','#00304d','#4dc800','#005580'] }] },
                    options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
                });
                const leidos = c.filter(x => x.leido === 1).length;
                new Chart(document.getElementById('chartContactos'), {
                    type: 'bar',
                    data: { labels: ['Le√≠dos', 'Sin leer'],
                        datasets: [{ data: [leidos, c.length - leidos], backgroundColor: ['#39a900','#dc3545'] }] },
                    options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } }
                });

                // Listas recientes
                const ulN = document.getElementById('ultimasNoticias');
                ulN.innerHTML = n.slice(0, 5).map(x => `<li class="list-group-item d-flex justify-content-between align-items-center py-2 px-0"><small>${x.titulo}</small><span class="badge bg-secondary" style="font-size:.7rem;">${x.tipo||'Noticia'}</span></li>`).join('') || '<li class="list-group-item px-0 text-muted">Sin noticias</li>';
                const ulC = document.getElementById('ultimosContactos');
                ulC.innerHTML = c.slice(0, 5).map(x => `<li class="list-group-item d-flex justify-content-between align-items-center py-2 px-0"><small>${x.nombre}</small><span class="badge ${x.leido ? 'bg-success' : 'bg-warning text-dark'}" style="font-size:.7rem;">${x.leido ? 'Le√≠do' : 'Nuevo'}</span></li>`).join('') || '<li class="list-group-item px-0 text-muted">Sin mensajes</li>';
            } catch (err) { console.error('Error dashboard:', err); }
        }

        // ===================== NOTICIAS =====================
        async function cargarNoticias() {
            const res = await fetch(`${API}/api/noticias`);
            noticiasCache = await res.json();
            const lista = document.getElementById('listaNoticias');
            if (!noticiasCache.length) { lista.innerHTML = '<p class="text-muted">No hay noticias a√∫n</p>'; return; }
            lista.innerHTML = `<table class="table table-hover align-middle"><thead class="table-light"><tr><th>ID</th><th>T√≠tulo</th><th>Fecha</th><th>Tipo</th><th class="text-center col-acciones">Acciones</th></tr></thead><tbody>${noticiasCache.map(n => `<tr><td>${n.id}</td><td>${n.titulo}</td><td>${n.fecha}</td><td><span class="badge bg-secondary">${n.tipo||'Noticia'}</span></td><td class="col-acciones"><div class="table-actions"><button class="btn btn-sm btn-outline-primary" onclick="editarNoticia(${n.id})">‚úèÔ∏è Editar</button><button class="btn btn-sm btn-danger" onclick="eliminarNoticia(${n.id})">üóëÔ∏è Eliminar</button></div></td></tr>`).join('')}</tbody></table>`;
        }

        document.getElementById('formNoticia').addEventListener('submit', async e => {
            e.preventDefault();
            const desc = getQuillHTML(quillNoticia);
            if (!desc) { toast.error('La descripci√≥n es requerida'); return; }
            document.getElementById('noticiaDescripcion').value = desc;
            const body = {
                titulo: document.getElementById('noticiaTitulo').value,
                descripcion: desc,
                fecha: document.getElementById('noticiaFecha').value,
                imagen: document.getElementById('noticiaImagen').value,
                tipo: document.getElementById('noticiaTipo').value,
                destacada: document.getElementById('noticiaDestacada').checked
            };
            const editId = document.getElementById('noticiaEditId').value;
            const method = editId ? 'PUT' : 'POST';
            const url = editId ? `${API}/api/noticias/${editId}` : `${API}/api/noticias`;
            const res = await fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
            if (res.ok) {
                toast.success(editId ? 'Noticia actualizada' : 'Noticia creada');
                cancelarEdicionNoticia();
                cargarNoticias();
                cargarDashboard();
            } else { toast.error('Error al guardar'); }
        });

        function cancelarEdicionNoticia() {
            document.getElementById('formNoticia').reset();
            quillNoticia.setContents([]);
            document.getElementById('noticiaEditId').value = '';
            document.getElementById('tituloFormNoticia').textContent = '‚ûï Nueva Noticia';
            document.getElementById('btnSubmitNoticia').textContent = '‚úÖ Crear Noticia';
            document.getElementById('btnCancelNoticia').style.display = 'none';
        }

        function editarNoticia(id) {
            const n = noticiasCache.find(x => x.id === id);
            if (!n) return;
            document.getElementById('noticiaEditId').value = n.id;
            document.getElementById('noticiaTitulo').value = n.titulo;
            document.getElementById('noticiaFecha').value = n.fecha;
            document.getElementById('noticiaTipo').value = n.tipo || 'Noticia';
            document.getElementById('noticiaImagen').value = n.imagen || '';
            document.getElementById('noticiaDestacada').checked = n.destacada == 1;
            quillNoticia.root.innerHTML = n.descripcion || '';
            document.getElementById('tituloFormNoticia').textContent = '‚úèÔ∏è Editando Noticia';
            document.getElementById('btnSubmitNoticia').textContent = 'üíæ Actualizar';
            document.getElementById('btnCancelNoticia').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function eliminarNoticia(id) {
            if (!confirm('¬øEliminar esta noticia?')) return;
            const res = await fetch(`${API}/api/noticias/${id}`, { method: 'DELETE' });
            if (res.ok) { toast.info('Noticia eliminada'); cargarNoticias(); cargarDashboard(); }
            else { toast.error('Error al eliminar'); }
        }

        async function guardarEdicionNoticia() {
            const desc = getQuillHTML(quillEditNoticia);
            document.getElementById('edit_n_descripcion').value = desc;
            const id = document.getElementById('edit_n_id').value;
            const body = {
                titulo: document.getElementById('edit_n_titulo').value,
                descripcion: desc,
                fecha: document.getElementById('edit_n_fecha').value,
                imagen: document.getElementById('edit_n_imagen').value,
                tipo: document.getElementById('edit_n_tipo').value,
                destacada: document.getElementById('edit_n_destacada').checked
            };
            const res = await fetch(`${API}/api/noticias/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
            if (res.ok) { toast.success('Noticia actualizada'); bootstrap.Modal.getInstance(document.getElementById('editarNoticiaModal')).hide(); cargarNoticias(); cargarDashboard(); }
            else { toast.error('Error al guardar'); }
        }

        // ===================== SEMILLEROS =====================
        async function cargarSemilleros() {
            const res = await fetch(`${API}/api/semilleros`);
            semillerosCache = await res.json();
            todosLosSemilleros = semillerosCache;
            const lista = document.getElementById('listaSemilleros');
            if (!semillerosCache.length) { lista.innerHTML = '<p class="text-muted">No hay semilleros a√∫n</p>'; return; }
            lista.innerHTML = `<table class="table table-hover align-middle"><thead class="table-light"><tr><th>ID</th><th>Nombre</th><th>Categor√≠a</th><th>L√≠nea</th><th class="text-center col-acciones">Acciones</th></tr></thead><tbody>${semillerosCache.map(s => `<tr><td>${s.id}</td><td>${s.nombre}</td><td><span class="badge bg-info" style="font-size:.75rem;">${s.categoria||''}</span></td><td><small>${s.linea}</small></td><td class="col-acciones"><div class="table-actions"><button class="btn btn-sm btn-outline-primary" onclick="editarSemillero(${s.id})">‚úèÔ∏è Editar</button><button class="btn btn-sm btn-danger" onclick="eliminarSemillero(${s.id})">üóëÔ∏è Eliminar</button></div></td></tr>`).join('')}</tbody></table>`;
        }

        document.getElementById('formSemillero').addEventListener('submit', async e => {
            e.preventDefault();
            const desc = getQuillHTML(quillSemillero);
            if (!desc) { toast.error('La descripci√≥n es requerida'); return; }
            document.getElementById('semilleroDescripcion').value = desc;
            const body = {
                nombre: document.getElementById('semilleroNombre').value,
                linea: document.getElementById('semilleroLinea').value,
                enfoque: document.getElementById('semilleroEnfoque').value,
                descripcion: desc,
                imagen: document.getElementById('semilleroImagen').value,
                categoria: document.getElementById('semilleroCategoria').value
            };
            const editId = document.getElementById('semilleroEditId').value;
            const method = editId ? 'PUT' : 'POST';
            const url = editId ? `${API}/api/semilleros/${editId}` : `${API}/api/semilleros`;
            const res = await fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
            if (res.ok) { toast.success(editId ? 'Semillero actualizado' : 'Semillero creado'); cancelarEdicionSemillero(); cargarSemilleros(); cargarDashboard(); }
            else { toast.error('Error al guardar'); }
        });

        function cancelarEdicionSemillero() {
            document.getElementById('formSemillero').reset();
            quillSemillero.setContents([]);
            document.getElementById('semilleroEditId').value = '';
            document.getElementById('tituloFormSemillero').textContent = '‚ûï Nuevo Semillero';
            document.getElementById('btnSubmitSemillero').textContent = '‚úÖ Crear Semillero';
            document.getElementById('btnCancelSemillero').style.display = 'none';
        }

        function editarSemillero(id) {
            const s = semillerosCache.find(x => x.id === id);
            if (!s) return;
            document.getElementById('semilleroEditId').value = s.id;
            document.getElementById('semilleroNombre').value = s.nombre;
            document.getElementById('semilleroLinea').value = s.linea;
            document.getElementById('semilleroEnfoque').value = s.enfoque;
            document.getElementById('semilleroImagen').value = s.imagen || '';
            document.getElementById('semilleroCategoria').value = s.categoria || 'Soluciones Digitales';
            quillSemillero.root.innerHTML = s.descripcion || '';
            document.getElementById('tituloFormSemillero').textContent = '‚úèÔ∏è Editando Semillero';
            document.getElementById('btnSubmitSemillero').textContent = 'üíæ Actualizar';
            document.getElementById('btnCancelSemillero').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function eliminarSemillero(id) {
            if (!confirm('¬øEliminar este semillero? Tambi√©n se eliminar√°n sus proyectos asociados.')) return;
            const res = await fetch(`${API}/api/semilleros/${id}`, { method: 'DELETE' });
            if (res.ok) { toast.info('Semillero eliminado'); cargarSemilleros(); cargarDashboard(); }
            else { toast.error('Error al eliminar'); }
        }

        async function guardarEdicionSemillero() {
            const desc = getQuillHTML(quillEditSemillero);
            document.getElementById('edit_s_descripcion').value = desc;
            const id = document.getElementById('edit_s_id').value;
            const body = {
                nombre: document.getElementById('edit_s_nombre').value,
                linea: document.getElementById('edit_s_linea').value,
                enfoque: document.getElementById('edit_s_enfoque').value,
                descripcion: desc,
                imagen: document.getElementById('edit_s_imagen').value,
                categoria: document.getElementById('edit_s_categoria').value
            };
            const res = await fetch(`${API}/api/semilleros/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
            if (res.ok) { toast.success('Semillero actualizado'); bootstrap.Modal.getInstance(document.getElementById('editarSemilleroModal')).hide(); cargarSemilleros(); cargarDashboard(); }
            else { toast.error('Error al guardar'); }
        }

        // ===================== PROYECTOS =====================
        async function cargarProyectos() {
            const res = await fetch(`${API}/api/proyectos`);
            proyectosCache = await res.json();
            if (!todosLosSemilleros.length) {
                const resSem = await fetch(`${API}/api/semilleros`);
                todosLosSemilleros = await resSem.json();
            }
            const editSelect = document.getElementById('edit_p_semillero');
            editSelect.innerHTML = todosLosSemilleros.map(s => `<option value="${s.id}">${s.nombre} (${s.categoria})</option>`).join('');
            const lista = document.getElementById('listaProyectos');
            if (!proyectosCache.length) { lista.innerHTML = '<p class="text-muted">No hay proyectos a√∫n</p>'; return; }
            lista.innerHTML = `<table class="table table-hover align-middle"><thead class="table-light"><tr><th>ID</th><th>T√≠tulo</th><th>Semillero</th><th>Estado</th><th class="text-center col-acciones">Acciones</th></tr></thead><tbody>${proyectosCache.map(p => { const semNombre = todosLosSemilleros.find(s => s.id === p.semillero_id); const badgeClass = p.estado === 'En ejecuci√≥n' ? 'bg-primary' : p.estado === 'Finalizado' ? 'bg-success' : 'bg-warning text-dark'; return `<tr><td>${p.id}</td><td>${p.titulo}</td><td><small>${semNombre ? semNombre.nombre : 'ID: ' + p.semillero_id}</small></td><td><span class="badge ${badgeClass}">${p.estado}</span></td><td class="col-acciones"><div class="table-actions"><button class="btn btn-sm btn-outline-primary" onclick="verProyecto(${p.id})" title="Ver">üëÅÔ∏è Ver</button><button class="btn btn-sm btn-warning" onclick="editarProyecto(${p.id})" title="Editar">‚úèÔ∏è Editar</button><button class="btn btn-sm btn-danger" onclick="eliminarProyecto(${p.id})" title="Eliminar">üóëÔ∏è Eliminar</button></div></td></tr>`; }).join('')}</tbody></table>`;
        }

        document.getElementById('formProyecto').addEventListener('submit', async e => {
            e.preventDefault();
            const body = {
                semillero_id: document.getElementById('proyectoSemillero').value,
                titulo: document.getElementById('proyectoTitulo').value,
                estado: document.getElementById('proyectoEstado').value,
                aliados: document.getElementById('proyectoAliados').value,
                objetivo: document.getElementById('proyectoObjetivo').value,
                entregables: document.getElementById('proyectoEntregables').value,
                evidencia: document.getElementById('proyectoEvidencia').value
            };
            const editId = document.getElementById('proyectoEditId').value;
            const method = editId ? 'PUT' : 'POST';
            const url = editId ? `${API}/api/proyectos/${editId}` : `${API}/api/proyectos`;
            const res = await fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
            if (res.ok) { toast.success(editId ? 'Proyecto actualizado' : 'Proyecto creado'); cancelarEdicionProyecto(); cargarProyectos(); cargarDashboard(); }
            else { toast.error('Error al guardar'); }
        });

        document.getElementById('proyectoCategoria').addEventListener('change', async function() {
            const cat = this.value;
            const sel = document.getElementById('proyectoSemillero');
            if (!cat) { sel.innerHTML = '<option value="">-- Selecciona categor√≠a primero --</option>'; sel.disabled = true; return; }
            const res = await fetch(`${API}/api/semilleros/categoria/${encodeURIComponent(cat)}`);
            const sems = await res.json();
            sel.innerHTML = sems.length ? sems.map(s => `<option value="${s.id}">${s.nombre}</option>`).join('') : '<option value="">Sin semilleros en esta categor√≠a</option>';
            sel.disabled = false;
        });

        function cancelarEdicionProyecto() {
            document.getElementById('formProyecto').reset();
            document.getElementById('proyectoEditId').value = '';
            document.getElementById('tituloFormProyecto').textContent = '‚ûï Nuevo Proyecto';
            document.getElementById('btnSubmitProyecto').textContent = '‚úÖ Crear Proyecto';
            document.getElementById('btnCancelProyecto').style.display = 'none';
            document.getElementById('proyectoSemillero').disabled = true;
        }

        function verProyecto(id) {
            const p = proyectosCache.find(x => x.id === id);
            if (!p) return;
            const semNombre = todosLosSemilleros.find(s => s.id === p.semillero_id);
            document.getElementById('vp_titulo').textContent = p.titulo;
            document.getElementById('vp_semillero').textContent = semNombre ? `${semNombre.nombre} (ID: ${p.semillero_id})` : `ID: ${p.semillero_id}`;
            const badge = document.getElementById('vp_estado');
            badge.textContent = p.estado;
            badge.className = 'badge ' + (p.estado === 'En ejecuci√≥n' ? 'bg-primary' : p.estado === 'Finalizado' ? 'bg-success' : 'bg-warning text-dark');
            document.getElementById('vp_aliados').textContent = p.aliados || '‚Äî';
            document.getElementById('vp_objetivo').textContent = p.objetivo || '‚Äî';
            document.getElementById('vp_entregables').textContent = p.entregables || '‚Äî';
            document.getElementById('vp_evidencia').textContent = p.evidencia || '‚Äî';
            new bootstrap.Modal(document.getElementById('verProyectoModal')).show();
        }

        function editarProyecto(id) {
            const p = proyectosCache.find(x => x.id === id);
            if (!p) return;
            document.getElementById('edit_p_id').value = p.id;
            document.getElementById('edit_p_semillero').value = p.semillero_id;
            document.getElementById('edit_p_titulo').value = p.titulo;
            document.getElementById('edit_p_estado').value = p.estado;
            document.getElementById('edit_p_aliados').value = p.aliados || '';
            document.getElementById('edit_p_objetivo').value = p.objetivo || '';
            document.getElementById('edit_p_entregables').value = p.entregables || '';
            document.getElementById('edit_p_evidencia').value = p.evidencia || '';
            new bootstrap.Modal(document.getElementById('editarProyectoModal')).show();
        }

        async function guardarEdicionProyecto() {
            const id = document.getElementById('edit_p_id').value;
            const body = {
                semillero_id: document.getElementById('edit_p_semillero').value,
                titulo: document.getElementById('edit_p_titulo').value,
                estado: document.getElementById('edit_p_estado').value,
                aliados: document.getElementById('edit_p_aliados').value,
                objetivo: document.getElementById('edit_p_objetivo').value,
                entregables: document.getElementById('edit_p_entregables').value,
                evidencia: document.getElementById('edit_p_evidencia').value
            };
            const res = await fetch(`${API}/api/proyectos/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
            if (res.ok) { toast.success('Proyecto actualizado'); bootstrap.Modal.getInstance(document.getElementById('editarProyectoModal')).hide(); cargarProyectos(); cargarDashboard(); }
            else { toast.error('Error al guardar'); }
        }

        async function eliminarProyecto(id) {
            if (!confirm('¬øEliminar este proyecto?')) return;
            const res = await fetch(`${API}/api/proyectos/${id}`, { method: 'DELETE' });
            if (res.ok) { toast.info('Proyecto eliminado'); cargarProyectos(); cargarDashboard(); }
            else { toast.error('Error al eliminar'); }
        }

        // ===================== DOCUMENTOS =====================
        async function cargarDocumentos() {
            const res = await fetch(`${API}/api/documentos`);
            documentosCache = await res.json();
            const lista = document.getElementById('listaDocumentos');
            if (!documentosCache.length) { lista.innerHTML = '<p class="text-muted">No hay documentos a√∫n</p>'; return; }
            lista.innerHTML = `<table class="table table-hover align-middle"><thead class="table-light"><tr><th>ID</th><th>Nombre</th><th>Tipo</th><th>Fecha</th><th class="text-center col-acciones">Acciones</th></tr></thead><tbody>${documentosCache.map(d => `<tr><td>${d.id}</td><td>${d.nombre}</td><td><span class="badge bg-info" style="font-size:.75rem;">${d.tipo}</span></td><td><small>${new Date(d.created_at).toLocaleDateString('es-CO')}</small></td><td class="col-acciones"><div class="table-actions"><button class="btn btn-sm btn-outline-primary" onclick="verDocumento(${d.id})">üëÅÔ∏è Ver</button><button class="btn btn-sm btn-warning" onclick="editarDocumento(${d.id})">‚úèÔ∏è Editar</button><button class="btn btn-sm btn-danger" onclick="eliminarDocumento(${d.id})">üóëÔ∏è Eliminar</button></div></td></tr>`).join('')}</tbody></table>`;
        }

        document.getElementById('formDocumento').addEventListener('submit', async e => {
            e.preventDefault();
            const desc = getQuillHTML(quillDocumento);
            document.getElementById('docDescripcion').value = desc;
            const formData = new FormData();
            formData.append('nombre', document.getElementById('docNombre').value);
            formData.append('tipo', document.getElementById('docTipo').value);
            formData.append('descripcion', desc);
            formData.append('archivo', document.getElementById('docArchivo').files[0]);
            const res = await fetch(`${API}/api/documentos`, { method: 'POST', body: formData });
            if (res.ok) { toast.success('Documento subido'); document.getElementById('formDocumento').reset(); quillDocumento.setContents([]); document.getElementById('dropText').style.display = 'block'; document.getElementById('fileSelected').style.display = 'none'; cargarDocumentos(); cargarDashboard(); }
            else { const err = await res.json(); toast.error(err.error || 'Error al subir'); }
        });

        // Drop zone
        const dropZone = document.getElementById('dropZone');
        const docArchivoInput = document.getElementById('docArchivo');
        dropZone.addEventListener('click', () => docArchivoInput.click());
        dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.style.background = 'rgba(57,169,0,0.08)'; });
        dropZone.addEventListener('dragleave', () => { dropZone.style.background = ''; });
        dropZone.addEventListener('drop', e => { e.preventDefault(); dropZone.style.background = ''; const file = e.dataTransfer.files[0]; if (file && file.type === 'application/pdf') { const dt = new DataTransfer(); dt.items.add(file); docArchivoInput.files = dt.files; mostrarArchivoSeleccionado(file.name); } else { toast.error('Solo se permiten archivos PDF'); } });
        docArchivoInput.addEventListener('change', () => { if (docArchivoInput.files[0]) mostrarArchivoSeleccionado(docArchivoInput.files[0].name); });
        function mostrarArchivoSeleccionado(nombre) { document.getElementById('dropText').style.display = 'none'; document.getElementById('fileSelected').style.display = 'block'; document.getElementById('fileName').textContent = nombre; }

        function verDocumento(id) {
            const d = documentosCache.find(x => x.id === id);
            if (!d) return;
            document.getElementById('vd_nombre').textContent = d.nombre;
            document.getElementById('vd_tipo').textContent = d.tipo;
            const descEl = document.getElementById('vd_descripcion');
            descEl.innerHTML = d.descripcion || '‚Äî';
            document.getElementById('vd_archivo').href = `https://ceai-web-production.up.railway.app${d.ruta_archivo}`;
            new bootstrap.Modal(document.getElementById('verDocumentoModal')).show();
        }

        function editarDocumento(id) {
            const d = documentosCache.find(x => x.id === id);
            if (!d) return;
            document.getElementById('edit_d_id').value = d.id;
            document.getElementById('edit_d_nombre').value = d.nombre;
            document.getElementById('edit_d_tipo').value = d.tipo;
            quillEditDocumento.root.innerHTML = d.descripcion || '';
            new bootstrap.Modal(document.getElementById('editarDocumentoModal')).show();
        }

        async function guardarEdicionDocumento() {
            const desc = getQuillHTML(quillEditDocumento);
            document.getElementById('edit_d_descripcion').value = desc;
            const id = document.getElementById('edit_d_id').value;
            const body = { nombre: document.getElementById('edit_d_nombre').value, tipo: document.getElementById('edit_d_tipo').value, descripcion: desc };
            const res = await fetch(`${API}/api/documentos/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
            if (res.ok) { toast.success('Documento actualizado'); bootstrap.Modal.getInstance(document.getElementById('editarDocumentoModal')).hide(); cargarDocumentos(); }
            else { toast.error('Error al guardar'); }
        }

        async function eliminarDocumento(id) {
            if (!confirm('¬øEliminar este documento?')) return;
            const res = await fetch(`${API}/api/documentos/${id}`, { method: 'DELETE' });
            if (res.ok) { toast.info('Documento eliminado'); cargarDocumentos(); cargarDashboard(); }
            else { toast.error('Error al eliminar'); }
        }

        // ===================== CONTACTOS =====================
        async function cargarContactos() {
            const res = await fetch(`${API}/api/contactos`);
            contactosCache = await res.json();
            const lista = document.getElementById('listaContactos');
            if (!contactosCache.length) { lista.innerHTML = '<p class="text-muted">No hay mensajes a√∫n</p>'; return; }
            lista.innerHTML = `<table class="table table-hover align-middle"><thead class="table-light"><tr><th>ID</th><th>Nombre</th><th>Email</th><th>Asunto</th><th>Mensaje</th><th>Estado</th><th class="text-center col-acciones">Acciones</th></tr></thead><tbody>${contactosCache.map(c => `<tr><td>${c.id}</td><td>${c.nombre}</td><td><small>${c.email}</small></td><td>${c.asunto}</td><td><small>${(c.mensaje||'').substring(0,50)}...</small></td><td><span class="badge ${c.leido ? 'bg-success' : 'bg-warning text-dark'}">${c.leido ? 'Le√≠do' : 'Nuevo'}</span></td><td class="col-acciones"><div class="table-actions"><button class="btn btn-sm btn-outline-success" onclick="marcarLeido(${c.id},${c.leido ? 0 : 1})">${c.leido ? 'No le√≠do' : '‚úî Le√≠do'}</button><button class="btn btn-sm btn-danger" onclick="eliminarContacto(${c.id})">üóëÔ∏è</button></div></td></tr>`).join('')}</tbody></table>`;
        }

        async function marcarLeido(id, leido) {
            const res = await fetch(`${API}/api/contactos/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ leido }) });
            if (res.ok) { cargarContactos(); cargarDashboard(); }
        }

        async function eliminarContacto(id) {
            if (!confirm('¬øEliminar este mensaje?')) return;
            const res = await fetch(`${API}/api/contactos/${id}`, { method: 'DELETE' });
            if (res.ok) { toast.info('Mensaje eliminado'); cargarContactos(); cargarDashboard(); }
        }

        // ===================== INIT =====================
        document.addEventListener('DOMContentLoaded', cargarDashboard);
    </script>
</body>
</html>